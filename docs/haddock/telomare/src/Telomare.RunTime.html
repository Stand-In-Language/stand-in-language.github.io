<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase          #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Telomare.RunTime</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">-- import Control.Exception</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Fix</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadIO</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/b6pykcsrbr832m3k5rq9ihilf70jps6s-recursion-schemes-5.2.3-doc/share/doc/recursion-schemes-5.2.3/html/src/Data.Functor.Foldable.html"><span class="hs-identifier">Data.Functor.Foldable</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/b6pykcsrbr832m3k5rq9ihilf70jps6s-recursion-schemes-5.2.3-doc/share/doc/recursion-schemes-5.2.3/html/src/Data.Functor.Foldable.html#fold"><span class="hs-identifier">fold</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Functor.Identity</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Debug.Trace</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Exts</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromList</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Naturals.html"><span class="hs-identifier">Naturals</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#debug"><span class="hs-identifier">debug</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Naturals.html#debugTrace"><span class="hs-identifier">debugTrace</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PrettyPrint.html"><span class="hs-identifier">PrettyPrint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PrettyPrint.html#PrettyIExpr"><span class="hs-identifier">PrettyIExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PrettyPrint.html#PrettyIExpr"><span class="hs-identifier">PrettyIExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PrettyPrint.html#showNExprs"><span class="hs-identifier">showNExprs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hGetContents</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Process</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CreateProcess</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">std_out</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">StdStream</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CreatePipe</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>                       </span><span class="annot"><span class="hs-identifier">createProcess</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">shell</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Telomare.html"><span class="hs-identifier">Telomare</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Read</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">readMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="annot"><a href="Telomare.RunTime.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-28"></span><span id="debug"><span class="annot"><span class="annottext">debug :: Bool
</span><a href="Telomare.RunTime.html#debug"><span class="hs-identifier hs-var hs-var">debug</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span id="local-6989586621679263238"><span class="annot"><a href="Telomare.RunTime.html#debugTrace"><span class="hs-identifier hs-type">debugTrace</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679263238"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679263238"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-31"></span><span id="debugTrace"><span class="annot"><span class="annottext">debugTrace :: forall a. String -&gt; a -&gt; a
</span><a href="Telomare.RunTime.html#debugTrace"><span class="hs-identifier hs-var hs-var">debugTrace</span></a></span></span><span> </span><span id="local-6989586621679263470"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679263470"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679263471"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679263471"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="Telomare.RunTime.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; a -&gt; a
forall a. String -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">trace</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679263470"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679263471"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679263471"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-comment">-- cPlus :: (t3 -&gt; t2 -&gt; t1) -&gt; (t3 -&gt; t -&gt; t2) -&gt; t3 -&gt; t -&gt; t1</span><span>
</span><span id="line-34"></span><span id="local-6989586621679263240"><span class="annot"><a href="Telomare.RunTime.html#cPlus"><span class="hs-identifier hs-type">cPlus</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679263240"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679263240"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679263240"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679263240"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679263240"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679263240"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679263240"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679263240"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679263240"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679263240"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679263240"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679263240"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-35"></span><span class="hs-comment">-- cPlus m n f x = m f (n f x)</span><span>
</span><span id="line-36"></span><span id="cPlus"><span class="annot"><span class="annottext">cPlus :: forall a.
((a -&gt; a) -&gt; a -&gt; a) -&gt; ((a -&gt; a) -&gt; a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="Telomare.RunTime.html#cPlus"><span class="hs-identifier hs-var hs-var">cPlus</span></a></span></span><span> </span><span id="local-6989586621679263473"><span class="annot"><span class="annottext">(a -&gt; a) -&gt; a -&gt; a
</span><a href="#local-6989586621679263473"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679263474"><span class="annot"><span class="annottext">(a -&gt; a) -&gt; a -&gt; a
</span><a href="#local-6989586621679263474"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679263475"><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679263475"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; a -&gt; a
</span><a href="#local-6989586621679263473"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679263475"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; a -&gt; a
</span><a href="#local-6989586621679263474"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679263475"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="annot"><a href="Telomare.RunTime.html#nEval"><span class="hs-identifier hs-type">nEval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Naturals.html#NExprs"><span class="hs-identifier hs-type">NExprs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Naturals.html#NExpr"><span class="hs-identifier hs-type">NExpr</span></a></span><span>
</span><span id="line-39"></span><span id="nEval"><span class="annot"><span class="annottext">nEval :: NExprs -&gt; NExpr
</span><a href="Telomare.RunTime.html#nEval"><span class="hs-identifier hs-var hs-var">nEval</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NExprs"><span class="hs-identifier hs-type">NExprs</span></a></span><span> </span><span id="local-6989586621679263479"><span class="annot"><span class="annottext">Map FragIndex NExpr
</span><a href="#local-6989586621679263479"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679263480"><span class="hs-identifier hs-type">eval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Naturals.html#NExpr"><span class="hs-identifier hs-type">NExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Naturals.html#NExpr"><span class="hs-identifier hs-type">NExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Naturals.html#NExpr"><span class="hs-identifier hs-type">NExpr</span></a></span><span>
</span><span id="line-41"></span><span>      </span><span id="local-6989586621679263480"><span class="annot"><span class="annottext">eval :: NExpr -&gt; NExpr -&gt; NExpr
</span><a href="#local-6989586621679263480"><span class="hs-identifier hs-var hs-var">eval</span></a></span></span><span> </span><span id="local-6989586621679263481"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263481"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679263482"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263482"><span class="hs-identifier hs-var">frag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679263483"><span class="annot"><span class="annottext">recur :: NExpr -&gt; NExpr
</span><a href="#local-6989586621679263483"><span class="hs-identifier hs-var hs-var">recur</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr -&gt; NExpr
</span><a href="#local-6989586621679263480"><span class="hs-identifier hs-var">eval</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263481"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263482"><span class="hs-identifier hs-var">frag</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-42"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NPair"><span class="hs-identifier hs-type">NPair</span></a></span><span> </span><span id="local-6989586621679263485"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263485"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679263486"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263486"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr -&gt; NExpr
</span><a href="Naturals.html#NPair"><span class="hs-identifier hs-var">NPair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NExpr -&gt; NExpr
</span><a href="#local-6989586621679263483"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263485"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NExpr -&gt; NExpr
</span><a href="#local-6989586621679263483"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263486"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>        </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NEnv"><span class="hs-identifier hs-var">NEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263481"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-44"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NLeft"><span class="hs-identifier hs-type">NLeft</span></a></span><span> </span><span id="local-6989586621679263489"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263489"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr
</span><a href="#local-6989586621679263483"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263489"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-45"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NPair"><span class="hs-identifier hs-type">NPair</span></a></span><span> </span><span id="local-6989586621679263490"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263490"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263490"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-46"></span><span>          </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NZero"><span class="hs-identifier hs-var">NZero</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NZero"><span class="hs-identifier hs-var">NZero</span></a></span><span>
</span><span id="line-47"></span><span>          </span><span id="local-6989586621679263492"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263492"><span class="hs-identifier hs-var">z</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; NExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nEval: nleft on &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263492"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; before &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263489"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NRight"><span class="hs-identifier hs-type">NRight</span></a></span><span> </span><span id="local-6989586621679263496"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263496"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr
</span><a href="#local-6989586621679263483"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263496"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-49"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NPair"><span class="hs-identifier hs-type">NPair</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679263497"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263497"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263497"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-50"></span><span>          </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NZero"><span class="hs-identifier hs-var">NZero</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NZero"><span class="hs-identifier hs-var">NZero</span></a></span><span>
</span><span id="line-51"></span><span>          </span><span id="local-6989586621679263498"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263498"><span class="hs-identifier hs-var">z</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; NExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nright on &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263498"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NDefer"><span class="hs-identifier hs-type">NDefer</span></a></span><span> </span><span id="local-6989586621679263500"><span class="annot"><span class="annottext">FragIndex
</span><a href="#local-6989586621679263500"><span class="hs-identifier hs-var">ind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FragIndex -&gt; Map FragIndex NExpr -&gt; Maybe NExpr
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">FragIndex
</span><a href="#local-6989586621679263500"><span class="hs-identifier hs-var">ind</span></a></span><span> </span><span class="annot"><span class="annottext">Map FragIndex NExpr
</span><a href="#local-6989586621679263479"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-53"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679263502"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263502"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263502"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-54"></span><span>          </span><span class="annot"><span class="annottext">Maybe NExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; NExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; NExpr)
-&gt; (RunTimeError -&gt; String) -&gt; RunTimeError -&gt; NExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RunTimeError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(RunTimeError -&gt; NExpr) -&gt; RunTimeError -&gt; NExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IExpr -&gt; RunTimeError
</span><a href="Telomare.html#GenericRunTimeError"><span class="hs-identifier hs-var">GenericRunTimeError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nEval bad index for function: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FragIndex -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">FragIndex
</span><a href="#local-6989586621679263500"><span class="hs-identifier hs-var">ind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a></span><span>
</span><span id="line-55"></span><span>        </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NTrace"><span class="hs-identifier hs-var">NTrace</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; NExpr -&gt; NExpr
forall a. String -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">trace</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NExpr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263481"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263481"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-56"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NSetEnv"><span class="hs-identifier hs-type">NSetEnv</span></a></span><span> </span><span id="local-6989586621679263507"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263507"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr
</span><a href="#local-6989586621679263483"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263507"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-57"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NPair"><span class="hs-identifier hs-type">NPair</span></a></span><span> </span><span id="local-6989586621679263508"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263508"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679263509"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263509"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263508"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-58"></span><span>            </span><span class="annot"><a href="Naturals.html#NGate"><span class="hs-identifier hs-type">NGate</span></a></span><span> </span><span id="local-6989586621679263511"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263511"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679263512"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263512"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263509"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-59"></span><span>              </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NZero"><span class="hs-identifier hs-var">NZero</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr
</span><a href="#local-6989586621679263483"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263511"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-60"></span><span>              </span><span class="annot"><span class="annottext">NExpr
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr
</span><a href="#local-6989586621679263483"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263512"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-61"></span><span>            </span><span class="annot"><span class="annottext">NExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr -&gt; NExpr
</span><a href="#local-6989586621679263480"><span class="hs-identifier hs-var">eval</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263509"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263508"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-62"></span><span>          </span><span id="local-6989586621679263513"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263513"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; NExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nEval: nsetenv - not pair - &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263513"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NApp"><span class="hs-identifier hs-type">NApp</span></a></span><span> </span><span id="local-6989586621679263515"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263515"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679263516"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263516"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-64"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679263517"><span class="annot"><span class="annottext">nc :: NExpr
</span><a href="#local-6989586621679263517"><span class="hs-identifier hs-var hs-var">nc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr
</span><a href="#local-6989586621679263483"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263515"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-65"></span><span>              </span><span id="local-6989586621679263518"><span class="annot"><span class="annottext">ni :: NExpr
</span><a href="#local-6989586621679263518"><span class="hs-identifier hs-var hs-var">ni</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr
</span><a href="#local-6989586621679263483"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263516"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-66"></span><span>              </span><span id="local-6989586621679263526"><span class="annot"><span class="annottext">appl :: NExpr -&gt; NExpr -&gt; NExpr
</span><a href="#local-6989586621679263526"><span class="hs-identifier hs-var hs-var">appl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NPair"><span class="hs-identifier hs-type">NPair</span></a></span><span> </span><span id="local-6989586621679263527"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263527"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679263528"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263528"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679263529"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263529"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr -&gt; NExpr
</span><a href="#local-6989586621679263480"><span class="hs-identifier hs-var">eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NExpr -&gt; NExpr -&gt; NExpr
</span><a href="Naturals.html#NPair"><span class="hs-identifier hs-var">NPair</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263529"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263528"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263527"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-67"></span><span>              </span><span class="annot"><a href="#local-6989586621679263526"><span class="hs-identifier hs-var">appl</span></a></span><span> </span><span id="local-6989586621679263530"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263530"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679263531"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263531"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; NExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nEval: napp appl no pair &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263530"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; --- &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263531"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263517"><span class="hs-identifier hs-var">nc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-69"></span><span>            </span><span id="local-6989586621679263532"><span class="annot"><span class="annottext">p :: NExpr
</span><a href="#local-6989586621679263532"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NPair"><span class="hs-identifier hs-type">NPair</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr -&gt; NExpr
</span><a href="#local-6989586621679263526"><span class="hs-identifier hs-var">appl</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263532"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263518"><span class="hs-identifier hs-var">ni</span></a></span><span>
</span><span id="line-70"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NLamNum"><span class="hs-identifier hs-type">NLamNum</span></a></span><span> </span><span id="local-6989586621679263534"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679263534"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679263535"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263535"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263518"><span class="hs-identifier hs-var">ni</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-71"></span><span>              </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NLamNum"><span class="hs-identifier hs-type">NLamNum</span></a></span><span> </span><span id="local-6989586621679263536"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679263536"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr -&gt; NExpr
</span><a href="Naturals.html#NPair"><span class="hs-identifier hs-var">NPair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NExpr -&gt; NExpr -&gt; NExpr
</span><a href="Naturals.html#NPair"><span class="hs-identifier hs-var">NPair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; NExpr
</span><a href="Naturals.html#NNum"><span class="hs-identifier hs-var">NNum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679263534"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Int64 -&gt; Int64
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679263536"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NEnv"><span class="hs-identifier hs-var">NEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263535"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-72"></span><span>              </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NPartialNum"><span class="hs-identifier hs-type">NPartialNum</span></a></span><span> </span><span id="local-6989586621679263540"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679263540"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679263541"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263541"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr -&gt; NExpr
</span><a href="Naturals.html#NPair"><span class="hs-identifier hs-var">NPair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; NExpr
</span><a href="Naturals.html#NNum"><span class="hs-identifier hs-var">NNum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679263534"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Int64 -&gt; Int64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679263540"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263541"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-73"></span><span>            </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NToNum"><span class="hs-identifier hs-var">NToNum</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr -&gt; NExpr
</span><a href="Naturals.html#NApp"><span class="hs-identifier hs-var">NApp</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NToNum"><span class="hs-identifier hs-var">NToNum</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263518"><span class="hs-identifier hs-var">ni</span></a></span><span>
</span><span id="line-74"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NApp"><span class="hs-identifier hs-type">NApp</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NToNum"><span class="hs-identifier hs-var">NToNum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NPair"><span class="hs-identifier hs-type">NPair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NPair"><span class="hs-identifier hs-type">NPair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NNum"><span class="hs-identifier hs-type">NNum</span></a></span><span> </span><span id="local-6989586621679263544"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679263544"><span class="hs-identifier hs-var">nn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NEnv"><span class="hs-identifier hs-var">NEnv</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679263545"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263545"><span class="hs-identifier hs-var">nenv</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-75"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679263561"><span class="annot"><span class="annottext">fStep :: t -&gt; NExpr -&gt; a
</span><a href="#local-6989586621679263561"><span class="hs-identifier hs-var hs-var">fStep</span></a></span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span>
</span><span id="line-76"></span><span>                  </span><span class="annot"><a href="#local-6989586621679263561"><span class="hs-identifier hs-var">fStep</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NZero"><span class="hs-identifier hs-var">NZero</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span>
</span><span id="line-77"></span><span>                  </span><span class="annot"><a href="#local-6989586621679263561"><span class="hs-identifier hs-var">fStep</span></a></span><span> </span><span id="local-6989586621679263562"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679263562"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NPair"><span class="hs-identifier hs-type">NPair</span></a></span><span> </span><span id="local-6989586621679263563"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263563"><span class="hs-identifier hs-var">pr</span></a></span></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NZero"><span class="hs-identifier hs-var">NZero</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">t -&gt; NExpr -&gt; a
</span><a href="#local-6989586621679263561"><span class="hs-identifier hs-var">fStep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679263562"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263563"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-78"></span><span>                  </span><span class="annot"><a href="#local-6989586621679263561"><span class="hs-identifier hs-var">fStep</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679263565"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263565"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;napp ntonum fstep bad pair: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263565"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr -&gt; NExpr
</span><a href="Naturals.html#NPair"><span class="hs-identifier hs-var">NPair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NExpr -&gt; NExpr -&gt; NExpr
</span><a href="Naturals.html#NPair"><span class="hs-identifier hs-var">NPair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; NExpr
</span><a href="Naturals.html#NNum"><span class="hs-identifier hs-var">NNum</span></a></span><span> </span><span class="annot"><span class="annottext">(Int64 -&gt; NExpr) -&gt; Int64 -&gt; NExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; NExpr -&gt; Int64
forall {t} {a}. (Eq t, Num t, Num a) =&gt; t -&gt; NExpr -&gt; a
</span><a href="#local-6989586621679263561"><span class="hs-identifier hs-var">fStep</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679263544"><span class="hs-identifier hs-var">nn</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263518"><span class="hs-identifier hs-var">ni</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NEnv"><span class="hs-identifier hs-var">NEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263545"><span class="hs-identifier hs-var">nenv</span></a></span><span>
</span><span id="line-80"></span><span>            </span><span id="local-6989586621679263566"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263566"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; NExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nEval: napp error - non pair c - &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263566"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &lt;&lt;from&gt;&gt; &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263515"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NOldDefer"><span class="hs-identifier hs-type">NOldDefer</span></a></span><span> </span><span id="local-6989586621679263568"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263568"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263568"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-82"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NNum"><span class="hs-identifier hs-type">NNum</span></a></span><span> </span><span id="local-6989586621679263569"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679263569"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679263576"><span class="annot"><span class="annottext">buildF :: t -&gt; NExpr
</span><a href="#local-6989586621679263576"><span class="hs-identifier hs-var hs-var">buildF</span></a></span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr
</span><a href="Naturals.html#NLeft"><span class="hs-identifier hs-var">NLeft</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NEnv"><span class="hs-identifier hs-var">NEnv</span></a></span><span>
</span><span id="line-83"></span><span>                        </span><span class="annot"><a href="#local-6989586621679263576"><span class="hs-identifier hs-var">buildF</span></a></span><span> </span><span id="local-6989586621679263577"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679263577"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr -&gt; NExpr
</span><a href="Naturals.html#NApp"><span class="hs-identifier hs-var">NApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NExpr -&gt; NExpr
</span><a href="Naturals.html#NLeft"><span class="hs-identifier hs-var">NLeft</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NExpr -&gt; NExpr
</span><a href="Naturals.html#NRight"><span class="hs-identifier hs-var">NRight</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NEnv"><span class="hs-identifier hs-var">NEnv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; NExpr
</span><a href="#local-6989586621679263576"><span class="hs-identifier hs-var">buildF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679263577"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>                    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; NExpr
forall {t}. (Eq t, Num t) =&gt; t -&gt; NExpr
</span><a href="#local-6989586621679263576"><span class="hs-identifier hs-var">buildF</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679263569"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-85"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NTwiddle"><span class="hs-identifier hs-type">NTwiddle</span></a></span><span> </span><span id="local-6989586621679263579"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263579"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr
</span><a href="#local-6989586621679263483"><span class="hs-identifier hs-var">recur</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263579"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-86"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NPair"><span class="hs-identifier hs-type">NPair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NPair"><span class="hs-identifier hs-type">NPair</span></a></span><span> </span><span id="local-6989586621679263580"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263580"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679263581"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263581"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679263582"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263582"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr -&gt; NExpr
</span><a href="Naturals.html#NPair"><span class="hs-identifier hs-var">NPair</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263580"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NExpr -&gt; NExpr -&gt; NExpr
</span><a href="Naturals.html#NPair"><span class="hs-identifier hs-var">NPair</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263582"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263581"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>          </span><span id="local-6989586621679263583"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263583"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; NExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nEval: ntwiddle not pairpair: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263583"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>        </span><span id="local-6989586621679263584"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263584"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263584"><span class="hs-identifier hs-var">z</span></a></span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FragIndex -&gt; Map FragIndex NExpr -&gt; Maybe NExpr
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; FragIndex
</span><a href="Telomare.html#FragIndex"><span class="hs-identifier hs-var">FragIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map FragIndex NExpr
</span><a href="#local-6989586621679263479"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679263586"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263586"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr -&gt; NExpr
</span><a href="#local-6989586621679263480"><span class="hs-identifier hs-var">eval</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NZero"><span class="hs-identifier hs-var">NZero</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263586"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><span class="annottext">Maybe NExpr
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; NExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; NExpr) -&gt; String -&gt; NExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nEval: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">RunTimeError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; IExpr -&gt; RunTimeError
</span><a href="Telomare.html#GenericRunTimeError"><span class="hs-identifier hs-var">GenericRunTimeError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nEval: no root frag&quot;</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-comment">-- |IExpr evaluation with a given enviroment `e`</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- (as in the second element of a closure).</span><span>
</span><span id="line-95"></span><span class="annot"><a href="Telomare.RunTime.html#rEval"><span class="hs-identifier hs-type">rEval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The enviroment.</span></span><span>
</span><span id="line-96"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ IExpr to be evaluated.</span></span><span>
</span><span id="line-97"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span>
</span><span id="line-98"></span><span id="rEval"><span class="annot"><span class="annottext">rEval :: IExpr -&gt; IExpr -&gt; IExpr
</span><a href="Telomare.RunTime.html#rEval"><span class="hs-identifier hs-var hs-var">rEval</span></a></span></span><span> </span><span id="local-6989586621679263588"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263588"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Base IExpr (IExpr, IExpr) -&gt; IExpr) -&gt; IExpr -&gt; IExpr
forall t a. Recursive t =&gt; (Base t (t, a) -&gt; a) -&gt; t -&gt; a
forall a. (Base IExpr (IExpr, a) -&gt; a) -&gt; IExpr -&gt; a
</span><a href="file:///nix/store/b6pykcsrbr832m3k5rq9ihilf70jps6s-recursion-schemes-5.2.3-doc/share/doc/recursion-schemes-5.2.3/html/src/Data.Functor.Foldable.html#para"><span class="hs-identifier hs-var">para</span></a></span><span> </span><span class="annot"><span class="annottext">Base IExpr (IExpr, IExpr) -&gt; IExpr
</span><a href="#local-6989586621679263590"><span class="hs-identifier hs-var">alg</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><a href="#local-6989586621679263590"><span class="hs-identifier hs-type">alg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/b6pykcsrbr832m3k5rq9ihilf70jps6s-recursion-schemes-5.2.3-doc/share/doc/recursion-schemes-5.2.3/html/src/Data.Functor.Foldable.html#Base"><span class="hs-identifier hs-type">Base</span></a></span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span>
</span><span id="line-101"></span><span>  </span><span id="local-6989586621679263590"><span class="annot"><span class="annottext">alg :: Base IExpr (IExpr, IExpr) -&gt; IExpr
</span><a href="#local-6989586621679263590"><span class="hs-identifier hs-var hs-var">alg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><span class="annottext">Base IExpr (IExpr, IExpr)
IExprF (IExpr, IExpr)
</span><a href="Telomare.html#ZeroF"><span class="hs-identifier hs-var">ZeroF</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span class="annot"><span class="annottext">Base IExpr (IExpr, IExpr)
IExprF (IExpr, IExpr)
</span><a href="Telomare.html#EnvF"><span class="hs-identifier hs-var">EnvF</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263588"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.html#DeferF"><span class="hs-identifier hs-type">DeferF</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679263594"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263594"><span class="hs-identifier hs-var">ie</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr
</span><a href="Telomare.html#Defer"><span class="hs-identifier hs-var">Defer</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263594"><span class="hs-identifier hs-var">ie</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><span class="annottext">Base IExpr (IExpr, IExpr)
IExprF (IExpr, IExpr)
</span><a href="Telomare.html#TraceF"><span class="hs-identifier hs-var">TraceF</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IExpr -&gt; IExpr
forall a. String -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">trace</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IExpr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263588"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263588"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.html#GateF"><span class="hs-identifier hs-type">GateF</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679263598"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263598"><span class="hs-identifier hs-var">ie1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679263599"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263599"><span class="hs-identifier hs-var">ie2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr -&gt; IExpr
</span><a href="Telomare.html#Gate"><span class="hs-identifier hs-var">Gate</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263598"><span class="hs-identifier hs-var">ie1</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263599"><span class="hs-identifier hs-var">ie2</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.html#PairF"><span class="hs-identifier hs-type">PairF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679263602"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263602"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679263603"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263603"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr -&gt; IExpr
</span><a href="Telomare.html#Pair"><span class="hs-identifier hs-var">Pair</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263602"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263603"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.html#PRightF"><span class="hs-identifier hs-type">PRightF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679263606"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263606"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263606"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-109"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679263607"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263607"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263607"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-110"></span><span>      </span><span class="annot"><span class="annottext">IExpr
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.html#PLeftF"><span class="hs-identifier hs-type">PLeftF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679263609"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263609"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263609"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-112"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621679263610"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263610"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263610"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><span class="annottext">IExpr
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a></span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.html#SetEnvF"><span class="hs-identifier hs-type">SetEnvF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679263612"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263612"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263612"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-115"></span><span>      </span><span class="annot"><a href="Telomare.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.html#Defer"><span class="hs-identifier hs-type">Defer</span></a></span><span> </span><span id="local-6989586621679263613"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263613"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679263614"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263614"><span class="hs-identifier hs-var">nenv</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr -&gt; IExpr
</span><a href="Telomare.RunTime.html#rEval"><span class="hs-identifier hs-var">rEval</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263614"><span class="hs-identifier hs-var">nenv</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263613"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-116"></span><span>      </span><span class="annot"><a href="Telomare.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.html#Gate"><span class="hs-identifier hs-type">Gate</span></a></span><span> </span><span id="local-6989586621679263615"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263615"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr -&gt; IExpr
</span><a href="Telomare.RunTime.html#rEval"><span class="hs-identifier hs-var">rEval</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263588"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263615"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-117"></span><span>      </span><span class="annot"><a href="Telomare.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.html#Gate"><span class="hs-identifier hs-type">Gate</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679263616"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263616"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr -&gt; IExpr
</span><a href="Telomare.RunTime.html#rEval"><span class="hs-identifier hs-var">rEval</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263588"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263616"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-118"></span><span>      </span><span class="hs-comment">-- The next case should never actually occur,</span><span>
</span><span id="line-119"></span><span>      </span><span class="hs-comment">-- because it should be caught by `typeCheck`.</span><span>
</span><span id="line-120"></span><span>      </span><span id="local-6989586621679263617"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263617"><span class="hs-identifier hs-var">z</span></a></span></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IExpr) -&gt; String -&gt; IExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rEval: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">RunTimeError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; IExpr -&gt; RunTimeError
</span><a href="Telomare.html#GenericRunTimeError"><span class="hs-identifier hs-var">GenericRunTimeError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SetEnv unexpected arg&quot;</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263617"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-comment">-- |The fix point combinator of this function (of type `IExpr -&gt; IExpr -&gt; m IExpr`) yields a function that</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- evaluates an `IExpr` with a given enviroment (another `IExpr`).</span><span>
</span><span id="line-124"></span><span id="local-6989586621679263265"><span class="annot"><a href="Telomare.RunTime.html#iEval"><span class="hs-identifier hs-type">iEval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Telomare.html#RunTimeError"><span class="hs-identifier hs-type">RunTimeError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679263265"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679263265"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679263265"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span></span><span>
</span><span id="line-125"></span><span id="iEval"><span class="annot"><span class="annottext">iEval :: forall (m :: * -&gt; *).
MonadError RunTimeError m =&gt;
(IExpr -&gt; IExpr -&gt; m IExpr) -&gt; IExpr -&gt; IExpr -&gt; m IExpr
</span><a href="Telomare.RunTime.html#iEval"><span class="hs-identifier hs-var hs-var">iEval</span></a></span></span><span> </span><span id="local-6989586621679263643"><span class="annot"><span class="annottext">IExpr -&gt; IExpr -&gt; m IExpr
</span><a href="#local-6989586621679263643"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679263644"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263644"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679263645"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263645"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679263646"><span class="annot"><span class="annottext">f' :: IExpr -&gt; m IExpr
</span><a href="#local-6989586621679263646"><span class="hs-identifier hs-var hs-var">f'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr -&gt; m IExpr
</span><a href="#local-6989586621679263643"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263644"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263645"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><span class="annottext">IExpr
</span><a href="Telomare.html#Trace"><span class="hs-identifier hs-var">Trace</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; m IExpr
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(IExpr -&gt; m IExpr) -&gt; IExpr -&gt; m IExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IExpr -&gt; IExpr
forall a. String -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">trace</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IExpr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263644"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263644"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><span class="annottext">IExpr
</span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; m IExpr
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a></span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-comment">-- Abort -&gt; pure Abort</span><span>
</span><span id="line-129"></span><span>  </span><span class="annot"><a href="Telomare.html#Defer"><span class="hs-identifier hs-type">Defer</span></a></span><span> </span><span id="local-6989586621679263648"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263648"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; m IExpr
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(IExpr -&gt; m IExpr) -&gt; IExpr -&gt; m IExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr
</span><a href="Telomare.html#Defer"><span class="hs-identifier hs-var">Defer</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263648"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><a href="Telomare.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621679263649"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263649"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679263650"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263650"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr -&gt; IExpr
</span><a href="Telomare.html#Pair"><span class="hs-identifier hs-var">Pair</span></a></span><span> </span><span class="annot"><span class="annottext">(IExpr -&gt; IExpr -&gt; IExpr) -&gt; m IExpr -&gt; m (IExpr -&gt; IExpr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; m IExpr
</span><a href="#local-6989586621679263646"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263649"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">m (IExpr -&gt; IExpr) -&gt; m IExpr -&gt; m IExpr
forall a b. m (a -&gt; b) -&gt; m a -&gt; m b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; m IExpr
</span><a href="#local-6989586621679263646"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263650"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><a href="Telomare.html#Gate"><span class="hs-identifier hs-type">Gate</span></a></span><span> </span><span id="local-6989586621679263652"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263652"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679263653"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263653"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; m IExpr
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(IExpr -&gt; m IExpr) -&gt; IExpr -&gt; m IExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr -&gt; IExpr
</span><a href="Telomare.html#Gate"><span class="hs-identifier hs-var">Gate</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263652"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263653"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><span class="annottext">IExpr
</span><a href="Telomare.html#Env"><span class="hs-identifier hs-var">Env</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; m IExpr
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263644"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-133"></span><span>  </span><span class="annot"><a href="Telomare.html#SetEnv"><span class="hs-identifier hs-type">SetEnv</span></a></span><span> </span><span id="local-6989586621679263656"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263656"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IExpr -&gt; m IExpr
</span><a href="#local-6989586621679263646"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263656"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">m IExpr -&gt; (IExpr -&gt; m IExpr) -&gt; m IExpr
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((IExpr -&gt; m IExpr) -&gt; m IExpr) -&gt; (IExpr -&gt; m IExpr) -&gt; m IExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-134"></span><span>    </span><span class="annot"><a href="Telomare.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621679263657"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263657"><span class="hs-identifier hs-var">cf</span></a></span></span><span> </span><span id="local-6989586621679263658"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263658"><span class="hs-identifier hs-var">nenv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263657"><span class="hs-identifier hs-var">cf</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-135"></span><span>      </span><span class="annot"><a href="Telomare.html#Defer"><span class="hs-identifier hs-type">Defer</span></a></span><span> </span><span id="local-6989586621679263659"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263659"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr -&gt; m IExpr
</span><a href="#local-6989586621679263643"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263658"><span class="hs-identifier hs-var">nenv</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263659"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-136"></span><span>      </span><span class="hs-comment">-- do we change env in evaluation of a/b, or leave it same? change seems more consistent, leave more convenient</span><span>
</span><span id="line-137"></span><span>      </span><span class="annot"><a href="Telomare.html#Gate"><span class="hs-identifier hs-type">Gate</span></a></span><span> </span><span id="local-6989586621679263660"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263660"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679263661"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263661"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263658"><span class="hs-identifier hs-var">nenv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-138"></span><span>        </span><span class="annot"><span class="annottext">IExpr
</span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; m IExpr
</span><a href="#local-6989586621679263646"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263660"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-139"></span><span>        </span><span class="annot"><span class="annottext">IExpr
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; m IExpr
</span><a href="#local-6989586621679263646"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263661"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-140"></span><span>      </span><span id="local-6989586621679263662"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263662"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RunTimeError -&gt; m IExpr
forall a. RunTimeError -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(RunTimeError -&gt; m IExpr) -&gt; RunTimeError -&gt; m IExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IExpr -&gt; RunTimeError
</span><a href="Telomare.html#GenericRunTimeError"><span class="hs-identifier hs-var">GenericRunTimeError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SetEnv unexpected fun arg&quot;</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263662"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="hs-comment">-- should be caught by typecheck</span><span>
</span><span id="line-141"></span><span>    </span><span id="local-6989586621679263664"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263664"><span class="hs-identifier hs-var">bx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RunTimeError -&gt; m IExpr
forall a. RunTimeError -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(RunTimeError -&gt; m IExpr) -&gt; RunTimeError -&gt; m IExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IExpr -&gt; RunTimeError
</span><a href="Telomare.html#GenericRunTimeError"><span class="hs-identifier hs-var">GenericRunTimeError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SetEnv unexpected non pair arg&quot;</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263664"><span class="hs-identifier hs-var">bx</span></a></span><span> </span><span class="hs-comment">-- should be caught by typecheck</span><span>
</span><span id="line-142"></span><span>  </span><span class="annot"><a href="Telomare.html#PLeft"><span class="hs-identifier hs-type">PLeft</span></a></span><span> </span><span id="local-6989586621679263666"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263666"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; m IExpr
</span><a href="#local-6989586621679263646"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263666"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">m IExpr -&gt; (IExpr -&gt; m IExpr) -&gt; m IExpr
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621679263667"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263667"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; m IExpr
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263667"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><span class="annottext">IExpr
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; m IExpr
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a></span><span>
</span><span id="line-145"></span><span>  </span><span class="annot"><a href="Telomare.html#PRight"><span class="hs-identifier hs-type">PRight</span></a></span><span> </span><span id="local-6989586621679263669"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263669"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; m IExpr
</span><a href="#local-6989586621679263646"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263669"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">m IExpr -&gt; (IExpr -&gt; m IExpr) -&gt; m IExpr
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679263670"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263670"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; m IExpr
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263670"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-147"></span><span>    </span><span class="annot"><span class="annottext">IExpr
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; m IExpr
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="hs-comment">-- iEval' :: (IExpr -&gt; IExpr -&gt; Either RunTimeError IExpr) -&gt; IExpr -&gt; IExpr -&gt; Either RunTimeError IExpr</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- iEval' f env g = let f' = f env in case g of</span><span>
</span><span id="line-151"></span><span class="hs-comment">--   Trace -&gt; pure $ trace (show env) env</span><span>
</span><span id="line-152"></span><span class="hs-comment">--   Zero -&gt; pure Zero</span><span>
</span><span id="line-153"></span><span class="hs-comment">--   -- Abort -&gt; pure Abort</span><span>
</span><span id="line-154"></span><span class="hs-comment">--   Defer x -&gt; pure $ Defer x</span><span>
</span><span id="line-155"></span><span class="hs-comment">--   Pair a b -&gt; Pair &lt;$&gt; f' a &lt;*&gt; f' b</span><span>
</span><span id="line-156"></span><span class="hs-comment">--   Gate a b -&gt; pure $ Gate a b</span><span>
</span><span id="line-157"></span><span class="hs-comment">--   Env -&gt; pure env</span><span>
</span><span id="line-158"></span><span class="hs-comment">--   SetEnv x -&gt; (f' x &gt;&gt;=) $ \case</span><span>
</span><span id="line-159"></span><span class="hs-comment">--     Pair cf nenv -&gt; case cf of</span><span>
</span><span id="line-160"></span><span class="hs-comment">--       Defer c -&gt; f nenv c</span><span>
</span><span id="line-161"></span><span class="hs-comment">--       -- do we change env in evaluation of a/b, or leave it same? change seems more consistent, leave more convenient</span><span>
</span><span id="line-162"></span><span class="hs-comment">--       Gate a b -&gt; case nenv of</span><span>
</span><span id="line-163"></span><span class="hs-comment">--         Zero -&gt; f' a</span><span>
</span><span id="line-164"></span><span class="hs-comment">--         _    -&gt; f' b</span><span>
</span><span id="line-165"></span><span class="hs-comment">--       z -&gt; throwError $ SetEnvError z -- This should never actually occur, because it should be caught by typecheck</span><span>
</span><span id="line-166"></span><span class="hs-comment">--     bx -&gt; throwError $ SetEnvError bx -- This should never actually occur, because it should be caught by typecheck</span><span>
</span><span id="line-167"></span><span class="hs-comment">--   PLeft g -&gt; f' g &gt;&gt;= \case</span><span>
</span><span id="line-168"></span><span class="hs-comment">--     (Pair a _) -&gt; pure a</span><span>
</span><span id="line-169"></span><span class="hs-comment">--     _          -&gt; pure Zero</span><span>
</span><span id="line-170"></span><span class="hs-comment">--   PRight g -&gt; f' g &gt;&gt;= \case</span><span>
</span><span id="line-171"></span><span class="hs-comment">--     (Pair _ x) -&gt; pure x</span><span>
</span><span id="line-172"></span><span class="hs-comment">--     _          -&gt; pure Zero</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Telomare.html#TelomareLike"><span class="hs-identifier hs-type">TelomareLike</span></a></span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-175"></span><span>  </span><span id="local-6989586621679263675"><span class="annot"><span class="annottext">fromTelomare :: IExpr -&gt; IExpr
</span><a href="#local-6989586621679263675"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromTelomare</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-176"></span><span>  </span><span id="local-6989586621679263680"><span class="annot"><span class="annottext">toTelomare :: IExpr -&gt; Maybe IExpr
</span><a href="#local-6989586621679263680"><span class="hs-identifier hs-var hs-var hs-var hs-var">toTelomare</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; Maybe IExpr
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Telomare.html#AbstractRunTime"><span class="hs-identifier hs-type">AbstractRunTime</span></a></span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-comment">-- eval = fix iEval Zero</span><span>
</span><span id="line-180"></span><span>  </span><span id="local-6989586621679263688"><span class="annot"><span class="annottext">eval :: IExpr -&gt; Either RunTimeError IExpr
</span><a href="#local-6989586621679263688"><span class="hs-identifier hs-var hs-var hs-var hs-var">eval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; Either RunTimeError IExpr
forall a. a -&gt; Either RunTimeError a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(IExpr -&gt; Either RunTimeError IExpr)
-&gt; (IExpr -&gt; IExpr) -&gt; IExpr -&gt; Either RunTimeError IExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr -&gt; IExpr
</span><a href="Telomare.RunTime.html#rEval"><span class="hs-identifier hs-var">rEval</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span id="resultIndex"><span class="annot"><span class="annottext">resultIndex :: FragIndex
</span><a href="Telomare.RunTime.html#resultIndex"><span class="hs-identifier hs-var hs-var">resultIndex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; FragIndex
</span><a href="Telomare.html#FragIndex"><span class="hs-identifier hs-var">FragIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Telomare.html#TelomareLike"><span class="hs-identifier hs-type">TelomareLike</span></a></span><span> </span><span class="annot"><a href="Naturals.html#NExprs"><span class="hs-identifier hs-type">NExprs</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-184"></span><span>  </span><span id="local-6989586621679263695"><span class="annot"><span class="annottext">fromTelomare :: IExpr -&gt; NExprs
</span><a href="Telomare.html#fromTelomare"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromTelomare</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map FragIndex NExpr -&gt; NExprs
</span><a href="Naturals.html#NExprs"><span class="hs-identifier hs-var">NExprs</span></a></span><span> </span><span class="annot"><span class="annottext">(Map FragIndex NExpr -&gt; NExprs)
-&gt; (Map FragIndex ExprFrag -&gt; Map FragIndex NExpr)
-&gt; Map FragIndex ExprFrag
-&gt; NExprs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map FragIndex ExprFrag -&gt; Map FragIndex NExpr
</span><a href="Naturals.html#fragsToNExpr"><span class="hs-identifier hs-var">fragsToNExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Map FragIndex ExprFrag -&gt; NExprs)
-&gt; (IExpr -&gt; Map FragIndex ExprFrag) -&gt; IExpr -&gt; NExprs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; Map FragIndex ExprFrag
</span><a href="Naturals.html#fragmentExpr"><span class="hs-identifier hs-var">fragmentExpr</span></a></span><span>
</span><span id="line-185"></span><span>  </span><span id="local-6989586621679263701"><span class="annot"><span class="annottext">toTelomare :: NExprs -&gt; Maybe IExpr
</span><a href="Telomare.html#toTelomare"><span class="hs-identifier hs-var hs-var hs-var hs-var">toTelomare</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NExprs"><span class="hs-identifier hs-type">NExprs</span></a></span><span> </span><span id="local-6989586621679263702"><span class="annot"><span class="annottext">Map FragIndex NExpr
</span><a href="#local-6989586621679263702"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679263718"><span class="annot"><span class="annottext">fromNExpr :: NExpr -&gt; Maybe IExpr
</span><a href="#local-6989586621679263718"><span class="hs-identifier hs-var hs-var">fromNExpr</span></a></span></span><span> </span><span id="local-6989586621679263719"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263719"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263719"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-187"></span><span>          </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NZero"><span class="hs-identifier hs-var">NZero</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; Maybe IExpr
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a></span><span>
</span><span id="line-188"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NPair"><span class="hs-identifier hs-type">NPair</span></a></span><span> </span><span id="local-6989586621679263720"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263720"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679263721"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263721"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr -&gt; IExpr
</span><a href="Telomare.html#Pair"><span class="hs-identifier hs-var">Pair</span></a></span><span> </span><span class="annot"><span class="annottext">(IExpr -&gt; IExpr -&gt; IExpr) -&gt; Maybe IExpr -&gt; Maybe (IExpr -&gt; IExpr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; Maybe IExpr
</span><a href="#local-6989586621679263718"><span class="hs-identifier hs-var">fromNExpr</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263720"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (IExpr -&gt; IExpr) -&gt; Maybe IExpr -&gt; Maybe IExpr
forall a b. Maybe (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; Maybe IExpr
</span><a href="#local-6989586621679263718"><span class="hs-identifier hs-var">fromNExpr</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263721"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-189"></span><span>          </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NEnv"><span class="hs-identifier hs-var">NEnv</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; Maybe IExpr
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="Telomare.html#Env"><span class="hs-identifier hs-var">Env</span></a></span><span>
</span><span id="line-190"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NSetEnv"><span class="hs-identifier hs-type">NSetEnv</span></a></span><span> </span><span id="local-6989586621679263722"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263722"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr
</span><a href="Telomare.html#SetEnv"><span class="hs-identifier hs-var">SetEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(IExpr -&gt; IExpr) -&gt; Maybe IExpr -&gt; Maybe IExpr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; Maybe IExpr
</span><a href="#local-6989586621679263718"><span class="hs-identifier hs-var">fromNExpr</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263722"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-191"></span><span>          </span><span class="annot"><a href="Naturals.html#NGate"><span class="hs-identifier hs-type">NGate</span></a></span><span> </span><span id="local-6989586621679263723"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263723"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679263724"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263724"><span class="hs-identifier hs-var">b</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr -&gt; IExpr
</span><a href="Telomare.html#Gate"><span class="hs-identifier hs-var">Gate</span></a></span><span> </span><span class="annot"><span class="annottext">(IExpr -&gt; IExpr -&gt; IExpr) -&gt; Maybe IExpr -&gt; Maybe (IExpr -&gt; IExpr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; Maybe IExpr
</span><a href="#local-6989586621679263718"><span class="hs-identifier hs-var">fromNExpr</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263723"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (IExpr -&gt; IExpr) -&gt; Maybe IExpr -&gt; Maybe IExpr
forall a b. Maybe (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; Maybe IExpr
</span><a href="#local-6989586621679263718"><span class="hs-identifier hs-var">fromNExpr</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263724"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-192"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NLeft"><span class="hs-identifier hs-type">NLeft</span></a></span><span> </span><span id="local-6989586621679263725"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263725"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr
</span><a href="Telomare.html#PLeft"><span class="hs-identifier hs-var">PLeft</span></a></span><span> </span><span class="annot"><span class="annottext">(IExpr -&gt; IExpr) -&gt; Maybe IExpr -&gt; Maybe IExpr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; Maybe IExpr
</span><a href="#local-6989586621679263718"><span class="hs-identifier hs-var">fromNExpr</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263725"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-193"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NRight"><span class="hs-identifier hs-type">NRight</span></a></span><span> </span><span id="local-6989586621679263726"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263726"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr
</span><a href="Telomare.html#PRight"><span class="hs-identifier hs-var">PRight</span></a></span><span> </span><span class="annot"><span class="annottext">(IExpr -&gt; IExpr) -&gt; Maybe IExpr -&gt; Maybe IExpr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; Maybe IExpr
</span><a href="#local-6989586621679263718"><span class="hs-identifier hs-var">fromNExpr</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263726"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-194"></span><span>          </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NTrace"><span class="hs-identifier hs-var">NTrace</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; Maybe IExpr
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="Telomare.html#Trace"><span class="hs-identifier hs-var">Trace</span></a></span><span>
</span><span id="line-195"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NDefer"><span class="hs-identifier hs-type">NDefer</span></a></span><span> </span><span id="local-6989586621679263727"><span class="annot"><span class="annottext">FragIndex
</span><a href="#local-6989586621679263727"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FragIndex -&gt; Map FragIndex NExpr -&gt; Maybe NExpr
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">FragIndex
</span><a href="#local-6989586621679263727"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Map FragIndex NExpr
</span><a href="#local-6989586621679263702"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NExpr -&gt; (NExpr -&gt; Maybe IExpr) -&gt; Maybe IExpr
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">(IExpr -&gt; IExpr) -&gt; Maybe IExpr -&gt; Maybe IExpr
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr
</span><a href="Telomare.html#Defer"><span class="hs-identifier hs-var">Defer</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe IExpr -&gt; Maybe IExpr)
-&gt; (NExpr -&gt; Maybe IExpr) -&gt; NExpr -&gt; Maybe IExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; Maybe IExpr
</span><a href="#local-6989586621679263718"><span class="hs-identifier hs-var">fromNExpr</span></a></span><span>
</span><span id="line-196"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NOldDefer"><span class="hs-identifier hs-type">NOldDefer</span></a></span><span> </span><span id="local-6989586621679263728"><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263728"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr
</span><a href="Telomare.html#Defer"><span class="hs-identifier hs-var">Defer</span></a></span><span> </span><span class="annot"><span class="annottext">(IExpr -&gt; IExpr) -&gt; Maybe IExpr -&gt; Maybe IExpr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; Maybe IExpr
</span><a href="#local-6989586621679263718"><span class="hs-identifier hs-var">fromNExpr</span></a></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679263728"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-197"></span><span>          </span><span class="annot"><span class="annottext">NExpr
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe IExpr
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">FragIndex -&gt; Map FragIndex NExpr -&gt; Maybe NExpr
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">FragIndex
</span><a href="Telomare.RunTime.html#resultIndex"><span class="hs-identifier hs-var">resultIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Map FragIndex NExpr
</span><a href="#local-6989586621679263702"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe NExpr -&gt; (NExpr -&gt; Maybe IExpr) -&gt; Maybe IExpr
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; Maybe IExpr
</span><a href="#local-6989586621679263718"><span class="hs-identifier hs-var">fromNExpr</span></a></span><span>
</span><span id="line-199"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Telomare.html#AbstractRunTime"><span class="hs-identifier hs-type">AbstractRunTime</span></a></span><span> </span><span class="annot"><a href="Naturals.html#NExprs"><span class="hs-identifier hs-type">NExprs</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-200"></span><span>  </span><span id="local-6989586621679263734"><span class="annot"><span class="annottext">eval :: NExprs -&gt; Either RunTimeError NExprs
</span><a href="Telomare.html#eval"><span class="hs-identifier hs-var hs-var hs-var hs-var">eval</span></a></span></span><span> </span><span id="local-6989586621679263735"><span class="annot"><span class="annottext">x :: NExprs
</span><a href="#local-6989586621679263735"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Naturals.html#NExprs"><span class="hs-identifier hs-type">NExprs</span></a></span><span> </span><span id="local-6989586621679263736"><span class="annot"><span class="annottext">Map FragIndex NExpr
</span><a href="#local-6989586621679263736"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NExprs -&gt; Either RunTimeError NExprs
forall a. a -&gt; Either RunTimeError a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(NExprs -&gt; Either RunTimeError NExprs)
-&gt; (Map FragIndex NExpr -&gt; NExprs)
-&gt; Map FragIndex NExpr
-&gt; Either RunTimeError NExprs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map FragIndex NExpr -&gt; NExprs
</span><a href="Naturals.html#NExprs"><span class="hs-identifier hs-var">NExprs</span></a></span><span> </span><span class="annot"><span class="annottext">(Map FragIndex NExpr -&gt; Either RunTimeError NExprs)
-&gt; Map FragIndex NExpr -&gt; Either RunTimeError NExprs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FragIndex -&gt; NExpr -&gt; Map FragIndex NExpr -&gt; Map FragIndex NExpr
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">FragIndex
</span><a href="Telomare.RunTime.html#resultIndex"><span class="hs-identifier hs-var">resultIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NExprs -&gt; NExpr
</span><a href="Telomare.RunTime.html#nEval"><span class="hs-identifier hs-var">nEval</span></a></span><span> </span><span class="annot"><span class="annottext">NExprs
</span><a href="#local-6989586621679263735"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map FragIndex NExpr
</span><a href="#local-6989586621679263736"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span id="local-6989586621679263295"><span class="annot"><a href="Telomare.RunTime.html#evalAndConvert"><span class="hs-identifier hs-type">evalAndConvert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679263295"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Telomare.html#AbstractRunTime"><span class="hs-identifier hs-type">AbstractRunTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679263295"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679263295"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span></span><span>
</span><span id="line-203"></span><span id="evalAndConvert"><span class="annot"><span class="annottext">evalAndConvert :: forall a. (Show a, AbstractRunTime a) =&gt; a -&gt; IExpr
</span><a href="Telomare.RunTime.html#evalAndConvert"><span class="hs-identifier hs-var hs-var">evalAndConvert</span></a></span></span><span> </span><span id="local-6989586621679263751"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679263751"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe IExpr
forall a. TelomareLike a =&gt; a -&gt; Maybe IExpr
</span><a href="Telomare.html#toTelomare"><span class="hs-identifier hs-var">toTelomare</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Maybe IExpr)
-&gt; Either RunTimeError a -&gt; Either RunTimeError (Maybe IExpr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Either RunTimeError a
</span><a href="#local-6989586621679263752"><span class="hs-identifier hs-var">ar</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-204"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679263753"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263753"><span class="hs-identifier hs-var">ir</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263753"><span class="hs-identifier hs-var">ir</span></a></span><span>
</span><span id="line-205"></span><span>  </span><span class="annot"><span class="annottext">Either RunTimeError (Maybe IExpr)
</span><span class="hs-identifier">_</span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IExpr) -&gt; (String -&gt; String) -&gt; String -&gt; IExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RunTimeError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(RunTimeError -&gt; String)
-&gt; (String -&gt; RunTimeError) -&gt; String -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; RunTimeError
</span><a href="Telomare.html#ResultConversionError"><span class="hs-identifier hs-var">ResultConversionError</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IExpr) -&gt; String -&gt; IExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Either RunTimeError a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Either RunTimeError a
</span><a href="#local-6989586621679263752"><span class="hs-identifier hs-var">ar</span></a></span><span>
</span><span id="line-206"></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679263752"><span class="annot"><span class="annottext">ar :: Either RunTimeError a
</span><a href="#local-6989586621679263752"><span class="hs-identifier hs-var hs-var">ar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Either RunTimeError a
forall a. AbstractRunTime a =&gt; a -&gt; Either RunTimeError a
</span><a href="Telomare.html#eval"><span class="hs-identifier hs-var">eval</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679263751"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span id="local-6989586621679263300"><span class="annot"><a href="Telomare.RunTime.html#evalAndConvert%27"><span class="hs-identifier hs-type">evalAndConvert'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679263300"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Telomare.html#AbstractRunTime"><span class="hs-identifier hs-type">AbstractRunTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679263300"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679263300"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Telomare.html#RunTimeError"><span class="hs-identifier hs-type">RunTimeError</span></a></span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span></span><span>
</span><span id="line-209"></span><span id="evalAndConvert%27"><span class="annot"><span class="annottext">evalAndConvert' :: forall a.
(Show a, AbstractRunTime a) =&gt;
a -&gt; Either RunTimeError IExpr
</span><a href="Telomare.RunTime.html#evalAndConvert%27"><span class="hs-identifier hs-var hs-var">evalAndConvert'</span></a></span></span><span> </span><span id="local-6989586621679263765"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679263765"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe IExpr
forall a. TelomareLike a =&gt; a -&gt; Maybe IExpr
</span><a href="Telomare.html#toTelomare"><span class="hs-identifier hs-var">toTelomare</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Maybe IExpr)
-&gt; Either RunTimeError a -&gt; Either RunTimeError (Maybe IExpr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Either RunTimeError a
</span><a href="#local-6989586621679263766"><span class="hs-identifier hs-var">ar</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679263767"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263767"><span class="hs-identifier hs-var">ir</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; Either RunTimeError IExpr
forall a. a -&gt; Either RunTimeError a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263767"><span class="hs-identifier hs-var">ir</span></a></span><span>
</span><span id="line-211"></span><span>  </span><span class="annot"><span class="annottext">Either RunTimeError (Maybe IExpr)
</span><span class="hs-identifier">_</span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RunTimeError -&gt; Either RunTimeError IExpr
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(RunTimeError -&gt; Either RunTimeError IExpr)
-&gt; (String -&gt; RunTimeError) -&gt; String -&gt; Either RunTimeError IExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; RunTimeError
</span><a href="Telomare.html#ResultConversionError"><span class="hs-identifier hs-var">ResultConversionError</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either RunTimeError IExpr)
-&gt; String -&gt; Either RunTimeError IExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Either RunTimeError a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Either RunTimeError a
</span><a href="#local-6989586621679263766"><span class="hs-identifier hs-var">ar</span></a></span><span>
</span><span id="line-212"></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679263766"><span class="annot"><span class="annottext">ar :: Either RunTimeError a
</span><a href="#local-6989586621679263766"><span class="hs-identifier hs-var hs-var">ar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Either RunTimeError a
forall a. AbstractRunTime a =&gt; a -&gt; Either RunTimeError a
</span><a href="Telomare.html#eval"><span class="hs-identifier hs-var">eval</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679263765"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="annot"><span class="hs-comment">-- |Evaluation with hvm backend</span></span><span>
</span><span id="line-215"></span><span class="annot"><a href="Telomare.RunTime.html#hvmEval"><span class="hs-identifier hs-type">hvmEval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span>
</span><span id="line-216"></span><span id="hvmEval"><span class="annot"><span class="annottext">hvmEval :: IExpr -&gt; IO IExpr
</span><a href="Telomare.RunTime.html#hvmEval"><span class="hs-identifier hs-var hs-var">hvmEval</span></a></span></span><span> </span><span id="local-6989586621679263771"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263771"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679263772"><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679263772"><span class="hs-identifier hs-var">mhout</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ProcessHandle
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CreateProcess
-&gt; IO (Maybe Handle, Maybe Handle, Maybe Handle, ProcessHandle)
</span><span class="hs-identifier hs-var">createProcess</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; CreateProcess
</span><span class="hs-identifier hs-var">shell</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;hvm r ./hvm/backend \&quot;(&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263771"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)\&quot;&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">std_out</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CreatePipe</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Handle
</span><a href="#local-6989586621679263772"><span class="hs-identifier hs-var">mhout</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-219"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679263773"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679263773"><span class="hs-identifier hs-var">hout</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-220"></span><span>      </span><span id="local-6989586621679263774"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679263774"><span class="hs-identifier hs-var">hvmOutput</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO String
</span><span class="hs-identifier hs-var">hGetContents</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679263773"><span class="hs-identifier hs-var">hout</span></a></span><span>
</span><span id="line-221"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[String] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; Int) -&gt; (String -&gt; [String]) -&gt; String -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><span class="hs-identifier hs-var">lines</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Int) -&gt; String -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679263774"><span class="hs-identifier hs-var">hvmOutput</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-222"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe IExpr
forall a. Read a =&gt; String -&gt; Maybe a
</span><span class="hs-identifier hs-var">readMaybe</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Maybe IExpr)
-&gt; (String -&gt; String) -&gt; String -&gt; Maybe IExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unlines</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; String) -&gt; (String -&gt; [String]) -&gt; String -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [String] -&gt; [String]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [String])
-&gt; (String -&gt; [String]) -&gt; String -&gt; [String]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><span class="hs-identifier hs-var">lines</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Maybe IExpr) -&gt; String -&gt; Maybe IExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679263774"><span class="hs-identifier hs-var">hvmOutput</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-223"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679263780"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263780"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IO IExpr
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263780"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-224"></span><span>          </span><span class="annot"><span class="annottext">Maybe IExpr
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO IExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO IExpr) -&gt; String -&gt; IO IExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Error: fail to read hvm output. \nhvm output:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679263774"><span class="hs-identifier hs-var">hvmOutput</span></a></span><span>
</span><span id="line-225"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO IExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO IExpr) -&gt; String -&gt; IO IExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Error: hvm output is not what was expected. \nhvm output: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679263774"><span class="hs-identifier hs-var">hvmOutput</span></a></span><span>
</span><span id="line-226"></span><span>      </span><span class="annot"><span class="annottext">IExpr -&gt; IO IExpr
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(IExpr -&gt; IO IExpr) -&gt; (String -&gt; IExpr) -&gt; String -&gt; IO IExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IExpr
forall a. Read a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">read</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IExpr) -&gt; (String -&gt; String) -&gt; String -&gt; IExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unlines</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; String) -&gt; (String -&gt; [String]) -&gt; String -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [String] -&gt; [String]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [String])
-&gt; (String -&gt; [String]) -&gt; String -&gt; [String]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><span class="hs-identifier hs-var">lines</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO IExpr) -&gt; String -&gt; IO IExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679263774"><span class="hs-identifier hs-var">hvmOutput</span></a></span><span>
</span><span id="line-227"></span><span>    </span><span class="annot"><span class="annottext">Maybe Handle
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO IExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO IExpr) -&gt; String -&gt; IO IExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Error: hvm failed to produce output. \nIExpr fed to hvm:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263771"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="annot"><a href="Telomare.RunTime.html#simpleEval"><span class="hs-identifier hs-type">simpleEval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span>
</span><span id="line-230"></span><span id="simpleEval"><span class="annot"><span class="annottext">simpleEval :: IExpr -&gt; IO IExpr
</span><a href="Telomare.RunTime.html#simpleEval"><span class="hs-identifier hs-var hs-var">simpleEval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either RunTimeError IExpr -&gt; IO IExpr
</span><a href="#local-6989586621679263783"><span class="hs-identifier hs-var">fe</span></a></span><span> </span><span class="annot"><span class="annottext">(Either RunTimeError IExpr -&gt; IO IExpr)
-&gt; (IExpr -&gt; Either RunTimeError IExpr) -&gt; IExpr -&gt; IO IExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; Either RunTimeError IExpr
forall a. AbstractRunTime a =&gt; a -&gt; Either RunTimeError a
</span><a href="Telomare.html#eval"><span class="hs-identifier hs-var">eval</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-231"></span><span>  </span><span id="local-6989586621679263783"><span class="annot"><span class="annottext">fe :: Either RunTimeError IExpr -&gt; IO IExpr
</span><a href="#local-6989586621679263783"><span class="hs-identifier hs-var hs-var">fe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-232"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679263789"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263789"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IO IExpr
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263789"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-233"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679263790"><span class="annot"><span class="annottext">RunTimeError
</span><a href="#local-6989586621679263790"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-234"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runtime error: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">RunTimeError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">RunTimeError
</span><a href="#local-6989586621679263790"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-235"></span><span>      </span><span class="annot"><span class="annottext">IExpr -&gt; IO IExpr
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="annot"><a href="Telomare.RunTime.html#fastInterpretEval"><span class="hs-identifier hs-type">fastInterpretEval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span>
</span><span id="line-238"></span><span id="fastInterpretEval"><span class="annot"><span class="annottext">fastInterpretEval :: IExpr -&gt; IO IExpr
</span><a href="Telomare.RunTime.html#fastInterpretEval"><span class="hs-identifier hs-var hs-var">fastInterpretEval</span></a></span></span><span> </span><span id="local-6989586621679263793"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263793"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679263795"><span class="annot"><span class="annottext">traceShow :: NExprs -&gt; NExprs
</span><a href="#local-6989586621679263795"><span class="hs-identifier hs-var hs-var">traceShow</span></a></span></span><span> </span><span id="local-6989586621679263796"><span class="annot"><span class="annottext">NExprs
</span><a href="#local-6989586621679263796"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="Telomare.RunTime.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; NExprs -&gt; NExprs
forall a. String -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">trace</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;toNExpr\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">NExprs -&gt; String
</span><a href="PrettyPrint.html#showNExprs"><span class="hs-identifier hs-var">showNExprs</span></a></span><span> </span><span class="annot"><span class="annottext">NExprs
</span><a href="#local-6989586621679263796"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NExprs
</span><a href="#local-6989586621679263796"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">NExprs
</span><a href="#local-6989586621679263796"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-240"></span><span>      </span><span class="annot"><a href="#local-6989586621679263797"><span class="hs-identifier hs-type">nExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Naturals.html#NExprs"><span class="hs-identifier hs-type">NExprs</span></a></span><span>
</span><span id="line-241"></span><span>      </span><span id="local-6989586621679263797"><span class="annot"><span class="annottext">nExpr :: NExprs
</span><a href="#local-6989586621679263797"><span class="hs-identifier hs-var hs-var">nExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NExprs -&gt; NExprs
</span><a href="#local-6989586621679263795"><span class="hs-identifier hs-var">traceShow</span></a></span><span> </span><span class="annot"><span class="annottext">(NExprs -&gt; NExprs) -&gt; NExprs -&gt; NExprs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; NExprs
forall a. TelomareLike a =&gt; IExpr -&gt; a
</span><a href="Telomare.html#fromTelomare"><span class="hs-identifier hs-var">fromTelomare</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263793"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-242"></span><span>  </span><span class="annot"><span class="annottext">IExpr -&gt; IO IExpr
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(IExpr -&gt; IO IExpr) -&gt; (NExprs -&gt; IExpr) -&gt; NExprs -&gt; IO IExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NExprs -&gt; IExpr
forall a. (Show a, AbstractRunTime a) =&gt; a -&gt; IExpr
</span><a href="Telomare.RunTime.html#evalAndConvert"><span class="hs-identifier hs-var">evalAndConvert</span></a></span><span> </span><span class="annot"><span class="annottext">(NExprs -&gt; IO IExpr) -&gt; NExprs -&gt; IO IExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NExprs
</span><a href="#local-6989586621679263797"><span class="hs-identifier hs-var">nExpr</span></a></span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-comment">-- case result of</span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-comment">--   Left e  -&gt; error (&quot;runtime error: &quot; &lt;&gt; show e)</span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-comment">--   Right r -&gt; pure r</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="hs-comment">{- commenting out until fixed
llvmEval :: NExpr -&gt; IO LLVM.RunResult
llvmEval nexpr = do
  let lmod = LLVM.makeModule nexpr
  when debug $ do
    print $ LLVM.DebugModule lmod
    putStrLn . concat . replicate 100 $ &quot;                                                                     \n&quot;
  result &lt;- catch (LLVM.evalJIT LLVM.defaultJITConfig lmod) $ \(e :: SomeException) -&gt; pure . Left $ show e
  case result of
    Left s -&gt; do
      hPrint stderr nexpr
      hPutStrLn stderr $ &quot;failed llvmEval: &quot; ++ s
      fail s
    Right x -&gt; pure x
-}</span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span class="annot"><a href="Telomare.RunTime.html#optimizedEval"><span class="hs-identifier hs-type">optimizedEval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span>
</span><span id="line-264"></span><span id="optimizedEval"><span class="annot"><span class="annottext">optimizedEval :: IExpr -&gt; IO IExpr
</span><a href="Telomare.RunTime.html#optimizedEval"><span class="hs-identifier hs-var hs-var">optimizedEval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IO IExpr
</span><a href="Telomare.RunTime.html#fastInterpretEval"><span class="hs-identifier hs-var">fastInterpretEval</span></a></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span class="annot"><a href="Telomare.RunTime.html#pureIEval"><span class="hs-identifier hs-type">pureIEval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Telomare.html#RunTimeError"><span class="hs-identifier hs-type">RunTimeError</span></a></span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span>
</span><span id="line-267"></span><span id="pureIEval"><span class="annot"><span class="annottext">pureIEval :: IExpr -&gt; Either RunTimeError IExpr
</span><a href="Telomare.RunTime.html#pureIEval"><span class="hs-identifier hs-var hs-var">pureIEval</span></a></span></span><span> </span><span id="local-6989586621679263800"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263800"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identity (Either RunTimeError IExpr) -&gt; Either RunTimeError IExpr
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity (Either RunTimeError IExpr) -&gt; Either RunTimeError IExpr)
-&gt; (ExceptT RunTimeError Identity IExpr
    -&gt; Identity (Either RunTimeError IExpr))
-&gt; ExceptT RunTimeError Identity IExpr
-&gt; Either RunTimeError IExpr
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ExceptT RunTimeError Identity IExpr
-&gt; Identity (Either RunTimeError IExpr)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT RunTimeError Identity IExpr -&gt; Either RunTimeError IExpr)
-&gt; ExceptT RunTimeError Identity IExpr -&gt; Either RunTimeError IExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((IExpr -&gt; IExpr -&gt; ExceptT RunTimeError Identity IExpr)
 -&gt; IExpr -&gt; IExpr -&gt; ExceptT RunTimeError Identity IExpr)
-&gt; IExpr -&gt; IExpr -&gt; ExceptT RunTimeError Identity IExpr
forall a. (a -&gt; a) -&gt; a
</span><span class="hs-identifier hs-var">fix</span></span><span> </span><span class="annot"><span class="annottext">(IExpr -&gt; IExpr -&gt; ExceptT RunTimeError Identity IExpr)
-&gt; IExpr -&gt; IExpr -&gt; ExceptT RunTimeError Identity IExpr
forall (m :: * -&gt; *).
MonadError RunTimeError m =&gt;
(IExpr -&gt; IExpr -&gt; m IExpr) -&gt; IExpr -&gt; IExpr -&gt; m IExpr
</span><a href="Telomare.RunTime.html#iEval"><span class="hs-identifier hs-var">iEval</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263800"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-comment">-- this is the original version</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="annot"><a href="Telomare.RunTime.html#pureEval"><span class="hs-identifier hs-type">pureEval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span>
</span><span id="line-270"></span><span id="pureEval"><span class="annot"><span class="annottext">pureEval :: IExpr -&gt; IExpr
</span><a href="Telomare.RunTime.html#pureEval"><span class="hs-identifier hs-var hs-var">pureEval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr -&gt; IExpr
</span><a href="Telomare.RunTime.html#rEval"><span class="hs-identifier hs-var">rEval</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span id="local-6989586621679263319"><span id="local-6989586621679263320"><span class="annot"><a href="Telomare.RunTime.html#showPass"><span class="hs-identifier hs-type">showPass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679263319"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679263320"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679263320"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679263319"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679263320"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679263319"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-273"></span><span id="showPass"><span class="annot"><span class="annottext">showPass :: forall a (m :: * -&gt; *). (Show a, MonadIO m) =&gt; m a -&gt; m a
</span><a href="Telomare.RunTime.html#showPass"><span class="hs-identifier hs-var hs-var">showPass</span></a></span></span><span> </span><span id="local-6989586621679263814"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679263814"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679263814"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; (a -&gt; m ()) -&gt; m ()
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; (a -&gt; IO ()) -&gt; a -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; IO ()
forall a. Show a =&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">print</span></span><span> </span><span class="annot"><span class="annottext">m () -&gt; m a -&gt; m a
forall a b. m a -&gt; m b -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679263814"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="annot"><a href="Telomare.RunTime.html#tEval"><span class="hs-identifier hs-type">tEval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span>
</span><span id="line-276"></span><span id="tEval"><span class="annot"><span class="annottext">tEval :: IExpr -&gt; IO IExpr
</span><a href="Telomare.RunTime.html#tEval"><span class="hs-identifier hs-var hs-var">tEval</span></a></span></span><span> </span><span id="local-6989586621679263817"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263817"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExceptT RunTimeError IO IExpr -&gt; IO (Either RunTimeError IExpr)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((IExpr -&gt; IExpr -&gt; ExceptT RunTimeError IO IExpr)
 -&gt; IExpr -&gt; IExpr -&gt; ExceptT RunTimeError IO IExpr)
-&gt; IExpr -&gt; IExpr -&gt; ExceptT RunTimeError IO IExpr
forall a. (a -&gt; a) -&gt; a
</span><span class="hs-identifier hs-var">fix</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679263818"><span class="annot"><span class="annottext">IExpr -&gt; IExpr -&gt; ExceptT RunTimeError IO IExpr
</span><a href="#local-6989586621679263818"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679263819"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263819"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679263820"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263820"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExceptT RunTimeError IO IExpr -&gt; ExceptT RunTimeError IO IExpr
forall a (m :: * -&gt; *). (Show a, MonadIO m) =&gt; m a -&gt; m a
</span><a href="Telomare.RunTime.html#showPass"><span class="hs-identifier hs-var">showPass</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT RunTimeError IO IExpr -&gt; ExceptT RunTimeError IO IExpr)
-&gt; ExceptT RunTimeError IO IExpr -&gt; ExceptT RunTimeError IO IExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(IExpr -&gt; IExpr -&gt; ExceptT RunTimeError IO IExpr)
-&gt; IExpr -&gt; IExpr -&gt; ExceptT RunTimeError IO IExpr
forall (m :: * -&gt; *).
MonadError RunTimeError m =&gt;
(IExpr -&gt; IExpr -&gt; m IExpr) -&gt; IExpr -&gt; IExpr -&gt; m IExpr
</span><a href="Telomare.RunTime.html#iEval"><span class="hs-identifier hs-var">iEval</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr -&gt; ExceptT RunTimeError IO IExpr
</span><a href="#local-6989586621679263818"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263819"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263820"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263817"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO (Either RunTimeError IExpr)
-&gt; (Either RunTimeError IExpr -&gt; IO IExpr) -&gt; IO IExpr
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-277"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679263821"><span class="annot"><span class="annottext">RunTimeError
</span><a href="#local-6989586621679263821"><span class="hs-identifier hs-var">e</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO IExpr
forall a. String -&gt; IO a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RunTimeError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">RunTimeError
</span><a href="#local-6989586621679263821"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679263822"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263822"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IO IExpr
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263822"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span class="annot"><a href="Telomare.RunTime.html#typedEval"><span class="hs-identifier hs-type">typedEval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Telomare.html#DataType"><span class="hs-identifier hs-type">DataType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span id="typedEval"><span class="annot"><span class="annottext">typedEval :: (IExpr -&gt; DataType -&gt; Bool) -&gt; IExpr -&gt; (IExpr -&gt; IO ()) -&gt; IO ()
</span><a href="Telomare.RunTime.html#typedEval"><span class="hs-identifier hs-var hs-var">typedEval</span></a></span></span><span> </span><span id="local-6989586621679263824"><span class="annot"><span class="annottext">IExpr -&gt; DataType -&gt; Bool
</span><a href="#local-6989586621679263824"><span class="hs-identifier hs-var">typeCheck</span></a></span></span><span> </span><span id="local-6989586621679263825"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263825"><span class="hs-identifier hs-var">iexpr</span></a></span></span><span> </span><span id="local-6989586621679263826"><span class="annot"><span class="annottext">IExpr -&gt; IO ()
</span><a href="#local-6989586621679263826"><span class="hs-identifier hs-var">prettyPrint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; DataType -&gt; Bool
</span><a href="#local-6989586621679263824"><span class="hs-identifier hs-var">typeCheck</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263825"><span class="hs-identifier hs-var">iexpr</span></a></span><span> </span><span class="annot"><span class="annottext">DataType
</span><a href="Telomare.html#ZeroType"><span class="hs-identifier hs-var">ZeroType</span></a></span><span>
</span><span id="line-282"></span><span>  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IO IExpr
</span><a href="Telomare.RunTime.html#simpleEval"><span class="hs-identifier hs-var">simpleEval</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263825"><span class="hs-identifier hs-var">iexpr</span></a></span><span> </span><span class="annot"><span class="annottext">IO IExpr -&gt; (IExpr -&gt; IO ()) -&gt; IO ()
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IO ()
</span><a href="#local-6989586621679263826"><span class="hs-identifier hs-var">prettyPrint</span></a></span><span>
</span><span id="line-283"></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;failed typecheck&quot;</span></span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span class="annot"><a href="Telomare.RunTime.html#debugEval"><span class="hs-identifier hs-type">debugEval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Telomare.html#DataType"><span class="hs-identifier hs-type">DataType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span id="debugEval"><span class="annot"><span class="annottext">debugEval :: (IExpr -&gt; DataType -&gt; Bool) -&gt; IExpr -&gt; IO ()
</span><a href="Telomare.RunTime.html#debugEval"><span class="hs-identifier hs-var hs-var">debugEval</span></a></span></span><span> </span><span id="local-6989586621679263829"><span class="annot"><span class="annottext">IExpr -&gt; DataType -&gt; Bool
</span><a href="#local-6989586621679263829"><span class="hs-identifier hs-var">typeCheck</span></a></span></span><span> </span><span id="local-6989586621679263830"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263830"><span class="hs-identifier hs-var">iexpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; DataType -&gt; Bool
</span><a href="#local-6989586621679263829"><span class="hs-identifier hs-var">typeCheck</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263830"><span class="hs-identifier hs-var">iexpr</span></a></span><span> </span><span class="annot"><span class="annottext">DataType
</span><a href="Telomare.html#ZeroType"><span class="hs-identifier hs-var">ZeroType</span></a></span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IO IExpr
</span><a href="Telomare.RunTime.html#tEval"><span class="hs-identifier hs-var">tEval</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263830"><span class="hs-identifier hs-var">iexpr</span></a></span><span> </span><span class="annot"><span class="annottext">IO IExpr -&gt; (IExpr -&gt; IO ()) -&gt; IO ()
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">PrettyIExpr -&gt; IO ()
forall a. Show a =&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">print</span></span><span> </span><span class="annot"><span class="annottext">(PrettyIExpr -&gt; IO ()) -&gt; (IExpr -&gt; PrettyIExpr) -&gt; IExpr -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; PrettyIExpr
</span><a href="PrettyPrint.html#PrettyIExpr"><span class="hs-identifier hs-var">PrettyIExpr</span></a></span><span>
</span><span id="line-288"></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;failed typecheck&quot;</span></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span id="fullEval"><span class="annot"><span class="annottext">fullEval :: (IExpr -&gt; DataType -&gt; Bool) -&gt; IExpr -&gt; IO ()
</span><a href="Telomare.RunTime.html#fullEval"><span class="hs-identifier hs-var hs-var">fullEval</span></a></span></span><span> </span><span id="local-6989586621679263833"><span class="annot"><span class="annottext">IExpr -&gt; DataType -&gt; Bool
</span><a href="#local-6989586621679263833"><span class="hs-identifier hs-var">typeCheck</span></a></span></span><span> </span><span id="local-6989586621679263834"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263834"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IExpr -&gt; DataType -&gt; Bool) -&gt; IExpr -&gt; (IExpr -&gt; IO ()) -&gt; IO ()
</span><a href="Telomare.RunTime.html#typedEval"><span class="hs-identifier hs-var">typedEval</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; DataType -&gt; Bool
</span><a href="#local-6989586621679263833"><span class="hs-identifier hs-var">typeCheck</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263834"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IO ()
forall a. Show a =&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">print</span></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span id="prettyEval"><span class="annot"><span class="annottext">prettyEval :: (IExpr -&gt; DataType -&gt; Bool) -&gt; IExpr -&gt; IO ()
</span><a href="Telomare.RunTime.html#prettyEval"><span class="hs-identifier hs-var hs-var">prettyEval</span></a></span></span><span> </span><span id="local-6989586621679263837"><span class="annot"><span class="annottext">IExpr -&gt; DataType -&gt; Bool
</span><a href="#local-6989586621679263837"><span class="hs-identifier hs-var">typeCheck</span></a></span></span><span> </span><span id="local-6989586621679263838"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263838"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IExpr -&gt; DataType -&gt; Bool) -&gt; IExpr -&gt; (IExpr -&gt; IO ()) -&gt; IO ()
</span><a href="Telomare.RunTime.html#typedEval"><span class="hs-identifier hs-var">typedEval</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; DataType -&gt; Bool
</span><a href="#local-6989586621679263837"><span class="hs-identifier hs-var">typeCheck</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263838"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyIExpr -&gt; IO ()
forall a. Show a =&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">print</span></span><span> </span><span class="annot"><span class="annottext">(PrettyIExpr -&gt; IO ()) -&gt; (IExpr -&gt; PrettyIExpr) -&gt; IExpr -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; PrettyIExpr
</span><a href="PrettyPrint.html#PrettyIExpr"><span class="hs-identifier hs-var">PrettyIExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span class="annot"><a href="Telomare.RunTime.html#verifyEval"><span class="hs-identifier hs-type">verifyEval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span id="verifyEval"><span class="annot"><span class="annottext">verifyEval :: IExpr -&gt; IO (Maybe (IExpr, IExpr))
</span><a href="Telomare.RunTime.html#verifyEval"><span class="hs-identifier hs-var hs-var">verifyEval</span></a></span></span><span> </span><span id="local-6989586621679263840"><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263840"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679263841"><span class="hs-identifier hs-type">nexpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Naturals.html#NExprs"><span class="hs-identifier hs-type">NExprs</span></a></span><span>
</span><span id="line-297"></span><span>      </span><span id="local-6989586621679263841"><span class="annot"><span class="annottext">nexpr :: NExprs
</span><a href="#local-6989586621679263841"><span class="hs-identifier hs-var hs-var">nexpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; NExprs
forall a. TelomareLike a =&gt; IExpr -&gt; a
</span><a href="Telomare.html#fromTelomare"><span class="hs-identifier hs-var">fromTelomare</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263840"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-298"></span><span>      </span><span id="local-6989586621679263844"><span class="annot"><span class="annottext">iResult :: IExpr
</span><a href="#local-6989586621679263844"><span class="hs-identifier hs-var hs-var">iResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr
forall a. (Show a, AbstractRunTime a) =&gt; a -&gt; IExpr
</span><a href="Telomare.RunTime.html#evalAndConvert"><span class="hs-identifier hs-var">evalAndConvert</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263840"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-299"></span><span>      </span><span id="local-6989586621679263847"><span class="annot"><span class="annottext">nResult :: IExpr
</span><a href="#local-6989586621679263847"><span class="hs-identifier hs-var hs-var">nResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NExprs -&gt; IExpr
forall a. (Show a, AbstractRunTime a) =&gt; a -&gt; IExpr
</span><a href="Telomare.RunTime.html#evalAndConvert"><span class="hs-identifier hs-var">evalAndConvert</span></a></span><span> </span><span class="annot"><span class="annottext">NExprs
</span><a href="#local-6989586621679263841"><span class="hs-identifier hs-var">nexpr</span></a></span><span>
</span><span id="line-300"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263844"><span class="hs-identifier hs-var">iResult</span></a></span><span> </span><span class="annot"><span class="annottext">IExpr -&gt; IExpr -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263847"><span class="hs-identifier hs-var">nResult</span></a></span><span>
</span><span id="line-301"></span><span>     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe (IExpr, IExpr) -&gt; IO (Maybe (IExpr, IExpr))
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (IExpr, IExpr)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-302"></span><span>     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe (IExpr, IExpr) -&gt; IO (Maybe (IExpr, IExpr))
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (IExpr, IExpr) -&gt; IO (Maybe (IExpr, IExpr)))
-&gt; Maybe (IExpr, IExpr) -&gt; IO (Maybe (IExpr, IExpr))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(IExpr, IExpr) -&gt; Maybe (IExpr, IExpr)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263844"><span class="hs-identifier hs-var">iResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IExpr
</span><a href="#local-6989586621679263847"><span class="hs-identifier hs-var">nResult</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span id="testNEval"><span class="annot"><span class="annottext">testNEval :: IExpr -&gt; Either RunTimeError NExprs
</span><a href="Telomare.RunTime.html#testNEval"><span class="hs-identifier hs-var hs-var">testNEval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NExprs -&gt; Either RunTimeError NExprs
forall a. AbstractRunTime a =&gt; a -&gt; Either RunTimeError a
</span><a href="Telomare.html#eval"><span class="hs-identifier hs-var">eval</span></a></span><span> </span><span class="annot"><span class="annottext">(NExprs -&gt; Either RunTimeError NExprs)
-&gt; (IExpr -&gt; NExprs) -&gt; IExpr -&gt; Either RunTimeError NExprs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IExpr -&gt; NExprs
forall a. TelomareLike a =&gt; IExpr -&gt; a
</span><a href="Telomare.html#fromTelomare"><span class="hs-identifier hs-var">fromTelomare</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Naturals.html#NExprs"><span class="hs-identifier hs-type">NExprs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span></pre></body></html>