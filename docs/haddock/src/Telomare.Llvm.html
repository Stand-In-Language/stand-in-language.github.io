<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_GHC -Wall -Wno-name-shadowing #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings   #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RecursiveDo         #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Telomare.Llvm</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.State.Strict</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Crypto.Hash</span></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Digest</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SHA256</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">hashlazy</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Binary</span></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">encode</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteArray</span></span><span>              </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BA</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unpack</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span>             </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Base16</span></span><span>      </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Base16</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span>       </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BSC</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span>        </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BSL</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.ByteString.Short</span></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toShort</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Int</span></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Int64</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span>             </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.String</span></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromString</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Foreign.Ptr</span></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">FunPtr</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">IntPtr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Ptr</span></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>                                              </span><span class="annot"><span class="hs-identifier">WordPtr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">castPtrToFunPtr</span></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>                                              </span><span class="annot"><span class="hs-identifier">intPtrToPtr</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">plusPtr</span></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>                                              </span><span class="annot"><span class="hs-identifier">wordPtrToPtr</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Foreign.Storable</span></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">peek</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.Clock</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.IO</span></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hPutStrLn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">stderr</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Text.Printf</span></span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">LLVM.AST</span></span><span>                    </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Monotonic</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">LLVM.AST.Global</span></span><span>             </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">G</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">LLVM.Context</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">LLVM.IRBuilder.Constant</span></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">int64</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">LLVM.IRBuilder.Module</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">LLVM.IRBuilder.Monad</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">LLVM.Module</span></span><span>                 </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Mod</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">LLVM.PassManager</span></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">LLVM.AST</span></span><span>                    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">AST</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">LLVM.AST.AddrSpace</span></span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">AddrSpace</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">LLVM.AST.Constant</span></span><span>           </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">LLVM.AST.IntegerPredicate</span></span><span>   </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IP</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">LLVM.AST.ParameterAttribute</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PA</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">LLVM.AST.Type</span></span><span>               </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">LLVM.CodeGenOpt</span></span><span>             </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CodeGenOpt</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">LLVM.CodeModel</span></span><span>              </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CodeModel</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">LLVM.IRBuilder.Instruction</span></span><span>  </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IRI</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">LLVM.IRBuilder.Module</span></span><span>       </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IRM</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">LLVM.Linking</span></span><span>                </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Linking</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">LLVM.OrcJIT</span></span><span>                 </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OJ</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">LLVM.OrcJIT.CompileLayer</span></span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OJ</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">LLVM.Relocation</span></span><span>             </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Reloc</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">LLVM.Target</span></span><span>                 </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Target</span></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Naturals.html"><span class="hs-identifier">Naturals</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Telomare.html"><span class="hs-identifier">Telomare</span></a></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.html#FragIndex"><span class="hs-identifier">FragIndex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-string">&quot;dynamic&quot;</span></span><span> </span><span id="haskFun"><span class="annot"><a href="Telomare.Llvm.html#haskFun"><span class="hs-identifier hs-var">haskFun</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FunPtr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-keyword">data</span><span> </span><span id="RunResult"><span class="annot"><a href="Telomare.Llvm.html#RunResult"><span class="hs-identifier hs-var">RunResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RunResult"><span class="annot"><a href="Telomare.Llvm.html#RunResult"><span class="hs-identifier hs-var">RunResult</span></a></span></span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="resultValue"><span class="annot"><span class="annottext">RunResult -&gt; Int64
</span><a href="Telomare.Llvm.html#resultValue"><span class="hs-identifier hs-var hs-var">resultValue</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="resultNumPairs"><span class="annot"><span class="annottext">RunResult -&gt; Int64
</span><a href="Telomare.Llvm.html#resultNumPairs"><span class="hs-identifier hs-var hs-var">resultNumPairs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="annot"><a href="Telomare.Llvm.html#run"><span class="hs-identifier hs-type">run</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Telomare.Llvm.html#JITConfig"><span class="hs-identifier hs-type">JITConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WordPtr</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Telomare.Llvm.html#RunResult"><span class="hs-identifier hs-type">RunResult</span></a></span><span>
</span><span id="line-67"></span><span id="run"><span class="annot"><span class="annottext">run :: JITConfig -&gt; WordPtr -&gt; IO RunResult
</span><a href="Telomare.Llvm.html#run"><span class="hs-identifier hs-var hs-var">run</span></a></span></span><span> </span><span id="local-6989586621679441988"><span class="annot"><span class="annottext">jitConfig :: JITConfig
</span><a href="#local-6989586621679441988"><span class="hs-identifier hs-var">jitConfig</span></a></span></span><span> </span><span id="local-6989586621679441987"><span class="annot"><span class="annottext">fn :: WordPtr
</span><a href="#local-6989586621679441987"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><a href="#local-6989586621679441986"><span class="hs-identifier hs-type">mungedPtr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FunPtr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>    </span><span id="local-6989586621679441986"><span class="annot"><span class="annottext">mungedPtr :: FunPtr (IO (Ptr Int64))
</span><a href="#local-6989586621679441986"><span class="hs-identifier hs-var hs-var">mungedPtr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr Any -&gt; FunPtr (IO (Ptr Int64))
forall a b. Ptr a -&gt; FunPtr b
</span><span class="hs-identifier hs-var">castPtrToFunPtr</span></span><span> </span><span class="annot"><span class="annottext">(Ptr Any -&gt; FunPtr (IO (Ptr Int64)))
-&gt; (WordPtr -&gt; Ptr Any) -&gt; WordPtr -&gt; FunPtr (IO (Ptr Int64))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">WordPtr -&gt; Ptr Any
forall a. WordPtr -&gt; Ptr a
</span><span class="hs-identifier hs-var">wordPtrToPtr</span></span><span> </span><span class="annot"><span class="annottext">(WordPtr -&gt; FunPtr (IO (Ptr Int64)))
-&gt; WordPtr -&gt; FunPtr (IO (Ptr Int64))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WordPtr
</span><a href="#local-6989586621679441987"><span class="hs-identifier hs-var">fn</span></a></span><span>
</span><span id="line-71"></span><span>  </span><span id="local-6989586621679441984"><span class="annot"><span class="annottext">Ptr Int64
</span><a href="#local-6989586621679441984"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FunPtr (IO (Ptr Int64)) -&gt; IO (Ptr Int64)
</span><a href="Telomare.Llvm.html#haskFun"><span class="hs-identifier hs-var">haskFun</span></a></span><span> </span><span class="annot"><span class="annottext">FunPtr (IO (Ptr Int64))
</span><a href="#local-6989586621679441986"><span class="hs-identifier hs-var">mungedPtr</span></a></span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><span class="annottext">JITConfig -&gt; String -&gt; IO ()
</span><a href="Telomare.Llvm.html#debugLog"><span class="hs-identifier hs-var">debugLog</span></a></span><span> </span><span class="annot"><span class="annottext">JITConfig
</span><a href="#local-6989586621679441988"><span class="hs-identifier hs-var">jitConfig</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;finished evaluation&quot;</span></span><span>
</span><span id="line-73"></span><span>  </span><span id="local-6989586621679441982"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679441982"><span class="hs-identifier hs-var">numPairs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ptr Int64 -&gt; IO Int64
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">Ptr Int64
</span><a href="#local-6989586621679441984"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-74"></span><span>  </span><span id="local-6989586621679441981"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679441981"><span class="hs-identifier hs-var">resultVal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ptr Int64 -&gt; IO Int64
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Int64 -&gt; Int -&gt; Ptr Int64
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><span class="hs-identifier hs-var">plusPtr</span></span><span> </span><span class="annot"><span class="annottext">Ptr Int64
</span><a href="#local-6989586621679441984"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><span class="annottext">RunResult -&gt; IO RunResult
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; Int64 -&gt; RunResult
</span><a href="Telomare.Llvm.html#RunResult"><span class="hs-identifier hs-var">RunResult</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679441981"><span class="hs-identifier hs-var">resultVal</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679441982"><span class="hs-identifier hs-var">numPairs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-comment">-- | Recursively follow all integers by interpreting them as indices</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- in the pair array until a 0 is found.</span><span>
</span><span id="line-80"></span><span class="annot"><a href="Telomare.Llvm.html#convertPairs"><span class="hs-identifier hs-type">convertPairs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Telomare.Llvm.html#RunResult"><span class="hs-identifier hs-type">RunResult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Naturals.html#NExpr"><span class="hs-identifier hs-type">NExpr</span></a></span><span>
</span><span id="line-81"></span><span id="convertPairs"><span class="annot"><span class="annottext">convertPairs :: RunResult -&gt; IO NExpr
</span><a href="Telomare.Llvm.html#convertPairs"><span class="hs-identifier hs-var hs-var">convertPairs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.Llvm.html#RunResult"><span class="hs-identifier hs-type">RunResult</span></a></span><span> </span><span id="local-6989586621679441979"><span class="annot"><span class="annottext">x :: Int64
</span><a href="#local-6989586621679441979"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; IO NExpr
forall t. (Storable t, Integral t) =&gt; t -&gt; IO NExpr
</span><a href="#local-6989586621679441978"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679441979"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-83"></span><span>    </span><span id="local-6989586621679441978"><span class="annot"><span class="annottext">go :: t -&gt; IO NExpr
</span><a href="#local-6989586621679441978"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; IO NExpr
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="Naturals.html#NZero"><span class="hs-identifier hs-var">NZero</span></a></span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><a href="#local-6989586621679441978"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679441976"><span class="annot"><span class="annottext">i :: t
</span><a href="#local-6989586621679441976"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-85"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679441975"><span class="annot"><span class="annottext">ptr :: Ptr a
</span><a href="#local-6989586621679441975"><span class="hs-identifier hs-var hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntPtr -&gt; Ptr a
forall a. IntPtr -&gt; Ptr a
</span><span class="hs-identifier hs-var">intPtrToPtr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; IntPtr
</span><span class="hs-identifier hs-var">IntPtr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679441976"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>      </span><span id="local-6989586621679441973"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679441973"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ptr t -&gt; IO t
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">Ptr t
forall a. Ptr a
</span><a href="#local-6989586621679441975"><span class="hs-identifier hs-var">ptr</span></a></span><span>
</span><span id="line-87"></span><span>      </span><span id="local-6989586621679441972"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679441972"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ptr t -&gt; IO t
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Any
forall a. Ptr a
</span><a href="#local-6989586621679441975"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Any -&gt; Int -&gt; Ptr t
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><span class="hs-operator hs-var">`plusPtr`</span></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>      </span><span class="annot"><span class="annottext">NExpr -&gt; NExpr -&gt; NExpr
</span><a href="Naturals.html#NPair"><span class="hs-identifier hs-var">NPair</span></a></span><span> </span><span class="annot"><span class="annottext">(NExpr -&gt; NExpr -&gt; NExpr) -&gt; IO NExpr -&gt; IO (NExpr -&gt; NExpr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">t -&gt; IO NExpr
</span><a href="#local-6989586621679441978"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679441973"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">IO (NExpr -&gt; NExpr) -&gt; IO NExpr -&gt; IO NExpr
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">t -&gt; IO NExpr
</span><a href="#local-6989586621679441978"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679441972"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="annot"><a href="Telomare.Llvm.html#makeModule"><span class="hs-identifier hs-type">makeModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Naturals.html#NExpr"><span class="hs-identifier hs-type">NExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">AST.Module</span></span><span>
</span><span id="line-91"></span><span id="makeModule"><span class="annot"><span class="annottext">makeModule :: NExpr -&gt; Module
</span><a href="Telomare.Llvm.html#makeModule"><span class="hs-identifier hs-var hs-var">makeModule</span></a></span></span><span> </span><span id="local-6989586621679441968"><span class="annot"><span class="annottext">iexpr :: NExpr
</span><a href="#local-6989586621679441968"><span class="hs-identifier hs-var">iexpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(State (Map Any Any, Integer) Module
 -&gt; (Map Any Any, Integer) -&gt; Module)
-&gt; (Map Any Any, Integer)
-&gt; State (Map Any Any, Integer) Module
-&gt; Module
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">State (Map Any Any, Integer) Module
-&gt; (Map Any Any, Integer) -&gt; Module
forall s a. State s a -&gt; s -&gt; a
</span><span class="hs-identifier hs-var">evalState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Any Any
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(State (Map Any Any, Integer) Module -&gt; Module)
-&gt; (ModuleBuilderT (StateT (Map Any Any, Integer) Identity) Operand
    -&gt; State (Map Any Any, Integer) Module)
-&gt; ModuleBuilderT (StateT (Map Any Any, Integer) Identity) Operand
-&gt; Module
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
-&gt; ModuleBuilderT (StateT (Map Any Any, Integer) Identity) Operand
-&gt; State (Map Any Any, Integer) Module
forall (m :: * -&gt; *) a.
Monad m =&gt;
ShortByteString -&gt; ModuleBuilderT m a -&gt; m Module
</span><span class="hs-identifier hs-var">buildModuleT</span></span><span> </span><span class="annot"><span class="hs-string">&quot;TelomareModule&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ModuleBuilderT (StateT (Map Any Any, Integer) Identity) Operand
 -&gt; Module)
-&gt; ModuleBuilderT (StateT (Map Any Any, Integer) Identity) Operand
-&gt; Module
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Definition
-&gt; ModuleBuilderT (StateT (Map Any Any, Integer) Identity) ()
forall (m :: * -&gt; *). MonadModuleBuilder m =&gt; Definition -&gt; m ()
</span><span class="hs-identifier hs-var">emitDefn</span></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Global -&gt; Definition
</span><span class="hs-identifier hs-var">GlobalDefinition</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Global
</span><span class="hs-identifier hs-var">functionDefaults</span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-94"></span><span>                          </span><span class="annot"><span class="annottext">name :: Name
</span><span class="hs-identifier hs-var">name</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;GC_malloc&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>                          </span><span class="annot"><span class="annottext">returnType :: Type
</span><span class="hs-identifier hs-var">returnType</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; AddrSpace -&gt; Type
</span><span class="hs-identifier hs-var">PointerType</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Type
</span><span class="hs-identifier hs-var">IntegerType</span></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; AddrSpace
</span><span class="hs-identifier hs-var">AddrSpace.AddrSpace</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span>                          </span><span class="annot"><span class="annottext">returnAttributes :: [ParameterAttribute]
</span><span class="hs-identifier hs-var">G.returnAttributes</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ParameterAttribute
</span><span class="hs-identifier hs-var">PA.NoAlias</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>                          </span><span class="annot"><span class="annottext">parameters :: ([Parameter], Bool)
</span><span class="hs-identifier hs-var">parameters</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type -&gt; Name -&gt; [ParameterAttribute] -&gt; Parameter
</span><span class="hs-identifier hs-var">Parameter</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>                          </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>  </span><span id="local-6989586621679441950"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441950"><span class="hs-identifier hs-var">gcRegisterMyThread</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [Type]
-&gt; Type
-&gt; ModuleBuilderT (StateT (Map Any Any, Integer) Identity) Operand
forall (m :: * -&gt; *).
MonadModuleBuilder m =&gt;
Name -&gt; [Type] -&gt; Type -&gt; m Operand
</span><span class="hs-identifier hs-var">extern</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Telomare_register_my_thread&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier hs-var">T.void</span></span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><span class="annottext">(Definition
 -&gt; ModuleBuilderT (StateT (Map Any Any, Integer) Identity) ())
-&gt; [Definition]
-&gt; ModuleBuilderT (StateT (Map Any Any, Integer) Identity) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Definition
-&gt; ModuleBuilderT (StateT (Map Any Any, Integer) Identity) ()
forall (m :: * -&gt; *). MonadModuleBuilder m =&gt; Definition -&gt; m ()
</span><span class="hs-identifier hs-var">emitDefn</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Definition
</span><a href="Telomare.Llvm.html#heapIndex"><span class="hs-identifier hs-var">heapIndex</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="Telomare.Llvm.html#resultStructure"><span class="hs-identifier hs-var">resultStructure</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><span class="annottext">Operand
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModuleBuilderT (StateT (Map Any Any, Integer) Identity) Operand
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadFix m) =&gt;
m Operand
</span><a href="Telomare.Llvm.html#goLeft"><span class="hs-identifier hs-var">goLeft</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><span class="annottext">Operand
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModuleBuilderT (StateT (Map Any Any, Integer) Identity) Operand
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadFix m) =&gt;
m Operand
</span><a href="Telomare.Llvm.html#goRight"><span class="hs-identifier hs-var">goRight</span></a></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span>  </span><span id="local-6989586621679441942"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441942"><span class="hs-identifier hs-var">setJmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [Type]
-&gt; Type
-&gt; ModuleBuilderT (StateT (Map Any Any, Integer) Identity) Operand
forall (m :: * -&gt; *).
MonadModuleBuilder m =&gt;
Name -&gt; [Type] -&gt; Type -&gt; m Operand
</span><span class="hs-identifier hs-var">IRM.extern</span></span><span> </span><span class="annot"><span class="hs-string">&quot;w_setjmp&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><span class="annottext">Operand
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [Type]
-&gt; Type
-&gt; ModuleBuilderT (StateT (Map Any Any, Integer) Identity) Operand
forall (m :: * -&gt; *).
MonadModuleBuilder m =&gt;
Name -&gt; [Type] -&gt; Type -&gt; m Operand
</span><span class="hs-identifier hs-var">IRM.extern</span></span><span> </span><span class="annot"><span class="hs-string">&quot;w_longjmp&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier hs-var">VoidType</span></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span>  </span><span class="annot"><span class="annottext">Name
-&gt; [(Type, ParameterName)]
-&gt; Type
-&gt; ([Operand]
    -&gt; IRBuilderT
         (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) ())
-&gt; ModuleBuilderT (StateT (Map Any Any, Integer) Identity) Operand
forall (m :: * -&gt; *).
MonadModuleBuilder m =&gt;
Name
-&gt; [(Type, ParameterName)]
-&gt; Type
-&gt; ([Operand] -&gt; IRBuilderT m ())
-&gt; m Operand
</span><span class="hs-identifier hs-var">IRM.function</span></span><span> </span><span class="annot"><span class="hs-string">&quot;main&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; AddrSpace -&gt; Type
</span><span class="hs-identifier hs-var">PointerType</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#resultStructureT"><span class="hs-identifier hs-var">resultStructureT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; AddrSpace
</span><span class="hs-identifier hs-var">AddrSpace.AddrSpace</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><span class="annottext">(([Operand]
  -&gt; IRBuilderT
       (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) ())
 -&gt; ModuleBuilderT (StateT (Map Any Any, Integer) Identity) Operand)
-&gt; ([Operand]
    -&gt; IRBuilderT
         (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) ())
-&gt; ModuleBuilderT (StateT (Map Any Any, Integer) Identity) Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">mdo</span><span>
</span><span id="line-110"></span><span>        </span><span class="hs-comment">-- wrap the evaluation of iexpr in a setjmp branch, so that an abort instruction can return for an early exit</span><span>
</span><span id="line-111"></span><span>        </span><span id="local-6989586621679441938"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441938"><span class="hs-identifier hs-var">preludeB</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IRBuilderT
  (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) Name
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; m Name
</span><span class="hs-identifier hs-var">block</span></span><span> </span><span class="annot"><span class="annottext">IRBuilderT
  (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) Name
-&gt; ShortByteString
-&gt; IRBuilderT
     (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) Name
forall (m :: * -&gt; *) r.
MonadIRBuilder m =&gt;
m r -&gt; ShortByteString -&gt; m r
</span><span class="hs-operator hs-var">`named`</span></span><span> </span><span class="annot"><span class="hs-string">&quot;prelude&quot;</span></span><span>
</span><span id="line-112"></span><span>        </span><span class="annot"><span class="annottext">Operand
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand
-&gt; [(Operand, [ParameterAttribute])]
-&gt; IRBuilderT
     (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; [(Operand, [ParameterAttribute])] -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.call</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441950"><span class="hs-identifier hs-var">gcRegisterMyThread</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-113"></span><span>        </span><span id="local-6989586621679441934"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441934"><span class="hs-identifier hs-var">jumped</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand
-&gt; [(Operand, [ParameterAttribute])]
-&gt; IRBuilderT
     (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; [(Operand, [ParameterAttribute])] -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.call</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441942"><span class="hs-identifier hs-var">setJmp</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-114"></span><span>        </span><span id="local-6989586621679441933"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441933"><span class="hs-identifier hs-var">brCond</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntegerPredicate
-&gt; Operand
-&gt; Operand
-&gt; IRBuilderT
     (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
IntegerPredicate -&gt; Operand -&gt; Operand -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.icmp</span></span><span> </span><span class="annot"><span class="annottext">IntegerPredicate
</span><span class="hs-identifier hs-var">IP.EQ</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441934"><span class="hs-identifier hs-var">jumped</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#zero"><span class="hs-identifier hs-var">zero</span></a></span><span>
</span><span id="line-115"></span><span>        </span><span class="annot"><span class="annottext">Operand
-&gt; Name
-&gt; Name
-&gt; IRBuilderT
     (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) ()
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Name -&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">IRI.condBr</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441933"><span class="hs-identifier hs-var">brCond</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441928"><span class="hs-identifier hs-var">mainB</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441927"><span class="hs-identifier hs-var">exitB</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span>        </span><span id="local-6989586621679441928"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441928"><span class="hs-identifier hs-var">mainB</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IRBuilderT
  (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) Name
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; m Name
</span><span class="hs-identifier hs-var">block</span></span><span> </span><span class="annot"><span class="annottext">IRBuilderT
  (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) Name
-&gt; ShortByteString
-&gt; IRBuilderT
     (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) Name
forall (m :: * -&gt; *) r.
MonadIRBuilder m =&gt;
m r -&gt; ShortByteString -&gt; m r
</span><span class="hs-operator hs-var">`named`</span></span><span> </span><span class="annot"><span class="hs-string">&quot;main&quot;</span></span><span>
</span><span id="line-118"></span><span>        </span><span class="hs-comment">-- TODO fix</span><span>
</span><span id="line-119"></span><span>        </span><span class="hs-comment">-- mainExp &lt;- toLLVM iexpr</span><span>
</span><span id="line-120"></span><span>        </span><span id="local-6989586621679441926"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441926"><span class="hs-identifier hs-var">mainExp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IRBuilderT
  (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) Operand
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-121"></span><span>        </span><span id="local-6989586621679441924"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441924"><span class="hs-identifier hs-var">endMainB</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IRBuilderT
  (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) Name
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; m Name
</span><span class="hs-identifier hs-var">currentBlock</span></span><span>
</span><span id="line-122"></span><span>        </span><span class="annot"><span class="annottext">Name
-&gt; IRBuilderT
     (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">IRI.br</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441927"><span class="hs-identifier hs-var">exitB</span></a></span><span>
</span><span id="line-123"></span><span>        </span><span class="annot"><span class="annottext">Terminator
-&gt; IRBuilderT
     (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Terminator -&gt; m ()
</span><span class="hs-identifier hs-var">emitTerm</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; InstructionMetadata -&gt; Terminator
</span><span class="hs-identifier hs-var">Br</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441927"><span class="hs-identifier hs-var">exitB</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span>        </span><span id="local-6989586621679441927"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441927"><span class="hs-identifier hs-var">exitB</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IRBuilderT
  (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) Name
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; m Name
</span><span class="hs-identifier hs-var">block</span></span><span> </span><span class="annot"><span class="annottext">IRBuilderT
  (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) Name
-&gt; ShortByteString
-&gt; IRBuilderT
     (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) Name
forall (m :: * -&gt; *) r.
MonadIRBuilder m =&gt;
m r -&gt; ShortByteString -&gt; m r
</span><span class="hs-operator hs-var">`named`</span></span><span> </span><span class="annot"><span class="hs-string">&quot;exit&quot;</span></span><span>
</span><span id="line-126"></span><span>        </span><span id="local-6989586621679441919"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441919"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Operand, Name)]
-&gt; IRBuilderT
     (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
[(Operand, Name)] -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.phi</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441926"><span class="hs-identifier hs-var">mainExp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441924"><span class="hs-identifier hs-var">endMainB</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441934"><span class="hs-identifier hs-var">jumped</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441938"><span class="hs-identifier hs-var">preludeB</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-127"></span><span>        </span><span id="local-6989586621679441917"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441917"><span class="hs-identifier hs-var">heapC</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand
-&gt; Word32
-&gt; IRBuilderT
     (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Word32 -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.load</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#heapIndexC"><span class="hs-identifier hs-var">heapIndexC</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-128"></span><span>        </span><span id="local-6989586621679441914"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441914"><span class="hs-identifier hs-var">numPairs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand
-&gt; [Operand]
-&gt; IRBuilderT
     (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) Operand
forall (m :: * -&gt; *).
(MonadIRBuilder m, MonadModuleBuilder m) =&gt;
Operand -&gt; [Operand] -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.gep</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#resultC"><span class="hs-identifier hs-var">resultC</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#zero"><span class="hs-identifier hs-var">zero</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#zero32"><span class="hs-identifier hs-var">zero32</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-129"></span><span>        </span><span id="local-6989586621679441910"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441910"><span class="hs-identifier hs-var">resultPair</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand
-&gt; [Operand]
-&gt; IRBuilderT
     (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) Operand
forall (m :: * -&gt; *).
(MonadIRBuilder m, MonadModuleBuilder m) =&gt;
Operand -&gt; [Operand] -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.gep</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#resultC"><span class="hs-identifier hs-var">resultC</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#zero"><span class="hs-identifier hs-var">zero</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#one32"><span class="hs-identifier hs-var">one32</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-130"></span><span>        </span><span class="annot"><span class="annottext">Operand
-&gt; Word32
-&gt; Operand
-&gt; IRBuilderT
     (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) ()
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Word32 -&gt; Operand -&gt; m ()
</span><span class="hs-identifier hs-var">IRI.store</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441914"><span class="hs-identifier hs-var">numPairs</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441917"><span class="hs-identifier hs-var">heapC</span></a></span><span>
</span><span id="line-131"></span><span>        </span><span class="annot"><span class="annottext">Operand
-&gt; Word32
-&gt; Operand
-&gt; IRBuilderT
     (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) ()
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Word32 -&gt; Operand -&gt; m ()
</span><span class="hs-identifier hs-var">IRI.store</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441910"><span class="hs-identifier hs-var">resultPair</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441919"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-132"></span><span>        </span><span class="annot"><span class="annottext">Operand
-&gt; IRBuilderT
     (ModuleBuilderT (StateT (Map Any Any, Integer) Identity)) ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Operand -&gt; m ()
</span><span class="hs-identifier hs-var">IRI.ret</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#resultC"><span class="hs-identifier hs-var">resultC</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-keyword">data</span><span> </span><span id="DebugModule"><span class="annot"><a href="Telomare.Llvm.html#DebugModule"><span class="hs-identifier hs-var">DebugModule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DebugModule"><span class="annot"><a href="Telomare.Llvm.html#DebugModule"><span class="hs-identifier hs-var">DebugModule</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">AST.Module</span></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679441901"><span id="local-6989586621679441904"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Telomare.Llvm.html#DebugModule"><span class="hs-identifier hs-type">DebugModule</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-137"></span><span>  </span><span id="local-6989586621679441899"><span class="annot"><span class="annottext">show :: DebugModule -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Telomare.Llvm.html#DebugModule"><span class="hs-identifier hs-type">DebugModule</span></a></span><span> </span><span id="local-6989586621679441897"><span class="annot"><span class="annottext">m :: Module
</span><a href="#local-6989586621679441897"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; String) -&gt; [Definition] -&gt; String
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; String
</span><a href="#local-6989586621679441895"><span class="hs-identifier hs-var">showDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">([Definition] -&gt; String) -&gt; [Definition] -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; [Definition]
</span><span class="hs-identifier hs-var hs-var">moduleDefinitions</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621679441897"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679441895"><span class="annot"><span class="annottext">showDefinition :: Definition -&gt; String
</span><a href="#local-6989586621679441895"><span class="hs-identifier hs-var hs-var">showDefinition</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GlobalDefinition</span></span><span> </span><span id="local-6989586621679441893"><span class="annot"><span class="annottext">f :: Global
</span><a href="#local-6989586621679441893"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Function</span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Global -&gt; String
</span><a href="#local-6989586621679441891"><span class="hs-identifier hs-var">displayFunction</span></a></span><span> </span><span class="annot"><span class="annottext">Global
</span><a href="#local-6989586621679441893"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-139"></span><span>          </span><span class="annot"><a href="#local-6989586621679441895"><span class="hs-identifier hs-var">showDefinition</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-140"></span><span>          </span><span id="local-6989586621679441891"><span class="annot"><span class="annottext">displayFunction :: Global -&gt; String
</span><a href="#local-6989586621679441891"><span class="hs-identifier hs-var hs-var">displayFunction</span></a></span></span><span> </span><span id="local-6989586621679441890"><span class="annot"><span class="annottext">f :: Global
</span><a href="#local-6989586621679441890"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Global -&gt; Name
</span><span class="hs-identifier hs-var hs-var">name</span></span><span> </span><span class="annot"><span class="annottext">Global
</span><a href="#local-6989586621679441890"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BasicBlock -&gt; String) -&gt; [BasicBlock] -&gt; String
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">BasicBlock -&gt; String
</span><a href="#local-6989586621679441888"><span class="hs-identifier hs-var">displayBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Global -&gt; [BasicBlock]
</span><span class="hs-identifier hs-var hs-var">basicBlocks</span></span><span> </span><span class="annot"><span class="annottext">Global
</span><a href="#local-6989586621679441890"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-141"></span><span>          </span><span id="local-6989586621679441888"><span class="annot"><span class="annottext">displayBlock :: BasicBlock -&gt; String
</span><a href="#local-6989586621679441888"><span class="hs-identifier hs-var hs-var">displayBlock</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BasicBlock</span></span><span> </span><span id="local-6989586621679441885"><span class="annot"><span class="annottext">n :: Name
</span><a href="#local-6989586621679441885"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679441884"><span class="annot"><span class="annottext">inst :: [Named Instruction]
</span><a href="#local-6989586621679441884"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span id="local-6989586621679441883"><span class="annot"><span class="annottext">term :: Named Terminator
</span><a href="#local-6989586621679441883"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-142"></span><span>            </span><span class="annot"><span class="annottext">[String] -&gt; String
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;  &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441885"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Named Instruction -&gt; String) -&gt; [Named Instruction] -&gt; String
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">Named Instruction -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="#local-6989586621679441882"><span class="hs-identifier hs-var">displayInstruction</span></a></span><span> </span><span class="annot"><span class="annottext">[Named Instruction]
</span><a href="#local-6989586621679441884"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;    &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Named Terminator -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Named Terminator
</span><a href="#local-6989586621679441883"><span class="hs-identifier hs-var">term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-143"></span><span>          </span><span id="local-6989586621679441882"><span class="annot"><span class="annottext">displayInstruction :: a -&gt; String
</span><a href="#local-6989586621679441882"><span class="hs-identifier hs-var hs-var">displayInstruction</span></a></span></span><span> </span><span id="local-6989586621679441881"><span class="annot"><span class="annottext">i :: a
</span><a href="#local-6989586621679441881"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;    &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679441881"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="hs-comment">-- TODO fix</span><span>
</span><span id="line-146"></span><span id="local-6989586621679441880"><span class="annot"><a href="Telomare.Llvm.html#resolver"><span class="hs-identifier hs-type">resolver</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OJ.CompileLayer</span></span><span> </span><span class="annot"><a href="#local-6989586621679441880"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679441880"><span class="hs-identifier hs-type">l</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OJ.SymbolResolver</span></span></span><span>
</span><span id="line-147"></span><span id="resolver"><span class="annot"><span class="annottext">resolver :: l -&gt; SymbolResolver
</span><a href="Telomare.Llvm.html#resolver"><span class="hs-identifier hs-var hs-var">resolver</span></a></span></span><span> </span><span id="local-6989586621679441878"><span class="annot"><span class="annottext">compileLayer :: l
</span><a href="#local-6989586621679441878"><span class="hs-identifier hs-var">compileLayer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MangledSymbol -&gt; IO (Either JITSymbolError JITSymbol))
-&gt; SymbolResolver
</span><span class="hs-identifier hs-var">OJ.SymbolResolver</span></span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679441876"><span class="annot"><span class="annottext">s :: MangledSymbol
</span><a href="#local-6989586621679441876"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">l -&gt; MangledSymbol -&gt; Bool -&gt; IO (Either JITSymbolError JITSymbol)
forall l.
CompileLayer l =&gt;
l -&gt; MangledSymbol -&gt; Bool -&gt; IO (Either JITSymbolError JITSymbol)
</span><span class="hs-identifier hs-var">OJ.findSymbol</span></span><span> </span><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621679441878"><span class="hs-identifier hs-var">compileLayer</span></a></span><span> </span><span class="annot"><span class="annottext">MangledSymbol
</span><a href="#local-6989586621679441876"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-comment">{-
  (\s -&gt; fmap (\a -&gt; Right $ OJ.JITSymbol a (OJ.defaultJITSymbolFlags { OJ.jitSymbolExported = True })) (Linking.getSymbolAddressInProcess s))
-}</span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span id="local-6989586621679441874"><span class="annot"><a href="Telomare.Llvm.html#withTargetMachine"><span class="hs-identifier hs-type">withTargetMachine</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Target.TargetMachine</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679441874"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679441874"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-154"></span><span id="withTargetMachine"><span class="annot"><span class="annottext">withTargetMachine :: (TargetMachine -&gt; IO a) -&gt; IO a
</span><a href="Telomare.Llvm.html#withTargetMachine"><span class="hs-identifier hs-var hs-var">withTargetMachine</span></a></span></span><span> </span><span id="local-6989586621679441872"><span class="annot"><span class="annottext">f :: TargetMachine -&gt; IO a
</span><a href="#local-6989586621679441872"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-155"></span><span>  </span><span class="annot"><span class="annottext">IO ()
</span><span class="hs-identifier hs-var">Target.initializeAllTargets</span></span><span>
</span><span id="line-156"></span><span>  </span><span id="local-6989586621679441870"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679441870"><span class="hs-identifier hs-var">triple</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ShortByteString
</span><span class="hs-identifier hs-var">Target.getProcessTargetTriple</span></span><span>
</span><span id="line-157"></span><span>  </span><span id="local-6989586621679441868"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679441868"><span class="hs-identifier hs-var">cpu</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ByteString
</span><span class="hs-identifier hs-var">Target.getHostCPUName</span></span><span>
</span><span id="line-158"></span><span>  </span><span id="local-6989586621679441866"><span class="annot"><span class="annottext">Map CPUFeature Bool
</span><a href="#local-6989586621679441866"><span class="hs-identifier hs-var">features</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Map CPUFeature Bool)
</span><span class="hs-identifier hs-var">Target.getHostCPUFeatures</span></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679441864"><span class="annot"><span class="annottext">target :: Target
</span><a href="#local-6989586621679441864"><span class="hs-identifier hs-var">target</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ShortByteString
-&gt; ShortByteString -&gt; IO (Target, ShortByteString)
</span><span class="hs-identifier hs-var">Target.lookupTarget</span></span><span> </span><span class="annot"><span class="annottext">Maybe ShortByteString
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679441870"><span class="hs-identifier hs-var">triple</span></a></span><span>
</span><span id="line-160"></span><span>  </span><span class="annot"><span class="annottext">(TargetOptions -&gt; IO a) -&gt; IO a
forall a. (TargetOptions -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">Target.withTargetOptions</span></span><span> </span><span class="annot"><span class="annottext">((TargetOptions -&gt; IO a) -&gt; IO a)
-&gt; (TargetOptions -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679441861"><span class="annot"><span class="annottext">options :: TargetOptions
</span><a href="#local-6989586621679441861"><span class="hs-identifier hs-var">options</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><span class="annottext">Target
-&gt; ShortByteString
-&gt; ByteString
-&gt; Map CPUFeature Bool
-&gt; TargetOptions
-&gt; Model
-&gt; Model
-&gt; Level
-&gt; (TargetMachine -&gt; IO a)
-&gt; IO a
forall a.
Target
-&gt; ShortByteString
-&gt; ByteString
-&gt; Map CPUFeature Bool
-&gt; TargetOptions
-&gt; Model
-&gt; Model
-&gt; Level
-&gt; (TargetMachine -&gt; IO a)
-&gt; IO a
</span><span class="hs-identifier hs-var">Target.withTargetMachine</span></span><span> </span><span class="annot"><span class="annottext">Target
</span><a href="#local-6989586621679441864"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679441870"><span class="hs-identifier hs-var">triple</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679441868"><span class="hs-identifier hs-var">cpu</span></a></span><span> </span><span class="annot"><span class="annottext">Map CPUFeature Bool
</span><a href="#local-6989586621679441866"><span class="hs-identifier hs-var">features</span></a></span><span> </span><span class="annot"><span class="annottext">TargetOptions
</span><a href="#local-6989586621679441861"><span class="hs-identifier hs-var">options</span></a></span><span> </span><span class="annot"><span class="annottext">Model
</span><span class="hs-identifier hs-var">Reloc.Default</span></span><span>
</span><span id="line-162"></span><span>      </span><span class="hs-comment">-- We need to set the CodeModel to JITDefault to allow for larger relocations</span><span>
</span><span id="line-163"></span><span>      </span><span class="annot"><span class="annottext">Model
</span><span class="hs-identifier hs-var">CodeModel.JITDefault</span></span><span>
</span><span id="line-164"></span><span>      </span><span class="annot"><span class="annottext">Level
</span><span class="hs-identifier hs-var">CodeGenOpt.Default</span></span><span> </span><span class="annot"><span class="annottext">TargetMachine -&gt; IO a
</span><a href="#local-6989586621679441872"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="annot"><a href="Telomare.Llvm.html#debugLog"><span class="hs-identifier hs-type">debugLog</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Telomare.Llvm.html#JITConfig"><span class="hs-identifier hs-type">JITConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span id="debugLog"><span class="annot"><span class="annottext">debugLog :: JITConfig -&gt; String -&gt; IO ()
</span><a href="Telomare.Llvm.html#debugLog"><span class="hs-identifier hs-var hs-var">debugLog</span></a></span></span><span> </span><span id="local-6989586621679441856"><span class="annot"><span class="annottext">jitConfig :: JITConfig
</span><a href="#local-6989586621679441856"><span class="hs-identifier hs-var">jitConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">JITConfig -&gt; Bool
</span><a href="Telomare.Llvm.html#debugOutput"><span class="hs-identifier hs-var hs-var">debugOutput</span></a></span><span> </span><span class="annot"><span class="annottext">JITConfig
</span><a href="#local-6989586621679441856"><span class="hs-identifier hs-var">jitConfig</span></a></span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">hPutStrLn</span></span><span> </span><span class="annot"><span class="annottext">Handle
</span><span class="hs-identifier hs-var">stderr</span></span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; String -&gt; IO ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; String -&gt; IO ()) -&gt; IO () -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="annot"><a href="Telomare.Llvm.html#optimizeModule"><span class="hs-identifier hs-type">optimizeModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Telomare.Llvm.html#JITConfig"><span class="hs-identifier hs-type">JITConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Mod.Module</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span id="optimizeModule"><span class="annot"><span class="annottext">optimizeModule :: JITConfig -&gt; Module -&gt; IO ()
</span><a href="Telomare.Llvm.html#optimizeModule"><span class="hs-identifier hs-var hs-var">optimizeModule</span></a></span></span><span> </span><span id="local-6989586621679441852"><span class="annot"><span class="annottext">jitConfig :: JITConfig
</span><a href="#local-6989586621679441852"><span class="hs-identifier hs-var">jitConfig</span></a></span></span><span> </span><span id="local-6989586621679441851"><span class="annot"><span class="annottext">module' :: Module
</span><a href="#local-6989586621679441851"><span class="hs-identifier hs-var">module'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-173"></span><span>  </span><span class="annot"><span class="annottext">PassSetSpec -&gt; (PassManager -&gt; IO ()) -&gt; IO ()
forall a. PassSetSpec -&gt; (PassManager -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">withPassManager</span></span><span> </span><span class="annot"><span class="annottext">PassSetSpec
</span><span class="hs-identifier hs-var">defaultCuratedPassSetSpec</span></span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">optLevel :: Maybe Word
</span><span class="hs-identifier hs-var">optLevel</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Maybe Word
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OptimizerLevel -&gt; Word
</span><a href="Telomare.Llvm.html#optimizerLevelToWord"><span class="hs-identifier hs-var">optimizerLevelToWord</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">JITConfig -&gt; OptimizerLevel
</span><a href="Telomare.Llvm.html#optimizerLevel"><span class="hs-identifier hs-var hs-var">optimizerLevel</span></a></span><span> </span><span class="annot"><span class="annottext">JITConfig
</span><a href="#local-6989586621679441852"><span class="hs-identifier hs-var">jitConfig</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">((PassManager -&gt; IO ()) -&gt; IO ())
-&gt; (PassManager -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679441845"><span class="annot"><span class="annottext">pm :: PassManager
</span><a href="#local-6989586621679441845"><span class="hs-identifier hs-var">pm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PassManager -&gt; Module -&gt; IO Bool
</span><span class="hs-identifier hs-var">runPassManager</span></span><span> </span><span class="annot"><span class="annottext">PassManager
</span><a href="#local-6989586621679441845"><span class="hs-identifier hs-var">pm</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621679441851"><span class="hs-identifier hs-var">module'</span></a></span><span>
</span><span id="line-176"></span><span>    </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-keyword">data</span><span> </span><span id="JITConfig"><span class="annot"><a href="Telomare.Llvm.html#JITConfig"><span class="hs-identifier hs-var">JITConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="JITConfig"><span class="annot"><a href="Telomare.Llvm.html#JITConfig"><span class="hs-identifier hs-var">JITConfig</span></a></span></span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="debugOutput"><span class="annot"><span class="annottext">JITConfig -&gt; Bool
</span><a href="Telomare.Llvm.html#debugOutput"><span class="hs-identifier hs-var hs-var">debugOutput</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="timingOutput"><span class="annot"><span class="annottext">JITConfig -&gt; Bool
</span><a href="Telomare.Llvm.html#timingOutput"><span class="hs-identifier hs-var hs-var">timingOutput</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="optimizerLevel"><span class="annot"><span class="annottext">JITConfig -&gt; OptimizerLevel
</span><a href="Telomare.Llvm.html#optimizerLevel"><span class="hs-identifier hs-var hs-var">optimizerLevel</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Telomare.Llvm.html#OptimizerLevel"><span class="hs-identifier hs-type">OptimizerLevel</span></a></span><span>
</span><span id="line-182"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span class="annot"><a href="Telomare.Llvm.html#defaultJITConfig"><span class="hs-identifier hs-type">defaultJITConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Telomare.Llvm.html#JITConfig"><span class="hs-identifier hs-type">JITConfig</span></a></span><span>
</span><span id="line-185"></span><span id="defaultJITConfig"><span class="annot"><span class="annottext">defaultJITConfig :: JITConfig
</span><a href="Telomare.Llvm.html#defaultJITConfig"><span class="hs-identifier hs-var hs-var">defaultJITConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">$WJITConfig :: Bool -&gt; Bool -&gt; OptimizerLevel -&gt; JITConfig
</span><a href="Telomare.Llvm.html#%24WJITConfig"><span class="hs-identifier hs-type hs-type">JITConfig</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">debugOutput :: Bool
</span><a href="Telomare.Llvm.html#debugOutput"><span class="hs-identifier hs-var">debugOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">timingOutput :: Bool
</span><a href="Telomare.Llvm.html#timingOutput"><span class="hs-identifier hs-var">timingOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">optimizerLevel :: OptimizerLevel
</span><a href="Telomare.Llvm.html#optimizerLevel"><span class="hs-identifier hs-var">optimizerLevel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OptimizerLevel
</span><a href="Telomare.Llvm.html#Two"><span class="hs-identifier hs-var">Two</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="hs-keyword">data</span><span> </span><span id="OptimizerLevel"><span class="annot"><a href="Telomare.Llvm.html#OptimizerLevel"><span class="hs-identifier hs-var">OptimizerLevel</span></a></span></span><span>
</span><span id="line-188"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="None"><span class="annot"><a href="Telomare.Llvm.html#None"><span class="hs-identifier hs-var">None</span></a></span></span><span>
</span><span id="line-189"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="One"><span class="annot"><a href="Telomare.Llvm.html#One"><span class="hs-identifier hs-var">One</span></a></span></span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Two"><span class="annot"><a href="Telomare.Llvm.html#Two"><span class="hs-identifier hs-var">Two</span></a></span></span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Three"><span class="annot"><a href="Telomare.Llvm.html#Three"><span class="hs-identifier hs-var">Three</span></a></span></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="annot"><a href="Telomare.Llvm.html#optimizerLevelToWord"><span class="hs-identifier hs-type">optimizerLevelToWord</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Telomare.Llvm.html#OptimizerLevel"><span class="hs-identifier hs-type">OptimizerLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span>
</span><span id="line-194"></span><span id="optimizerLevelToWord"><span class="annot"><span class="annottext">optimizerLevelToWord :: OptimizerLevel -&gt; Word
</span><a href="Telomare.Llvm.html#optimizerLevelToWord"><span class="hs-identifier hs-var hs-var">optimizerLevelToWord</span></a></span></span><span> </span><span id="local-6989586621679441835"><span class="annot"><span class="annottext">l :: OptimizerLevel
</span><a href="#local-6989586621679441835"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OptimizerLevel
</span><a href="#local-6989586621679441835"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><a href="Telomare.Llvm.html#None"><span class="hs-identifier hs-type">None</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><a href="Telomare.Llvm.html#One"><span class="hs-identifier hs-type">One</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><a href="Telomare.Llvm.html#Two"><span class="hs-identifier hs-type">Two</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-number">2</span></span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><a href="Telomare.Llvm.html#Three"><span class="hs-identifier hs-type">Three</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-number">3</span></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="annot"><a href="Telomare.Llvm.html#evalJIT"><span class="hs-identifier hs-type">evalJIT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Telomare.Llvm.html#JITConfig"><span class="hs-identifier hs-type">JITConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">AST.Module</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="Telomare.Llvm.html#RunResult"><span class="hs-identifier hs-type">RunResult</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span class="hs-comment">{-
evalJIT jitConfig amod = do
  _ &lt;- Linking.loadLibraryPermanently Nothing
  withContext $ \ctx -&gt; do
    t0 &lt;- getTime Monotonic
    withExecutionSession $ \sesh -&gt;
      withModuleKey $ \key -&gt;
        withModuleFromAST ctx amod $ \mod -&gt; do
          t1 &lt;- getTime Monotonic
          optimizeModule jitConfig mod
          t2 &lt;- getTime Monotonic
          when (debugOutput jitConfig) $ do
            asm &lt;- moduleLLVMAssembly mod
            BSC.putStrLn asm
          withTargetMachine $ \tm -&gt;
            OJ.withObjectLinkingLayer $ \objectLayer -&gt; do
              debugLog jitConfig &quot;in objectlinkinglayer&quot;
              OJ.withIRCompileLayer objectLayer tm $ \compileLayer -&gt; do
                debugLog jitConfig &quot;in compilelayer&quot;
                t3 &lt;- getTime Monotonic
                OJ.withModule compileLayer mod (resolver compileLayer) $ \_ -&gt; do
                  t4 &lt;- getTime Monotonic
                  debugLog jitConfig &quot;in modulelayer&quot;
                  mainSymbol &lt;- OJ.mangleSymbol compileLayer &quot;main&quot;
                  jitSymbolOrError &lt;- OJ.findSymbol compileLayer mainSymbol True
                  case jitSymbolOrError of
                    Left err -&gt; do
                      debugLog jitConfig (&quot;Could not find main: &quot; &lt;&gt; show err)
                      pure $ error &quot;Couldn't find main&quot;
                    Right (OJ.JITSymbol mainFn _) -&gt; do
                      debugLog jitConfig &quot;running main&quot;
                      t5 &lt;- getTime Monotonic
                      res &lt;- run jitConfig mainFn
                      t6 &lt;- getTime Monotonic
                      when (timingOutput jitConfig) $ printTimings t0 t1 t2 t3 t4 t5 t6
                      pure . Right $ res
-}</span><span>
</span><span id="line-239"></span><span id="evalJIT"><span class="annot"><span class="annottext">evalJIT :: JITConfig -&gt; Module -&gt; IO (Either String RunResult)
</span><a href="Telomare.Llvm.html#evalJIT"><span class="hs-identifier hs-var hs-var">evalJIT</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Either String RunResult)
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="annot"><a href="Telomare.Llvm.html#printTimings"><span class="hs-identifier hs-type">printTimings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TimeSpec</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TimeSpec</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TimeSpec</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TimeSpec</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TimeSpec</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TimeSpec</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TimeSpec</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span id="printTimings"><span class="annot"><span class="annottext">printTimings :: TimeSpec
-&gt; TimeSpec
-&gt; TimeSpec
-&gt; TimeSpec
-&gt; TimeSpec
-&gt; TimeSpec
-&gt; TimeSpec
-&gt; IO ()
</span><a href="Telomare.Llvm.html#printTimings"><span class="hs-identifier hs-var hs-var">printTimings</span></a></span></span><span> </span><span id="local-6989586621679441832"><span class="annot"><span class="annottext">beforeModuleSerialization :: TimeSpec
</span><a href="#local-6989586621679441832"><span class="hs-identifier hs-var">beforeModuleSerialization</span></a></span></span><span> </span><span id="local-6989586621679441831"><span class="annot"><span class="annottext">afterModuleSerialization :: TimeSpec
</span><a href="#local-6989586621679441831"><span class="hs-identifier hs-var">afterModuleSerialization</span></a></span></span><span> </span><span id="local-6989586621679441830"><span class="annot"><span class="annottext">afterOptimizer :: TimeSpec
</span><a href="#local-6989586621679441830"><span class="hs-identifier hs-var">afterOptimizer</span></a></span></span><span> </span><span id="local-6989586621679441829"><span class="annot"><span class="annottext">beforeAddingModule :: TimeSpec
</span><a href="#local-6989586621679441829"><span class="hs-identifier hs-var">beforeAddingModule</span></a></span></span><span> </span><span id="local-6989586621679441828"><span class="annot"><span class="annottext">afterAddingModule :: TimeSpec
</span><a href="#local-6989586621679441828"><span class="hs-identifier hs-var">afterAddingModule</span></a></span></span><span> </span><span id="local-6989586621679441827"><span class="annot"><span class="annottext">beforeRun :: TimeSpec
</span><a href="#local-6989586621679441827"><span class="hs-identifier hs-var">beforeRun</span></a></span></span><span> </span><span id="local-6989586621679441826"><span class="annot"><span class="annottext">afterRun :: TimeSpec
</span><a href="#local-6989586621679441826"><span class="hs-identifier hs-var">afterRun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-243"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; String -&gt; String -&gt; IO ()
forall r. PrintfType r =&gt; String -&gt; r
</span><span class="hs-identifier hs-var">printf</span></span><span> </span><span class="annot"><span class="hs-string">&quot;module serialization: %s, optimizer %s, adding module: %s, run: %s\n&quot;</span></span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeSpec -&gt; String
</span><a href="Telomare.Llvm.html#fmtTS"><span class="hs-identifier hs-var">fmtTS</span></a></span><span> </span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679441823"><span class="hs-identifier hs-var">moduleSerialization</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeSpec -&gt; String
</span><a href="Telomare.Llvm.html#fmtTS"><span class="hs-identifier hs-var">fmtTS</span></a></span><span> </span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679441822"><span class="hs-identifier hs-var">optimizer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeSpec -&gt; String
</span><a href="Telomare.Llvm.html#fmtTS"><span class="hs-identifier hs-var">fmtTS</span></a></span><span> </span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679441821"><span class="hs-identifier hs-var">addingModule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TimeSpec -&gt; String
</span><a href="Telomare.Llvm.html#fmtTS"><span class="hs-identifier hs-var">fmtTS</span></a></span><span> </span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679441820"><span class="hs-identifier hs-var">run</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-249"></span><span>    </span><span id="local-6989586621679441823"><span class="annot"><span class="annottext">moduleSerialization :: TimeSpec
</span><a href="#local-6989586621679441823"><span class="hs-identifier hs-var hs-var">moduleSerialization</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679441831"><span class="hs-identifier hs-var">afterModuleSerialization</span></a></span><span> </span><span class="annot"><span class="annottext">TimeSpec -&gt; TimeSpec -&gt; TimeSpec
</span><span class="hs-operator hs-var">`diffTimeSpec`</span></span><span> </span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679441832"><span class="hs-identifier hs-var">beforeModuleSerialization</span></a></span><span>
</span><span id="line-250"></span><span>    </span><span id="local-6989586621679441822"><span class="annot"><span class="annottext">optimizer :: TimeSpec
</span><a href="#local-6989586621679441822"><span class="hs-identifier hs-var hs-var">optimizer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679441830"><span class="hs-identifier hs-var">afterOptimizer</span></a></span><span> </span><span class="annot"><span class="annottext">TimeSpec -&gt; TimeSpec -&gt; TimeSpec
</span><span class="hs-operator hs-var">`diffTimeSpec`</span></span><span> </span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679441831"><span class="hs-identifier hs-var">afterModuleSerialization</span></a></span><span>
</span><span id="line-251"></span><span>    </span><span id="local-6989586621679441821"><span class="annot"><span class="annottext">addingModule :: TimeSpec
</span><a href="#local-6989586621679441821"><span class="hs-identifier hs-var hs-var">addingModule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679441828"><span class="hs-identifier hs-var">afterAddingModule</span></a></span><span> </span><span class="annot"><span class="annottext">TimeSpec -&gt; TimeSpec -&gt; TimeSpec
</span><span class="hs-operator hs-var">`diffTimeSpec`</span></span><span> </span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679441829"><span class="hs-identifier hs-var">beforeAddingModule</span></a></span><span>
</span><span id="line-252"></span><span>    </span><span id="local-6989586621679441820"><span class="annot"><span class="annottext">run :: TimeSpec
</span><a href="#local-6989586621679441820"><span class="hs-identifier hs-var hs-var">run</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679441826"><span class="hs-identifier hs-var">afterRun</span></a></span><span> </span><span class="annot"><span class="annottext">TimeSpec -&gt; TimeSpec -&gt; TimeSpec
</span><span class="hs-operator hs-var">`diffTimeSpec`</span></span><span> </span><span class="annot"><span class="annottext">TimeSpec
</span><a href="#local-6989586621679441827"><span class="hs-identifier hs-var">beforeRun</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="annot"><a href="Telomare.Llvm.html#fmtTS"><span class="hs-identifier hs-type">fmtTS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TimeSpec</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-255"></span><span id="fmtTS"><span class="annot"><span class="annottext">fmtTS :: TimeSpec -&gt; String
</span><a href="Telomare.Llvm.html#fmtTS"><span class="hs-identifier hs-var hs-var">fmtTS</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TimeSpec</span></span><span> </span><span id="local-6989586621679441817"><span class="annot"><span class="annottext">s :: Int64
</span><a href="#local-6989586621679441817"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679441816"><span class="annot"><span class="annottext">ns :: Int64
</span><a href="#local-6989586621679441816"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Double -&gt; String
forall r. PrintfType r =&gt; String -&gt; r
</span><span class="hs-identifier hs-var">printf</span></span><span> </span><span class="annot"><span class="hs-string">&quot;%.3f&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679441817"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679441816"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Int -&gt; Double
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">9</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="annot"><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-type">intT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-258"></span><span id="intT"><span class="annot"><span class="annottext">intT :: Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var hs-var">intT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Type
</span><span class="hs-identifier hs-var">IntegerType</span></span><span> </span><span class="annot"><span class="hs-number">64</span></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span class="annot"><a href="Telomare.Llvm.html#boolT"><span class="hs-identifier hs-type">boolT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-261"></span><span id="boolT"><span class="annot"><span class="annottext">boolT :: Type
</span><a href="Telomare.Llvm.html#boolT"><span class="hs-identifier hs-var hs-var">boolT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Type
</span><span class="hs-identifier hs-var">IntegerType</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span class="annot"><a href="Telomare.Llvm.html#intPtrT"><span class="hs-identifier hs-type">intPtrT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-264"></span><span id="intPtrT"><span class="annot"><span class="annottext">intPtrT :: Type
</span><a href="Telomare.Llvm.html#intPtrT"><span class="hs-identifier hs-var hs-var">intPtrT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; AddrSpace -&gt; Type
</span><span class="hs-identifier hs-var">PointerType</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span> </span><span class="annot"><span class="annottext">(AddrSpace -&gt; Type) -&gt; AddrSpace -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; AddrSpace
</span><span class="hs-identifier hs-var">AddrSpace.AddrSpace</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span class="annot"><a href="Telomare.Llvm.html#funT"><span class="hs-identifier hs-type">funT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-267"></span><span id="funT"><span class="annot"><span class="annottext">funT :: Type
</span><a href="Telomare.Llvm.html#funT"><span class="hs-identifier hs-var hs-var">funT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; AddrSpace -&gt; Type
</span><span class="hs-identifier hs-var">PointerType</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Bool -&gt; Type
</span><span class="hs-identifier hs-var">FunctionType</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; AddrSpace
</span><span class="hs-identifier hs-var">AddrSpace.AddrSpace</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="annot"><a href="Telomare.Llvm.html#voidFunT"><span class="hs-identifier hs-type">voidFunT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-270"></span><span id="voidFunT"><span class="annot"><span class="annottext">voidFunT :: Type
</span><a href="Telomare.Llvm.html#voidFunT"><span class="hs-identifier hs-var hs-var">voidFunT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; AddrSpace -&gt; Type
</span><span class="hs-identifier hs-var">PointerType</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Bool -&gt; Type
</span><span class="hs-identifier hs-var">FunctionType</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier hs-var">VoidType</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; AddrSpace
</span><span class="hs-identifier hs-var">AddrSpace.AddrSpace</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="annot"><a href="Telomare.Llvm.html#setjmpT"><span class="hs-identifier hs-type">setjmpT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-273"></span><span id="setjmpT"><span class="annot"><span class="annottext">setjmpT :: Type
</span><a href="Telomare.Llvm.html#setjmpT"><span class="hs-identifier hs-var hs-var">setjmpT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; AddrSpace -&gt; Type
</span><span class="hs-identifier hs-var">PointerType</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Bool -&gt; Type
</span><span class="hs-identifier hs-var">FunctionType</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; AddrSpace
</span><span class="hs-identifier hs-var">AddrSpace.AddrSpace</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="annot"><a href="Telomare.Llvm.html#longjmpT"><span class="hs-identifier hs-type">longjmpT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-276"></span><span id="longjmpT"><span class="annot"><span class="annottext">longjmpT :: Type
</span><a href="Telomare.Llvm.html#longjmpT"><span class="hs-identifier hs-var hs-var">longjmpT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; AddrSpace -&gt; Type
</span><span class="hs-identifier hs-var">PointerType</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Bool -&gt; Type
</span><span class="hs-identifier hs-var">FunctionType</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier hs-var">VoidType</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; AddrSpace
</span><span class="hs-identifier hs-var">AddrSpace.AddrSpace</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="annot"><a href="Telomare.Llvm.html#gcMallocT"><span class="hs-identifier hs-type">gcMallocT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-279"></span><span id="gcMallocT"><span class="annot"><span class="annottext">gcMallocT :: Type
</span><a href="Telomare.Llvm.html#gcMallocT"><span class="hs-identifier hs-var hs-var">gcMallocT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; AddrSpace -&gt; Type
</span><span class="hs-identifier hs-var">PointerType</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Bool -&gt; Type
</span><span class="hs-identifier hs-var">FunctionType</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; AddrSpace -&gt; Type
</span><span class="hs-identifier hs-var">PointerType</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Type
</span><span class="hs-identifier hs-var">IntegerType</span></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; AddrSpace
</span><span class="hs-identifier hs-var">AddrSpace.AddrSpace</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; AddrSpace
</span><span class="hs-identifier hs-var">AddrSpace.AddrSpace</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span class="annot"><a href="Telomare.Llvm.html#funPtrT"><span class="hs-identifier hs-type">funPtrT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-282"></span><span id="funPtrT"><span class="annot"><span class="annottext">funPtrT :: Type
</span><a href="Telomare.Llvm.html#funPtrT"><span class="hs-identifier hs-var hs-var">funPtrT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; AddrSpace -&gt; Type
</span><span class="hs-identifier hs-var">PointerType</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#funT"><span class="hs-identifier hs-var">funT</span></a></span><span> </span><span class="annot"><span class="annottext">(AddrSpace -&gt; Type) -&gt; AddrSpace -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; AddrSpace
</span><span class="hs-identifier hs-var">AddrSpace.AddrSpace</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="annot"><a href="Telomare.Llvm.html#pairT"><span class="hs-identifier hs-type">pairT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-285"></span><span id="pairT"><span class="annot"><span class="annottext">pairT :: Type
</span><a href="Telomare.Llvm.html#pairT"><span class="hs-identifier hs-var hs-var">pairT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [Type] -&gt; Type
</span><span class="hs-identifier hs-var">StructureType</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="annot"><a href="Telomare.Llvm.html#pairPtrT"><span class="hs-identifier hs-type">pairPtrT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-288"></span><span id="pairPtrT"><span class="annot"><span class="annottext">pairPtrT :: Type
</span><a href="Telomare.Llvm.html#pairPtrT"><span class="hs-identifier hs-var hs-var">pairPtrT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; AddrSpace -&gt; Type
</span><span class="hs-identifier hs-var">PointerType</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#pairT"><span class="hs-identifier hs-var">pairT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; AddrSpace
</span><span class="hs-identifier hs-var">AddrSpace.AddrSpace</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span class="annot"><a href="Telomare.Llvm.html#heapIndexN"><span class="hs-identifier hs-type">heapIndexN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-291"></span><span id="heapIndexN"><span class="annot"><span class="annottext">heapIndexN :: Name
</span><a href="Telomare.Llvm.html#heapIndexN"><span class="hs-identifier hs-var hs-var">heapIndexN</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;heapIndex&quot;</span></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="hs-comment">-- index of next free pair structure</span><span>
</span><span id="line-294"></span><span class="annot"><a href="Telomare.Llvm.html#heapIndex"><span class="hs-identifier hs-type">heapIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Definition</span></span><span>
</span><span id="line-295"></span><span id="heapIndex"><span class="annot"><span class="annottext">heapIndex :: Definition
</span><a href="Telomare.Llvm.html#heapIndex"><span class="hs-identifier hs-var hs-var">heapIndex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Global -&gt; Definition
</span><span class="hs-identifier hs-var">GlobalDefinition</span></span><span>
</span><span id="line-296"></span><span>  </span><span class="annot"><span class="annottext">(Global -&gt; Definition) -&gt; Global -&gt; Definition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Global
</span><span class="hs-identifier hs-var">globalVariableDefaults</span></span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">name :: Name
</span><span class="hs-identifier hs-var">name</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="Telomare.Llvm.html#heapIndexN"><span class="hs-identifier hs-var">heapIndexN</span></a></span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">type' :: Type
</span><span class="hs-identifier hs-var">G.type'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">initializer :: Maybe Constant
</span><span class="hs-identifier hs-var">initializer</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constant -&gt; Maybe Constant
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Integer -&gt; Constant
</span><span class="hs-identifier hs-var">C.Int</span></span><span> </span><span class="annot"><span class="hs-number">64</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="annot"><a href="Telomare.Llvm.html#resultStructureN"><span class="hs-identifier hs-type">resultStructureN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-303"></span><span id="resultStructureN"><span class="annot"><span class="annottext">resultStructureN :: Name
</span><a href="Telomare.Llvm.html#resultStructureN"><span class="hs-identifier hs-var hs-var">resultStructureN</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;resultStructure&quot;</span></span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="annot"><a href="Telomare.Llvm.html#resultStructureT"><span class="hs-identifier hs-type">resultStructureT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-306"></span><span id="resultStructureT"><span class="annot"><span class="annottext">resultStructureT :: Type
</span><a href="Telomare.Llvm.html#resultStructureT"><span class="hs-identifier hs-var hs-var">resultStructureT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [Type] -&gt; Type
</span><span class="hs-identifier hs-var">StructureType</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span class="annot"><a href="Telomare.Llvm.html#resultStructure"><span class="hs-identifier hs-type">resultStructure</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Definition</span></span><span>
</span><span id="line-309"></span><span id="resultStructure"><span class="annot"><span class="annottext">resultStructure :: Definition
</span><a href="Telomare.Llvm.html#resultStructure"><span class="hs-identifier hs-var hs-var">resultStructure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Global -&gt; Definition
</span><span class="hs-identifier hs-var">GlobalDefinition</span></span><span>
</span><span id="line-310"></span><span>  </span><span class="annot"><span class="annottext">(Global -&gt; Definition) -&gt; Global -&gt; Definition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Global
</span><span class="hs-identifier hs-var">globalVariableDefaults</span></span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">name :: Name
</span><span class="hs-identifier hs-var">name</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="Telomare.Llvm.html#resultStructureN"><span class="hs-identifier hs-var">resultStructureN</span></a></span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">type' :: Type
</span><span class="hs-identifier hs-var">G.type'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#resultStructureT"><span class="hs-identifier hs-var">resultStructureT</span></a></span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">initializer :: Maybe Constant
</span><span class="hs-identifier hs-var">initializer</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constant -&gt; Maybe Constant
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Constant -&gt; Maybe Constant) -&gt; Constant -&gt; Maybe Constant
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; Bool -&gt; [Constant] -&gt; Constant
</span><span class="hs-identifier hs-var">C.Struct</span></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Word32 -&gt; Integer -&gt; Constant
</span><span class="hs-identifier hs-var">C.Int</span></span><span> </span><span class="annot"><span class="hs-number">64</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Integer -&gt; Constant
</span><span class="hs-identifier hs-var">C.Int</span></span><span> </span><span class="annot"><span class="hs-number">64</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">]</span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span class="annot"><a href="Telomare.Llvm.html#zero"><span class="hs-identifier hs-type">zero</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span><span>
</span><span id="line-317"></span><span id="zero"><span class="annot"><span class="annottext">zero :: Operand
</span><a href="Telomare.Llvm.html#zero"><span class="hs-identifier hs-var hs-var">zero</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Integer -&gt; Constant
</span><span class="hs-identifier hs-var">C.Int</span></span><span> </span><span class="annot"><span class="hs-number">64</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span class="annot"><a href="Telomare.Llvm.html#one"><span class="hs-identifier hs-type">one</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span><span>
</span><span id="line-319"></span><span id="one"><span class="annot"><span class="annottext">one :: Operand
</span><a href="Telomare.Llvm.html#one"><span class="hs-identifier hs-var hs-var">one</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Integer -&gt; Constant
</span><span class="hs-identifier hs-var">C.Int</span></span><span> </span><span class="annot"><span class="hs-number">64</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span class="annot"><a href="Telomare.Llvm.html#zero32"><span class="hs-identifier hs-type">zero32</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span><span>
</span><span id="line-321"></span><span id="zero32"><span class="annot"><span class="annottext">zero32 :: Operand
</span><a href="Telomare.Llvm.html#zero32"><span class="hs-identifier hs-var hs-var">zero32</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Integer -&gt; Constant
</span><span class="hs-identifier hs-var">C.Int</span></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span class="annot"><a href="Telomare.Llvm.html#one32"><span class="hs-identifier hs-type">one32</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span><span>
</span><span id="line-323"></span><span id="one32"><span class="annot"><span class="annottext">one32 :: Operand
</span><a href="Telomare.Llvm.html#one32"><span class="hs-identifier hs-var hs-var">one32</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Integer -&gt; Constant
</span><span class="hs-identifier hs-var">C.Int</span></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span class="annot"><a href="Telomare.Llvm.html#two32"><span class="hs-identifier hs-type">two32</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span><span>
</span><span id="line-325"></span><span id="two32"><span class="annot"><span class="annottext">two32 :: Operand
</span><a href="Telomare.Llvm.html#two32"><span class="hs-identifier hs-var hs-var">two32</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Integer -&gt; Constant
</span><span class="hs-identifier hs-var">C.Int</span></span><span> </span><span class="annot"><span class="hs-number">32</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span class="hs-keyword">type</span><span> </span><span id="BuilderInternal"><span class="annot"><a href="Telomare.Llvm.html#BuilderInternal"><span class="hs-identifier hs-var">BuilderInternal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span class="hs-keyword">type</span><span> </span><span id="TelomareBuilder"><span class="annot"><a href="Telomare.Llvm.html#TelomareBuilder"><span class="hs-identifier hs-var">TelomareBuilder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IRBuilderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ModuleBuilderT</span></span><span> </span><span class="annot"><a href="Telomare.Llvm.html#BuilderInternal"><span class="hs-identifier hs-type">BuilderInternal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span class="hs-comment">-- | Wrap the argument in a function that accepts an integer (index to environment) as its argument.</span><span>
</span><span id="line-331"></span><span class="annot"><a href="Telomare.Llvm.html#doFunction"><span class="hs-identifier hs-type">doFunction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Naturals.html#NExpr"><span class="hs-identifier hs-type">NExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Telomare.Llvm.html#TelomareBuilder"><span class="hs-identifier hs-type">TelomareBuilder</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span><span>
</span><span id="line-332"></span><span id="doFunction"><span class="annot"><span class="annottext">doFunction :: NExpr -&gt; TelomareBuilder Operand
</span><a href="Telomare.Llvm.html#doFunction"><span class="hs-identifier hs-var hs-var">doFunction</span></a></span></span><span> </span><span id="local-6989586621679441789"><span class="annot"><span class="annottext">body :: NExpr
</span><a href="#local-6989586621679441789"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679441788"><span class="annot"><span class="annottext">functions :: Map ByteString Operand
</span><a href="#local-6989586621679441788"><span class="hs-identifier hs-var">functions</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IRBuilderT
  (ModuleBuilderT BuilderInternal) (Map ByteString Operand, Int)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Map ByteString Operand -&gt; Maybe Operand
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679441785"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Map ByteString Operand
</span><a href="#local-6989586621679441788"><span class="hs-identifier hs-var">functions</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-335"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679441784"><span class="annot"><span class="annottext">f :: Operand
</span><a href="#local-6989586621679441784"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; TelomareBuilder Operand
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441784"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-336"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-337"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679441783"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621679441783"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Name
</span><span class="hs-identifier hs-var">Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;function_&quot;</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; ShortByteString -&gt; ShortByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ShortByteString
</span><span class="hs-identifier hs-var">toShort</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">Base16.encode</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679441785"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>      </span><span class="annot"><span class="annottext">Operand
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModuleBuilderT BuilderInternal Operand -&gt; TelomareBuilder Operand
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ModuleBuilderT BuilderInternal Operand -&gt; TelomareBuilder Operand)
-&gt; ModuleBuilderT BuilderInternal Operand
-&gt; TelomareBuilder Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [(Type, ParameterName)]
-&gt; Type
-&gt; ([Operand] -&gt; IRBuilderT (ModuleBuilderT BuilderInternal) ())
-&gt; ModuleBuilderT BuilderInternal Operand
forall (m :: * -&gt; *).
MonadModuleBuilder m =&gt;
Name
-&gt; [(Type, ParameterName)]
-&gt; Type
-&gt; ([Operand] -&gt; IRBuilderT m ())
-&gt; m Operand
</span><span class="hs-identifier hs-var">IRM.function</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441783"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; ParameterName
</span><span class="hs-identifier hs-var">ParameterName</span></span><span> </span><span class="annot"><span class="hs-string">&quot;env&quot;</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span> </span><span class="annot"><span class="annottext">(([Operand] -&gt; IRBuilderT (ModuleBuilderT BuilderInternal) ())
 -&gt; ModuleBuilderT BuilderInternal Operand)
-&gt; ([Operand] -&gt; IRBuilderT (ModuleBuilderT BuilderInternal) ())
-&gt; ModuleBuilderT BuilderInternal Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-339"></span><span>         </span><span class="hs-comment">-- TODO fix</span><span>
</span><span id="line-340"></span><span>         </span><span class="hs-comment">-- x &lt;- toLLVM body</span><span>
</span><span id="line-341"></span><span>         </span><span id="local-6989586621679441778"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441778"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TelomareBuilder Operand
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-342"></span><span>         </span><span class="annot"><span class="annottext">Operand -&gt; IRBuilderT (ModuleBuilderT BuilderInternal) ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Operand -&gt; m ()
</span><span class="hs-identifier hs-var">IRI.ret</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441778"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-343"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679441777"><span class="annot"><span class="annottext">r :: Operand
</span><a href="#local-6989586621679441777"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constant -&gt; Type -&gt; Constant
</span><span class="hs-identifier hs-var">C.PtrToInt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Name -&gt; Constant
</span><span class="hs-identifier hs-var">C.GlobalReference</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#funT"><span class="hs-identifier hs-var">funT</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441783"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>      </span><span class="annot"><span class="annottext">((Map ByteString Operand, Int) -&gt; (Map ByteString Operand, Int))
-&gt; IRBuilderT (ModuleBuilderT BuilderInternal) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679441773"><span class="annot"><span class="annottext">m :: Map ByteString Operand
</span><a href="#local-6989586621679441773"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679441772"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679441772"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
-&gt; Operand -&gt; Map ByteString Operand -&gt; Map ByteString Operand
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679441785"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441777"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Map ByteString Operand
</span><a href="#local-6989586621679441773"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679441772"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span>      </span><span class="annot"><span class="annottext">Operand -&gt; TelomareBuilder Operand
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441777"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679441785"><span class="annot"><span class="annottext">h :: ByteString
</span><a href="#local-6989586621679441785"><span class="hs-identifier hs-var hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Word8] -&gt; ByteString
</span><span class="hs-identifier hs-var">BS.pack</span></span><span> </span><span class="annot"><span class="annottext">([Word8] -&gt; ByteString)
-&gt; (ByteString -&gt; [Word8]) -&gt; ByteString -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Digest SHA256 -&gt; [Word8]
forall a. ByteArrayAccess a =&gt; a -&gt; [Word8]
</span><span class="hs-identifier hs-var">BA.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Digest SHA256 -&gt; [Word8])
-&gt; (ByteString -&gt; Digest SHA256) -&gt; ByteString -&gt; [Word8]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Digest SHA256
</span><a href="#local-6989586621679441769"><span class="hs-identifier hs-var">hash'</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NExpr -&gt; ByteString
forall a. Binary a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">encode</span></span><span> </span><span class="annot"><span class="annottext">NExpr
</span><a href="#local-6989586621679441789"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-347"></span><span>        </span><span class="annot"><a href="#local-6989586621679441769"><span class="hs-identifier hs-type">hash'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BSL.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Digest</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SHA256</span></span><span>
</span><span id="line-348"></span><span>        </span><span id="local-6989586621679441769"><span class="annot"><span class="annottext">hash' :: ByteString -&gt; Digest SHA256
</span><a href="#local-6989586621679441769"><span class="hs-identifier hs-var hs-var">hash'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Digest SHA256
forall a. HashAlgorithm a =&gt; ByteString -&gt; Digest a
</span><span class="hs-identifier hs-var">hashlazy</span></span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span class="annot"><a href="Telomare.Llvm.html#doAnonFunction"><span class="hs-identifier hs-type">doAnonFunction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Telomare.Llvm.html#TelomareBuilder"><span class="hs-identifier hs-type">TelomareBuilder</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Telomare.Llvm.html#TelomareBuilder"><span class="hs-identifier hs-type">TelomareBuilder</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span><span>
</span><span id="line-351"></span><span id="doAnonFunction"><span class="annot"><span class="annottext">doAnonFunction :: TelomareBuilder Operand -&gt; TelomareBuilder Operand
</span><a href="Telomare.Llvm.html#doAnonFunction"><span class="hs-identifier hs-var hs-var">doAnonFunction</span></a></span></span><span> </span><span id="local-6989586621679441767"><span class="annot"><span class="annottext">doBody :: TelomareBuilder Operand
</span><a href="#local-6989586621679441767"><span class="hs-identifier hs-var">doBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-352"></span><span>  </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679441766"><span class="annot"><span class="annottext">fn :: Int
</span><a href="#local-6989586621679441766"><span class="hs-identifier hs-var">fn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IRBuilderT
  (ModuleBuilderT BuilderInternal) (Map ByteString Operand, Int)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-353"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679441765"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621679441765"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Name
</span><span class="hs-identifier hs-var">Name</span></span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; Name) -&gt; ShortByteString -&gt; Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShortByteString
forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;anonFunction_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679441766"><span class="hs-identifier hs-var">fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>  </span><span class="annot"><span class="annottext">Operand
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModuleBuilderT BuilderInternal Operand -&gt; TelomareBuilder Operand
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(ModuleBuilderT BuilderInternal Operand -&gt; TelomareBuilder Operand)
-&gt; ModuleBuilderT BuilderInternal Operand
-&gt; TelomareBuilder Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [(Type, ParameterName)]
-&gt; Type
-&gt; ([Operand] -&gt; IRBuilderT (ModuleBuilderT BuilderInternal) ())
-&gt; ModuleBuilderT BuilderInternal Operand
forall (m :: * -&gt; *).
MonadModuleBuilder m =&gt;
Name
-&gt; [(Type, ParameterName)]
-&gt; Type
-&gt; ([Operand] -&gt; IRBuilderT m ())
-&gt; m Operand
</span><span class="hs-identifier hs-var">IRM.function</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441765"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; ParameterName
</span><span class="hs-identifier hs-var">ParameterName</span></span><span> </span><span class="annot"><span class="hs-string">&quot;env&quot;</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span> </span><span class="annot"><span class="annottext">(([Operand] -&gt; IRBuilderT (ModuleBuilderT BuilderInternal) ())
 -&gt; ModuleBuilderT BuilderInternal Operand)
-&gt; ([Operand] -&gt; IRBuilderT (ModuleBuilderT BuilderInternal) ())
-&gt; ModuleBuilderT BuilderInternal Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TelomareBuilder Operand
</span><a href="#local-6989586621679441767"><span class="hs-identifier hs-var">doBody</span></a></span><span> </span><span class="annot"><span class="annottext">TelomareBuilder Operand
-&gt; (Operand -&gt; IRBuilderT (ModuleBuilderT BuilderInternal) ())
-&gt; IRBuilderT (ModuleBuilderT BuilderInternal) ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Operand -&gt; IRBuilderT (ModuleBuilderT BuilderInternal) ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Operand -&gt; m ()
</span><span class="hs-identifier hs-var">IRI.ret</span></span><span>
</span><span id="line-355"></span><span>  </span><span class="annot"><span class="annottext">((Map ByteString Operand, Int) -&gt; (Map ByteString Operand, Int))
-&gt; IRBuilderT (ModuleBuilderT BuilderInternal) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679441764"><span class="annot"><span class="annottext">m :: Map ByteString Operand
</span><a href="#local-6989586621679441764"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679441763"><span class="annot"><span class="annottext">i :: Int
</span><a href="#local-6989586621679441763"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map ByteString Operand
</span><a href="#local-6989586621679441764"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679441763"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>  </span><span class="annot"><span class="annottext">Operand -&gt; TelomareBuilder Operand
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Operand -&gt; TelomareBuilder Operand)
-&gt; Operand -&gt; TelomareBuilder Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constant -&gt; Type -&gt; Constant
</span><span class="hs-identifier hs-var">C.PtrToInt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Name -&gt; Constant
</span><span class="hs-identifier hs-var">C.GlobalReference</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#funT"><span class="hs-identifier hs-var">funT</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441765"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span class="annot"><a href="Telomare.Llvm.html#pairOffC"><span class="hs-identifier hs-type">pairOffC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span><span>
</span><span id="line-359"></span><span id="pairOffC"><span class="annot"><span class="annottext">pairOffC :: Operand
</span><a href="Telomare.Llvm.html#pairOffC"><span class="hs-identifier hs-var hs-var">pairOffC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Integer -&gt; Constant
</span><span class="hs-identifier hs-var">C.Int</span></span><span> </span><span class="annot"><span class="hs-number">64</span></span><span> </span><span class="annot"><span class="hs-number">16</span></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span class="annot"><a href="Telomare.Llvm.html#heapIndexC"><span class="hs-identifier hs-type">heapIndexC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span><span>
</span><span id="line-362"></span><span id="heapIndexC"><span class="annot"><span class="annottext">heapIndexC :: Operand
</span><a href="Telomare.Llvm.html#heapIndexC"><span class="hs-identifier hs-var hs-var">heapIndexC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Name -&gt; Constant
</span><span class="hs-identifier hs-var">C.GlobalReference</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intPtrT"><span class="hs-identifier hs-var">intPtrT</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="Telomare.Llvm.html#heapIndexN"><span class="hs-identifier hs-var">heapIndexN</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span id="local-6989586621679442019"><span class="annot"><a href="Telomare.Llvm.html#gcMallocPair"><span class="hs-identifier hs-type">gcMallocPair</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadModuleBuilder</span></span><span> </span><span class="annot"><a href="#local-6989586621679442019"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIRBuilder</span></span><span> </span><span class="annot"><a href="#local-6989586621679442019"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679442019"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span></span><span>
</span><span id="line-365"></span><span id="gcMallocPair"><span class="annot"><span class="annottext">gcMallocPair :: m Operand
</span><a href="Telomare.Llvm.html#gcMallocPair"><span class="hs-identifier hs-var hs-var">gcMallocPair</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-366"></span><span>  </span><span id="local-6989586621679441760"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441760"><span class="hs-identifier hs-var">sizePtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; [Operand] -&gt; m Operand
forall (m :: * -&gt; *).
(MonadIRBuilder m, MonadModuleBuilder m) =&gt;
Operand -&gt; [Operand] -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.gep</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Constant
</span><span class="hs-identifier hs-var">C.Null</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#pairPtrT"><span class="hs-identifier hs-var">pairPtrT</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#one32"><span class="hs-identifier hs-var">one32</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-367"></span><span>    </span><span class="annot"><span class="annottext">m Operand -&gt; ShortByteString -&gt; m Operand
forall (m :: * -&gt; *) r.
MonadIRBuilder m =&gt;
m r -&gt; ShortByteString -&gt; m r
</span><span class="hs-operator hs-var">`named`</span></span><span> </span><span class="annot"><span class="hs-string">&quot;size.ptr&quot;</span></span><span>
</span><span id="line-368"></span><span>  </span><span id="local-6989586621679441758"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441758"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Type -&gt; m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Type -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.ptrtoint</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441760"><span class="hs-identifier hs-var">sizePtr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span> </span><span class="annot"><span class="annottext">m Operand -&gt; ShortByteString -&gt; m Operand
forall (m :: * -&gt; *) r.
MonadIRBuilder m =&gt;
m r -&gt; ShortByteString -&gt; m r
</span><span class="hs-operator hs-var">`named`</span></span><span> </span><span class="annot"><span class="hs-string">&quot;size&quot;</span></span><span>
</span><span id="line-369"></span><span>  </span><span id="local-6989586621679441756"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441756"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; [(Operand, [ParameterAttribute])] -&gt; m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; [(Operand, [ParameterAttribute])] -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.call</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Name -&gt; Constant
</span><span class="hs-identifier hs-var">C.GlobalReference</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#gcMallocT"><span class="hs-identifier hs-var">gcMallocT</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;GC_malloc&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441758"><span class="hs-identifier hs-var">size</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-370"></span><span>  </span><span class="annot"><span class="annottext">Operand -&gt; Type -&gt; m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Type -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.bitcast</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441756"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#pairPtrT"><span class="hs-identifier hs-var">pairPtrT</span></a></span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span class="hs-comment">-- | @makePair a b@ allocates a new pair (a,b) at the current heap</span><span>
</span><span id="line-373"></span><span class="hs-comment">-- index and increments the heap index.</span><span>
</span><span id="line-374"></span><span id="local-6989586621679441754"><span class="annot"><a href="Telomare.Llvm.html#makePair"><span class="hs-identifier hs-type">makePair</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadModuleBuilder</span></span><span> </span><span class="annot"><a href="#local-6989586621679441754"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIRBuilder</span></span><span> </span><span class="annot"><a href="#local-6989586621679441754"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679441754"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span></span><span>
</span><span id="line-375"></span><span id="makePair"><span class="annot"><span class="annottext">makePair :: Operand -&gt; Operand -&gt; m Operand
</span><a href="Telomare.Llvm.html#makePair"><span class="hs-identifier hs-var hs-var">makePair</span></a></span></span><span> </span><span id="local-6989586621679441752"><span class="annot"><span class="annottext">a :: Operand
</span><a href="#local-6989586621679441752"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679441751"><span class="annot"><span class="annottext">b :: Operand
</span><a href="#local-6989586621679441751"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-376"></span><span>  </span><span id="local-6989586621679441750"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441750"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Operand
forall (m :: * -&gt; *).
(MonadModuleBuilder m, MonadIRBuilder m) =&gt;
m Operand
</span><a href="Telomare.Llvm.html#gcMallocPair"><span class="hs-identifier hs-var">gcMallocPair</span></a></span><span>
</span><span id="line-377"></span><span>  </span><span id="local-6989586621679441749"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441749"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; [Operand] -&gt; m Operand
forall (m :: * -&gt; *).
(MonadIRBuilder m, MonadModuleBuilder m) =&gt;
Operand -&gt; [Operand] -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.gep</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441750"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#zero"><span class="hs-identifier hs-var">zero</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#zero32"><span class="hs-identifier hs-var">zero32</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-378"></span><span>  </span><span id="local-6989586621679441748"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441748"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; [Operand] -&gt; m Operand
forall (m :: * -&gt; *).
(MonadIRBuilder m, MonadModuleBuilder m) =&gt;
Operand -&gt; [Operand] -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.gep</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441750"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#zero"><span class="hs-identifier hs-var">zero</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#one32"><span class="hs-identifier hs-var">one32</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-379"></span><span>  </span><span class="annot"><span class="annottext">Operand -&gt; Word32 -&gt; Operand -&gt; m ()
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Word32 -&gt; Operand -&gt; m ()
</span><span class="hs-identifier hs-var">IRI.store</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441749"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441752"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-380"></span><span>  </span><span class="annot"><span class="annottext">Operand -&gt; Word32 -&gt; Operand -&gt; m ()
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Word32 -&gt; Operand -&gt; m ()
</span><span class="hs-identifier hs-var">IRI.store</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441748"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441751"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-381"></span><span>  </span><span id="local-6989586621679441747"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441747"><span class="hs-identifier hs-var">heap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Word32 -&gt; m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Word32 -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.load</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#heapIndexC"><span class="hs-identifier hs-var">heapIndexC</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-382"></span><span>  </span><span id="local-6989586621679441746"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441746"><span class="hs-identifier hs-var">nc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Operand -&gt; m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Operand -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.add</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441747"><span class="hs-identifier hs-var">heap</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#one"><span class="hs-identifier hs-var">one</span></a></span><span>
</span><span id="line-383"></span><span>  </span><span class="annot"><span class="annottext">Operand -&gt; Word32 -&gt; Operand -&gt; m ()
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Word32 -&gt; Operand -&gt; m ()
</span><span class="hs-identifier hs-var">IRI.store</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#heapIndexC"><span class="hs-identifier hs-var">heapIndexC</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441746"><span class="hs-identifier hs-var">nc</span></a></span><span>
</span><span id="line-384"></span><span>  </span><span class="annot"><span class="annottext">Operand -&gt; Type -&gt; m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Type -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.ptrtoint</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441750"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span class="hs-comment">-- | @goLeft p@ loads the first element of the pair @p@.</span><span>
</span><span id="line-387"></span><span id="local-6989586621679442123"><span class="annot"><a href="Telomare.Llvm.html#goLeft"><span class="hs-identifier hs-type">goLeft</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadModuleBuilder</span></span><span> </span><span class="annot"><a href="#local-6989586621679442123"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFix</span></span><span> </span><span class="annot"><a href="#local-6989586621679442123"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679442123"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span></span><span>
</span><span id="line-388"></span><span id="goLeft"><span class="annot"><span class="annottext">goLeft :: m Operand
</span><a href="Telomare.Llvm.html#goLeft"><span class="hs-identifier hs-var hs-var">goLeft</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [(Type, ParameterName)]
-&gt; Type
-&gt; ([Operand] -&gt; IRBuilderT m ())
-&gt; m Operand
forall (m :: * -&gt; *).
MonadModuleBuilder m =&gt;
Name
-&gt; [(Type, ParameterName)]
-&gt; Type
-&gt; ([Operand] -&gt; IRBuilderT m ())
-&gt; m Operand
</span><span class="hs-identifier hs-var">IRM.function</span></span><span> </span><span class="annot"><span class="hs-string">&quot;goLeft&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; ParameterName
</span><span class="hs-identifier hs-var">ParameterName</span></span><span> </span><span class="annot"><span class="hs-string">&quot;x&quot;</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span> </span><span class="annot"><span class="annottext">(([Operand] -&gt; IRBuilderT m ()) -&gt; m Operand)
-&gt; ([Operand] -&gt; IRBuilderT m ()) -&gt; m Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">[</span><span id="local-6989586621679441744"><span class="annot"><span class="annottext">xp :: Operand
</span><a href="#local-6989586621679441744"><span class="hs-identifier hs-var">xp</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">mdo</span><span>
</span><span id="line-389"></span><span>  </span><span id="local-6989586621679441743"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441743"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntegerPredicate -&gt; Operand -&gt; Operand -&gt; IRBuilderT m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
IntegerPredicate -&gt; Operand -&gt; Operand -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.icmp</span></span><span> </span><span class="annot"><span class="annottext">IntegerPredicate
</span><span class="hs-identifier hs-var">IP.EQ</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441744"><span class="hs-identifier hs-var">xp</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#zero"><span class="hs-identifier hs-var">zero</span></a></span><span>
</span><span id="line-390"></span><span>  </span><span class="annot"><span class="annottext">Operand -&gt; Name -&gt; Name -&gt; IRBuilderT m ()
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Name -&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">IRI.condBr</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441743"><span class="hs-identifier hs-var">cond</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441742"><span class="hs-identifier hs-var">ptrZero</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441741"><span class="hs-identifier hs-var">ptrNonZero</span></a></span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span>  </span><span id="local-6989586621679441742"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441742"><span class="hs-identifier hs-var">ptrZero</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IRBuilderT m Name
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; m Name
</span><span class="hs-identifier hs-var">block</span></span><span>
</span><span id="line-393"></span><span>  </span><span id="local-6989586621679441740"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441740"><span class="hs-identifier hs-var">ptrZeroRes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; IRBuilderT m Operand
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#zero"><span class="hs-identifier hs-var">zero</span></a></span><span>
</span><span id="line-394"></span><span>  </span><span class="annot"><span class="annottext">Name -&gt; IRBuilderT m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">IRI.br</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441739"><span class="hs-identifier hs-var">exit</span></a></span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span>  </span><span id="local-6989586621679441741"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441741"><span class="hs-identifier hs-var">ptrNonZero</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IRBuilderT m Name
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; m Name
</span><span class="hs-identifier hs-var">block</span></span><span>
</span><span id="line-397"></span><span>  </span><span id="local-6989586621679441738"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441738"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Type -&gt; IRBuilderT m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Type -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.inttoptr</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441744"><span class="hs-identifier hs-var">xp</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#pairPtrT"><span class="hs-identifier hs-var">pairPtrT</span></a></span><span>
</span><span id="line-398"></span><span>  </span><span id="local-6989586621679441736"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441736"><span class="hs-identifier hs-var">la</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; [Operand] -&gt; IRBuilderT m Operand
forall (m :: * -&gt; *).
(MonadIRBuilder m, MonadModuleBuilder m) =&gt;
Operand -&gt; [Operand] -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.gep</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441738"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#zero"><span class="hs-identifier hs-var">zero</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#zero32"><span class="hs-identifier hs-var">zero32</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-399"></span><span>  </span><span id="local-6989586621679441735"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441735"><span class="hs-identifier hs-var">ptrNonZeroRes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Word32 -&gt; IRBuilderT m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Word32 -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.load</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441736"><span class="hs-identifier hs-var">la</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-400"></span><span>  </span><span class="annot"><span class="annottext">Name -&gt; IRBuilderT m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">IRI.br</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441739"><span class="hs-identifier hs-var">exit</span></a></span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span>  </span><span id="local-6989586621679441739"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441739"><span class="hs-identifier hs-var">exit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IRBuilderT m Name
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; m Name
</span><span class="hs-identifier hs-var">block</span></span><span>
</span><span id="line-403"></span><span>  </span><span id="local-6989586621679441734"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441734"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Operand, Name)] -&gt; IRBuilderT m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
[(Operand, Name)] -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.phi</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441740"><span class="hs-identifier hs-var">ptrZeroRes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441742"><span class="hs-identifier hs-var">ptrZero</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441735"><span class="hs-identifier hs-var">ptrNonZeroRes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441741"><span class="hs-identifier hs-var">ptrNonZero</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-404"></span><span>  </span><span class="annot"><span class="annottext">Operand -&gt; IRBuilderT m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Operand -&gt; m ()
</span><span class="hs-identifier hs-var">IRI.ret</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441734"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span class="hs-comment">-- | @goRight p@ loads the second element of the pair @p@.</span><span>
</span><span id="line-407"></span><span id="local-6989586621679441733"><span class="annot"><a href="Telomare.Llvm.html#goRight"><span class="hs-identifier hs-type">goRight</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadModuleBuilder</span></span><span> </span><span class="annot"><a href="#local-6989586621679441733"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFix</span></span><span> </span><span class="annot"><a href="#local-6989586621679441733"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679441733"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span></span><span>
</span><span id="line-408"></span><span id="goRight"><span class="annot"><span class="annottext">goRight :: m Operand
</span><a href="Telomare.Llvm.html#goRight"><span class="hs-identifier hs-var hs-var">goRight</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [(Type, ParameterName)]
-&gt; Type
-&gt; ([Operand] -&gt; IRBuilderT m ())
-&gt; m Operand
forall (m :: * -&gt; *).
MonadModuleBuilder m =&gt;
Name
-&gt; [(Type, ParameterName)]
-&gt; Type
-&gt; ([Operand] -&gt; IRBuilderT m ())
-&gt; m Operand
</span><span class="hs-identifier hs-var">IRM.function</span></span><span> </span><span class="annot"><span class="hs-string">&quot;goRight&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; ParameterName
</span><span class="hs-identifier hs-var">ParameterName</span></span><span> </span><span class="annot"><span class="hs-string">&quot;x&quot;</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span> </span><span class="annot"><span class="annottext">(([Operand] -&gt; IRBuilderT m ()) -&gt; m Operand)
-&gt; ([Operand] -&gt; IRBuilderT m ()) -&gt; m Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">[</span><span id="local-6989586621679441732"><span class="annot"><span class="annottext">xp :: Operand
</span><a href="#local-6989586621679441732"><span class="hs-identifier hs-var">xp</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">mdo</span><span>
</span><span id="line-409"></span><span>  </span><span id="local-6989586621679441731"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441731"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IntegerPredicate -&gt; Operand -&gt; Operand -&gt; IRBuilderT m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
IntegerPredicate -&gt; Operand -&gt; Operand -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.icmp</span></span><span> </span><span class="annot"><span class="annottext">IntegerPredicate
</span><span class="hs-identifier hs-var">IP.EQ</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441732"><span class="hs-identifier hs-var">xp</span></a></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#zero"><span class="hs-identifier hs-var">zero</span></a></span><span>
</span><span id="line-410"></span><span>  </span><span class="annot"><span class="annottext">Operand -&gt; Name -&gt; Name -&gt; IRBuilderT m ()
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Name -&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">IRI.condBr</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441731"><span class="hs-identifier hs-var">cond</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441730"><span class="hs-identifier hs-var">ptrZero</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441729"><span class="hs-identifier hs-var">ptrNonZero</span></a></span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span>  </span><span id="local-6989586621679441730"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441730"><span class="hs-identifier hs-var">ptrZero</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IRBuilderT m Name
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; m Name
</span><span class="hs-identifier hs-var">block</span></span><span>
</span><span id="line-413"></span><span>  </span><span id="local-6989586621679441728"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441728"><span class="hs-identifier hs-var">ptrZeroRes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; IRBuilderT m Operand
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#zero"><span class="hs-identifier hs-var">zero</span></a></span><span>
</span><span id="line-414"></span><span>  </span><span class="annot"><span class="annottext">Name -&gt; IRBuilderT m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">IRI.br</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441727"><span class="hs-identifier hs-var">exit</span></a></span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span>  </span><span id="local-6989586621679441729"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441729"><span class="hs-identifier hs-var">ptrNonZero</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IRBuilderT m Name
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; m Name
</span><span class="hs-identifier hs-var">block</span></span><span>
</span><span id="line-417"></span><span>  </span><span id="local-6989586621679441726"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441726"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Type -&gt; IRBuilderT m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Type -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.inttoptr</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441732"><span class="hs-identifier hs-var">xp</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#pairPtrT"><span class="hs-identifier hs-var">pairPtrT</span></a></span><span>
</span><span id="line-418"></span><span>  </span><span id="local-6989586621679441725"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441725"><span class="hs-identifier hs-var">la</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; [Operand] -&gt; IRBuilderT m Operand
forall (m :: * -&gt; *).
(MonadIRBuilder m, MonadModuleBuilder m) =&gt;
Operand -&gt; [Operand] -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.gep</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441726"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#zero"><span class="hs-identifier hs-var">zero</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="Telomare.Llvm.html#one32"><span class="hs-identifier hs-var">one32</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-419"></span><span>  </span><span id="local-6989586621679441724"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441724"><span class="hs-identifier hs-var">ptrNonZeroRes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; Word32 -&gt; IRBuilderT m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; Word32 -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.load</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441725"><span class="hs-identifier hs-var">la</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-420"></span><span>  </span><span class="annot"><span class="annottext">Name -&gt; IRBuilderT m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Name -&gt; m ()
</span><span class="hs-identifier hs-var">IRI.br</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441727"><span class="hs-identifier hs-var">exit</span></a></span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span>  </span><span id="local-6989586621679441727"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441727"><span class="hs-identifier hs-var">exit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IRBuilderT m Name
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; m Name
</span><span class="hs-identifier hs-var">block</span></span><span>
</span><span id="line-423"></span><span>  </span><span id="local-6989586621679441723"><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441723"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Operand, Name)] -&gt; IRBuilderT m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
[(Operand, Name)] -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.phi</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441728"><span class="hs-identifier hs-var">ptrZeroRes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441730"><span class="hs-identifier hs-var">ptrZero</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441724"><span class="hs-identifier hs-var">ptrNonZeroRes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679441729"><span class="hs-identifier hs-var">ptrNonZero</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-424"></span><span>  </span><span class="annot"><span class="annottext">Operand -&gt; IRBuilderT m ()
forall (m :: * -&gt; *). MonadIRBuilder m =&gt; Operand -&gt; m ()
</span><span class="hs-identifier hs-var">IRI.ret</span></span><span> </span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441723"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-425"></span><span>
</span><span id="line-426"></span><span id="local-6989586621679441722"><span class="annot"><a href="Telomare.Llvm.html#doLeft"><span class="hs-identifier hs-type">doLeft</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIRBuilder</span></span><span> </span><span class="annot"><a href="#local-6989586621679441722"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679441722"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span></span><span>
</span><span id="line-427"></span><span id="doLeft"><span class="annot"><span class="annottext">doLeft :: Operand -&gt; m Operand
</span><a href="Telomare.Llvm.html#doLeft"><span class="hs-identifier hs-var hs-var">doLeft</span></a></span></span><span> </span><span id="local-6989586621679441720"><span class="annot"><span class="annottext">x :: Operand
</span><a href="#local-6989586621679441720"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; [(Operand, [ParameterAttribute])] -&gt; m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; [(Operand, [ParameterAttribute])] -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.call</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Name -&gt; Constant
</span><span class="hs-identifier hs-var">C.GlobalReference</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#funT"><span class="hs-identifier hs-var">funT</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;goLeft&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441720"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span id="local-6989586621679441719"><span class="annot"><a href="Telomare.Llvm.html#doRight"><span class="hs-identifier hs-type">doRight</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIRBuilder</span></span><span> </span><span class="annot"><a href="#local-6989586621679441719"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679441719"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span></span><span>
</span><span id="line-430"></span><span id="doRight"><span class="annot"><span class="annottext">doRight :: Operand -&gt; m Operand
</span><a href="Telomare.Llvm.html#doRight"><span class="hs-identifier hs-var hs-var">doRight</span></a></span></span><span> </span><span id="local-6989586621679441717"><span class="annot"><span class="annottext">x :: Operand
</span><a href="#local-6989586621679441717"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Operand -&gt; [(Operand, [ParameterAttribute])] -&gt; m Operand
forall (m :: * -&gt; *).
MonadIRBuilder m =&gt;
Operand -&gt; [(Operand, [ParameterAttribute])] -&gt; m Operand
</span><span class="hs-identifier hs-var">IRI.call</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Name -&gt; Constant
</span><span class="hs-identifier hs-var">C.GlobalReference</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#funT"><span class="hs-identifier hs-var">funT</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;goRight&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Operand
</span><a href="#local-6989586621679441717"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span class="annot"><a href="Telomare.Llvm.html#envC"><span class="hs-identifier hs-type">envC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span><span>
</span><span id="line-433"></span><span id="envC"><span class="annot"><span class="annottext">envC :: Operand
</span><a href="Telomare.Llvm.html#envC"><span class="hs-identifier hs-var hs-var">envC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Name -&gt; Operand
</span><span class="hs-identifier hs-var">LocalReference</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#intT"><span class="hs-identifier hs-var">intT</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;env&quot;</span></span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span id="local-6989586621679441714"><span class="annot"><a href="Telomare.Llvm.html#lComment"><span class="hs-identifier hs-type">lComment</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679441714"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679441714"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MDRef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">MDNode</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-436"></span><span id="lComment"><span class="annot"><span class="annottext">lComment :: a -&gt; (a, MDRef MDNode)
</span><a href="Telomare.Llvm.html#lComment"><span class="hs-identifier hs-var hs-var">lComment</span></a></span></span><span> </span><span id="local-6989586621679441712"><span class="annot"><span class="annottext">s :: a
</span><a href="#local-6989586621679441712"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679441712"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MDNode -&gt; MDRef MDNode
forall a. a -&gt; MDRef a
</span><span class="hs-identifier hs-var">MDInline</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe Metadata] -&gt; MDNode
</span><span class="hs-identifier hs-var">MDTuple</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span class="annot"><a href="Telomare.Llvm.html#toLLVM"><span class="hs-identifier hs-type">toLLVM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Telomare.html#FragIndex"><span class="hs-identifier hs-type">FragIndex</span></a></span><span> </span><span class="annot"><a href="Naturals.html#ExprFrag"><span class="hs-identifier hs-type">ExprFrag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Naturals.html#ExprFrag"><span class="hs-identifier hs-type">ExprFrag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Telomare.Llvm.html#TelomareBuilder"><span class="hs-identifier hs-type">TelomareBuilder</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span><span>
</span><span id="line-439"></span><span id="toLLVM"><span class="annot"><span class="annottext">toLLVM :: Map FragIndex ExprFrag -&gt; ExprFrag -&gt; TelomareBuilder Operand
</span><a href="Telomare.Llvm.html#toLLVM"><span class="hs-identifier hs-var hs-var">toLLVM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map FragIndex ExprFrag -&gt; ExprFrag -&gt; TelomareBuilder Operand
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-440"></span><span class="hs-comment">-- chunks of AST that can be translated to optimized instructions</span><span>
</span><span id="line-441"></span><span class="hs-comment">-- single instruction translation</span><span>
</span><span id="line-442"></span><span class="hs-comment">{-
toLLVM _ _ FZero = pure zero
toLLVM helpers envType (FPair a b) = do
  oa &lt;- toLLVM helpers envType a
  ob &lt;- toLLVM helpers envType b
  makePair oa ob
toLLVM helpers (FLeft x) = toLLVM helpers x &gt;&gt;= doLeft
toLLVM helpers (FRight x) = toLLVM helpers x &gt;&gt;= doRight
toLLVM _ FEnv = pure envC
toLLVM helpers (FDefer x) = doFunction x
toLLVM helpers (FSetEnv x) = do
  -- Evaluate x to (clo, env)
  xp &lt;- toLLVM helpers x
  ptr &lt;- IRI.inttoptr xp pairPtrT
  l &lt;- IRI.gep ptr [zero, zero32]
  r &lt;- IRI.gep ptr [zero, one32]
  clo &lt;- IRI.load l 0
  env &lt;- IRI.load r 0
  funPtr &lt;- IRI.inttoptr clo funT
  -- Call the function stored at clo with argument env
  IRI.call funPtr [(env, [])]
toLLVM helpers (FGate x) = do
  lx &lt;- toLLVM helpers x
  bool &lt;- IRI.icmp IP.NE lx zero
  IRI.select bool
    (ConstantOperand (C.PtrToInt (C.GlobalReference funT &quot;goRight&quot;) intT))
    (ConstantOperand (C.PtrToInt (C.GlobalReference funT &quot;goLeft&quot;) intT))
toLLVM helpers (FAbort x) = mdo
  lx &lt;- toLLVM helpers x
  brCond &lt;- IRI.icmp IP.EQ lx zero
  emitTerm (CondBr brCond exitB abortB [])

  abortB &lt;- block `named` &quot;abort&quot;
  _ &lt;- IRI.call (ConstantOperand (C.GlobalReference longjmpT &quot;w_longjmp&quot;)) [(lx, [])]
  IRI.unreachable

  exitB &lt;- block `named` &quot;exit&quot;
  pure zero
-- toLLVM (NNum i) = int64 (fromIntegral i)
toLLVM (NAdd a b) = do
  a' &lt;- toLLVM a
  b' &lt;- toLLVM b
  IRI.add a' b'
toLLVM (NMult a b) = do
  a' &lt;- toLLVM a
  b' &lt;- toLLVM b
  IRI.mul a' b'
toLLVM (NITE c t f) = mdo
  c' &lt;- toLLVM c
  cond &lt;- IRI.icmp IP.NE c' zero
  IRI.condBr cond ifThen ifElse

  ifThen &lt;- block `named` &quot;if.then&quot;
  trueVal &lt;- toLLVM t
  ifThenEnd &lt;- currentBlock
  IRI.br ifExit

  ifElse &lt;- block `named` &quot;if.else&quot;
  falseVal &lt;- toLLVM f
  ifElseEnd &lt;- currentBlock
  IRI.br ifExit

  ifExit &lt;- block `named` &quot;if.exit&quot;
  IRI.phi [(trueVal, ifThenEnd), (falseVal, ifElseEnd)]
toLLVM (NtoChurch x) = do
  cf &lt;- doAnonFunction $ do
    innerF &lt;- doAnonFunction $ mdo
      startI &lt;- toLLVM x
      fun &lt;- doRight envC &gt;&gt;= doLeft
      funPtr &lt;- IRI.inttoptr fun funT
      savedEnv &lt;- doRight envC
      entry &lt;- currentBlock
      IRI.br loop

      loop &lt;- block `named` &quot;toChurch.loop&quot;
      currentI &lt;- IRI.phi [(startI, entry), (nextI, loop)]
      currentVal &lt;- IRI.phi [(envC, entry), (nextV, loop)]
      fResult &lt;- IRI.call funPtr [(currentVal, [])]
      nextV &lt;- makePair fResult savedEnv
      nextI &lt;- IRI.sub currentI one
      cond &lt;- IRI.icmp IP.EQ nextI zero
      IRI.condBr cond exit loop

      exit &lt;- block `named` &quot;toChurch.exit&quot;
      pure fResult
    makePair innerF envC
  makePair cf envC
-- TODO this will be hard
toLLVM (NTrace x) = toLLVM x
-}</span><span>
</span><span id="line-532"></span><span>
</span><span id="line-533"></span><span class="annot"><a href="Telomare.Llvm.html#resultC"><span class="hs-identifier hs-type">resultC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Operand</span></span><span>
</span><span id="line-534"></span><span id="resultC"><span class="annot"><span class="annottext">resultC :: Operand
</span><a href="Telomare.Llvm.html#resultC"><span class="hs-identifier hs-var hs-var">resultC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constant -&gt; Operand
</span><span class="hs-identifier hs-var">ConstantOperand</span></span><span> </span><span class="annot"><span class="annottext">(Constant -&gt; Operand) -&gt; Constant -&gt; Operand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Name -&gt; Constant
</span><span class="hs-identifier hs-var">C.GlobalReference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; AddrSpace -&gt; Type
</span><span class="hs-identifier hs-var">PointerType</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Telomare.Llvm.html#resultStructureT"><span class="hs-identifier hs-var">resultStructureT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; AddrSpace
</span><span class="hs-identifier hs-var">AddrSpace.AddrSpace</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="Telomare.Llvm.html#resultStructureN"><span class="hs-identifier hs-var">resultStructureN</span></a></span><span>
</span><span id="line-535"></span></pre></body></html>