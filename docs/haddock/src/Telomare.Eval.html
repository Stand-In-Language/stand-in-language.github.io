<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><a name="line-2"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Telomare.Eval</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-3"></a><span>
</span><a name="line-4"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Except</span><span>
</span><a name="line-5"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Map</span><span>             </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span class="hs-special">)</span><span>
</span><a name="line-6"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span>             </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-7"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Debug.Trace</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-keyword">import</span><span>           </span><a href="Telomare.html"><span class="hs-identifier">Telomare</span></a><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span>           </span><a href="Telomare.Optimizer.html"><span class="hs-identifier">Telomare.Optimizer</span></a><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span>           </span><a href="Telomare.Parser.html"><span class="hs-identifier">Telomare.Parser</span></a><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span>           </span><a href="Telomare.RunTime.html"><span class="hs-identifier">Telomare.RunTime</span></a><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span>           </span><a href="Telomare.TypeChecker.html"><span class="hs-identifier">Telomare.TypeChecker</span></a><span>
</span><a name="line-14"></a><span class="hs-comment">-- TODO: FIX.</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- Maybe specifying ghc's all-cabal-hashes</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- import Telomare.Serializer</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-keyword">data</span><span> </span><a name="ExpP"><a href="Telomare.Eval.html#ExpP"><span class="hs-identifier">ExpP</span></a></a><span>
</span><a name="line-19"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="ZeroP"><a href="Telomare.Eval.html#ZeroP"><span class="hs-identifier">ZeroP</span></a></a><span>
</span><a name="line-20"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="PairP"><a href="Telomare.Eval.html#PairP"><span class="hs-identifier">PairP</span></a></a><span> </span><a href="Telomare.Eval.html#ExpP"><span class="hs-identifier hs-type">ExpP</span></a><span> </span><a href="Telomare.Eval.html#ExpP"><span class="hs-identifier hs-type">ExpP</span></a><span>
</span><a name="line-21"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="VarP"><a href="Telomare.Eval.html#VarP"><span class="hs-identifier">VarP</span></a></a><span>
</span><a name="line-22"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SetEnvP"><a href="Telomare.Eval.html#SetEnvP"><span class="hs-identifier">SetEnvP</span></a></a><span> </span><a href="Telomare.Eval.html#ExpP"><span class="hs-identifier hs-type">ExpP</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-23"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DeferP"><a href="Telomare.Eval.html#DeferP"><span class="hs-identifier">DeferP</span></a></a><span> </span><a href="Telomare.Eval.html#ExpP"><span class="hs-identifier hs-type">ExpP</span></a><span>
</span><a name="line-24"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="AbortP"><a href="Telomare.Eval.html#AbortP"><span class="hs-identifier">AbortP</span></a></a><span>
</span><a name="line-25"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="GateP"><a href="Telomare.Eval.html#GateP"><span class="hs-identifier">GateP</span></a></a><span> </span><a href="Telomare.Eval.html#ExpP"><span class="hs-identifier hs-type">ExpP</span></a><span> </span><a href="Telomare.Eval.html#ExpP"><span class="hs-identifier hs-type">ExpP</span></a><span>
</span><a name="line-26"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="LeftP"><a href="Telomare.Eval.html#LeftP"><span class="hs-identifier">LeftP</span></a></a><span> </span><a href="Telomare.Eval.html#ExpP"><span class="hs-identifier hs-type">ExpP</span></a><span>
</span><a name="line-27"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="RightP"><a href="Telomare.Eval.html#RightP"><span class="hs-identifier">RightP</span></a></a><span> </span><a href="Telomare.Eval.html#ExpP"><span class="hs-identifier hs-type">ExpP</span></a><span>
</span><a name="line-28"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TraceP"><a href="Telomare.Eval.html#TraceP"><span class="hs-identifier">TraceP</span></a></a><span>
</span><a name="line-29"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span class="hs-keyword">instance</span><span> </span><a href="Telomare.html#EndoMapper"><span class="hs-identifier hs-type">EndoMapper</span></a><span> </span><a href="Telomare.Eval.html#ExpP"><span class="hs-identifier hs-type">ExpP</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-32"></a><span>  </span><a name="local-8214565720323824929"><a href="Telomare.html#endoMap"><span class="hs-identifier">endoMap</span></a></a><span> </span><a name="local-6989586621679343426"><a href="#local-6989586621679343426"><span class="hs-identifier">f</span></a></a><span> </span><a href="Telomare.Eval.html#ZeroP"><span class="hs-identifier hs-var">ZeroP</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679343426"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="Telomare.Eval.html#ZeroP"><span class="hs-identifier hs-var">ZeroP</span></a><span>
</span><a name="line-33"></a><span>  </span><span class="hs-identifier">endoMap</span><span> </span><a name="local-6989586621679343427"><a href="#local-6989586621679343427"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Telomare.Eval.html#PairP"><span class="hs-identifier hs-var">PairP</span></a><span> </span><a name="local-6989586621679343428"><a href="#local-6989586621679343428"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679343429"><a href="#local-6989586621679343429"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679343427"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Telomare.Eval.html#PairP"><span class="hs-identifier hs-var">PairP</span></a><span> </span><span class="hs-special">(</span><a href="Telomare.html#endoMap"><span class="hs-identifier hs-var">endoMap</span></a><span> </span><a href="#local-6989586621679343427"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679343428"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Telomare.html#endoMap"><span class="hs-identifier hs-var">endoMap</span></a><span> </span><a href="#local-6989586621679343427"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679343429"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span>  </span><span class="hs-identifier">endoMap</span><span> </span><a name="local-6989586621679343430"><a href="#local-6989586621679343430"><span class="hs-identifier">f</span></a></a><span> </span><a href="Telomare.Eval.html#VarP"><span class="hs-identifier hs-var">VarP</span></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679343430"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="Telomare.Eval.html#VarP"><span class="hs-identifier hs-var">VarP</span></a><span>
</span><a name="line-35"></a><span>  </span><span class="hs-identifier">endoMap</span><span> </span><a name="local-6989586621679343431"><a href="#local-6989586621679343431"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Telomare.Eval.html#SetEnvP"><span class="hs-identifier hs-var">SetEnvP</span></a><span> </span><a name="local-6989586621679343432"><a href="#local-6989586621679343432"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679343433"><a href="#local-6989586621679343433"><span class="hs-identifier">fe</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679343431"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Telomare.Eval.html#SetEnvP"><span class="hs-identifier hs-var">SetEnvP</span></a><span> </span><span class="hs-special">(</span><a href="Telomare.html#endoMap"><span class="hs-identifier hs-var">endoMap</span></a><span> </span><a href="#local-6989586621679343431"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679343432"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679343433"><span class="hs-identifier hs-var">fe</span></a><span>
</span><a name="line-36"></a><span>  </span><span class="hs-identifier">endoMap</span><span> </span><a name="local-6989586621679343434"><a href="#local-6989586621679343434"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Telomare.Eval.html#DeferP"><span class="hs-identifier hs-var">DeferP</span></a><span> </span><a name="local-6989586621679343435"><a href="#local-6989586621679343435"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679343434"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Telomare.Eval.html#DeferP"><span class="hs-identifier hs-var">DeferP</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Telomare.html#endoMap"><span class="hs-identifier hs-var">endoMap</span></a><span> </span><a href="#local-6989586621679343434"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679343435"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-37"></a><span>  </span><span class="hs-identifier">endoMap</span><span> </span><a name="local-6989586621679343436"><a href="#local-6989586621679343436"><span class="hs-identifier">f</span></a></a><span> </span><a href="Telomare.Eval.html#AbortP"><span class="hs-identifier hs-var">AbortP</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679343436"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="Telomare.Eval.html#AbortP"><span class="hs-identifier hs-var">AbortP</span></a><span>
</span><a name="line-38"></a><span>  </span><span class="hs-identifier">endoMap</span><span> </span><a name="local-6989586621679343437"><a href="#local-6989586621679343437"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Telomare.Eval.html#GateP"><span class="hs-identifier hs-var">GateP</span></a><span> </span><a name="local-6989586621679343438"><a href="#local-6989586621679343438"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679343439"><a href="#local-6989586621679343439"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679343437"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Telomare.Eval.html#GateP"><span class="hs-identifier hs-var">GateP</span></a><span> </span><span class="hs-special">(</span><a href="Telomare.html#endoMap"><span class="hs-identifier hs-var">endoMap</span></a><span> </span><a href="#local-6989586621679343437"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679343438"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Telomare.html#endoMap"><span class="hs-identifier hs-var">endoMap</span></a><span> </span><a href="#local-6989586621679343437"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679343439"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-39"></a><span>  </span><span class="hs-identifier">endoMap</span><span> </span><a name="local-6989586621679343440"><a href="#local-6989586621679343440"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Telomare.Eval.html#LeftP"><span class="hs-identifier hs-var">LeftP</span></a><span> </span><a name="local-6989586621679343441"><a href="#local-6989586621679343441"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679343440"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Telomare.Eval.html#LeftP"><span class="hs-identifier hs-var">LeftP</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Telomare.html#endoMap"><span class="hs-identifier hs-var">endoMap</span></a><span> </span><a href="#local-6989586621679343440"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679343441"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-40"></a><span>  </span><span class="hs-identifier">endoMap</span><span> </span><a name="local-6989586621679343442"><a href="#local-6989586621679343442"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Telomare.Eval.html#RightP"><span class="hs-identifier hs-var">RightP</span></a><span> </span><a name="local-6989586621679343443"><a href="#local-6989586621679343443"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679343442"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Telomare.Eval.html#RightP"><span class="hs-identifier hs-var">RightP</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Telomare.html#endoMap"><span class="hs-identifier hs-var">endoMap</span></a><span> </span><a href="#local-6989586621679343442"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679343443"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-41"></a><span>  </span><span class="hs-identifier">endoMap</span><span> </span><a name="local-6989586621679343444"><a href="#local-6989586621679343444"><span class="hs-identifier">f</span></a></a><span> </span><a href="Telomare.Eval.html#TraceP"><span class="hs-identifier hs-var">TraceP</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679343444"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="Telomare.Eval.html#TraceP"><span class="hs-identifier hs-var">TraceP</span></a><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-keyword">data</span><span> </span><a name="EvalError"><a href="Telomare.Eval.html#EvalError"><span class="hs-identifier">EvalError</span></a></a><span>
</span><a name="line-44"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="RTE"><a href="Telomare.Eval.html#RTE"><span class="hs-identifier">RTE</span></a></a><span> </span><a href="Telomare.html#RunTimeError"><span class="hs-identifier hs-type">RunTimeError</span></a><span>
</span><a name="line-45"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TCE"><a href="Telomare.Eval.html#TCE"><span class="hs-identifier">TCE</span></a></a><span> </span><a href="Telomare.TypeChecker.html#TypeCheckError"><span class="hs-identifier hs-type">TypeCheckError</span></a><span>
</span><a name="line-46"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-keyword">type</span><span> </span><a name="ExpFullEnv"><a href="Telomare.Eval.html#ExpFullEnv"><span class="hs-identifier">ExpFullEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Telomare.html#ExprA"><span class="hs-identifier hs-type">ExprA</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span class="hs-identifier">annotateEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><a href="Telomare.Eval.html#ExpP"><span class="hs-identifier hs-type">ExpP</span></a><span class="hs-special">)</span><span>
</span><a name="line-51"></a><a name="annotateEnv"><a href="Telomare.Eval.html#annotateEnv"><span class="hs-identifier">annotateEnv</span></a></a><span> </span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><a href="Telomare.Eval.html#ZeroP"><span class="hs-identifier hs-var">ZeroP</span></a><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span class="hs-identifier">annotateEnv</span><span> </span><span class="hs-special">(</span><a href="Telomare.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-6989586621679343446"><a href="#local-6989586621679343446"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679343447"><a href="#local-6989586621679343447"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-53"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679343448"><a href="#local-6989586621679343448"><span class="hs-identifier">at</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679343449"><a href="#local-6989586621679343449"><span class="hs-identifier">na</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Telomare.Eval.html#annotateEnv"><span class="hs-identifier hs-var">annotateEnv</span></a><span> </span><a href="#local-6989586621679343446"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-54"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621679343450"><a href="#local-6989586621679343450"><span class="hs-identifier">bt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679343451"><a href="#local-6989586621679343451"><span class="hs-identifier">nb</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Telomare.Eval.html#annotateEnv"><span class="hs-identifier hs-var">annotateEnv</span></a><span> </span><a href="#local-6989586621679343447"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-55"></a><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679343448"><span class="hs-identifier hs-var">at</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679343450"><span class="hs-identifier hs-var">bt</span></a><span class="hs-special">,</span><span> </span><a href="Telomare.Eval.html#PairP"><span class="hs-identifier hs-var">PairP</span></a><span> </span><a href="#local-6989586621679343449"><span class="hs-identifier hs-var">na</span></a><span> </span><a href="#local-6989586621679343451"><span class="hs-identifier hs-var">nb</span></a><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span class="hs-identifier">annotateEnv</span><span> </span><a href="Telomare.html#Env"><span class="hs-identifier hs-var">Env</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span> </span><a href="Telomare.Eval.html#VarP"><span class="hs-identifier hs-var">VarP</span></a><span class="hs-special">)</span><span>
</span><a name="line-57"></a><span class="hs-identifier">annotateEnv</span><span> </span><span class="hs-special">(</span><a href="Telomare.html#SetEnv"><span class="hs-identifier hs-var">SetEnv</span></a><span> </span><a name="local-6989586621679343452"><a href="#local-6989586621679343452"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679343453"><a href="#local-6989586621679343453"><span class="hs-identifier">xt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679343454"><a href="#local-6989586621679343454"><span class="hs-identifier">nx</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Telomare.Eval.html#annotateEnv"><span class="hs-identifier hs-var">annotateEnv</span></a><span> </span><a href="#local-6989586621679343452"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679343453"><span class="hs-identifier hs-var">xt</span></a><span class="hs-special">,</span><span> </span><a href="Telomare.Eval.html#SetEnvP"><span class="hs-identifier hs-var">SetEnvP</span></a><span> </span><a href="#local-6989586621679343454"><span class="hs-identifier hs-var">nx</span></a><span> </span><a href="#local-6989586621679343453"><span class="hs-identifier hs-var">xt</span></a><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span class="hs-identifier">annotateEnv</span><span> </span><span class="hs-special">(</span><a href="Telomare.html#Defer"><span class="hs-identifier hs-var">Defer</span></a><span> </span><a name="local-6989586621679343455"><a href="#local-6989586621679343455"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679343456"><a href="#local-6989586621679343456"><span class="hs-identifier">nx</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Telomare.Eval.html#annotateEnv"><span class="hs-identifier hs-var">annotateEnv</span></a><span> </span><a href="#local-6989586621679343455"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><a href="Telomare.Eval.html#DeferP"><span class="hs-identifier hs-var">DeferP</span></a><span> </span><a href="#local-6989586621679343456"><span class="hs-identifier hs-var">nx</span></a><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span class="hs-identifier">annotateEnv</span><span> </span><a href="Telomare.html#Abort"><span class="hs-identifier hs-var">Abort</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><a href="Telomare.Eval.html#AbortP"><span class="hs-identifier hs-var">AbortP</span></a><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span class="hs-identifier">annotateEnv</span><span> </span><span class="hs-special">(</span><a href="Telomare.html#Gate"><span class="hs-identifier hs-var">Gate</span></a><span> </span><a name="local-6989586621679343457"><a href="#local-6989586621679343457"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679343458"><a href="#local-6989586621679343458"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-61"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679343459"><a href="#local-6989586621679343459"><span class="hs-identifier">at</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679343460"><a href="#local-6989586621679343460"><span class="hs-identifier">na</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Telomare.Eval.html#annotateEnv"><span class="hs-identifier hs-var">annotateEnv</span></a><span> </span><a href="#local-6989586621679343457"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-62"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621679343461"><a href="#local-6989586621679343461"><span class="hs-identifier">bt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679343462"><a href="#local-6989586621679343462"><span class="hs-identifier">nb</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Telomare.Eval.html#annotateEnv"><span class="hs-identifier hs-var">annotateEnv</span></a><span> </span><a href="#local-6989586621679343458"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-63"></a><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679343459"><span class="hs-identifier hs-var">at</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679343461"><span class="hs-identifier hs-var">bt</span></a><span class="hs-special">,</span><span> </span><a href="Telomare.Eval.html#GateP"><span class="hs-identifier hs-var">GateP</span></a><span> </span><a href="#local-6989586621679343460"><span class="hs-identifier hs-var">na</span></a><span> </span><a href="#local-6989586621679343462"><span class="hs-identifier hs-var">nb</span></a><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span class="hs-identifier">annotateEnv</span><span> </span><span class="hs-special">(</span><a href="Telomare.html#PLeft"><span class="hs-identifier hs-var">PLeft</span></a><span> </span><a name="local-6989586621679343463"><a href="#local-6989586621679343463"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Telomare.Eval.html#LeftP"><span class="hs-identifier hs-var">LeftP</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Telomare.Eval.html#annotateEnv"><span class="hs-identifier hs-var">annotateEnv</span></a><span> </span><a href="#local-6989586621679343463"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-65"></a><span class="hs-identifier">annotateEnv</span><span> </span><span class="hs-special">(</span><a href="Telomare.html#PRight"><span class="hs-identifier hs-var">PRight</span></a><span> </span><a name="local-6989586621679343464"><a href="#local-6989586621679343464"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Telomare.Eval.html#RightP"><span class="hs-identifier hs-var">RightP</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Telomare.Eval.html#annotateEnv"><span class="hs-identifier hs-var">annotateEnv</span></a><span> </span><a href="#local-6989586621679343464"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-66"></a><span class="hs-identifier">annotateEnv</span><span> </span><a href="Telomare.html#Trace"><span class="hs-identifier hs-var">Trace</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span> </span><a href="Telomare.Eval.html#TraceP"><span class="hs-identifier hs-var">TraceP</span></a><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-identifier">fromFullEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="#local-6989586621679343445"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Telomare.Eval.html#ExpP"><span class="hs-identifier hs-type">ExpP</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679343445"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Telomare.Eval.html#ExpP"><span class="hs-identifier hs-type">ExpP</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679343445"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a><span>
</span><a name="line-69"></a><a name="fromFullEnv"><a href="Telomare.Eval.html#fromFullEnv"><span class="hs-identifier">fromFullEnv</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="Telomare.Eval.html#ZeroP"><span class="hs-identifier hs-var">ZeroP</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a><span>
</span><a name="line-70"></a><span class="hs-identifier">fromFullEnv</span><span> </span><a name="local-6989586621679343465"><a href="#local-6989586621679343465"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Telomare.Eval.html#PairP"><span class="hs-identifier hs-var">PairP</span></a><span> </span><a name="local-6989586621679343466"><a href="#local-6989586621679343466"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679343467"><a href="#local-6989586621679343467"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Telomare.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679343465"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679343466"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621679343465"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679343467"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-71"></a><span class="hs-identifier">fromFullEnv</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="Telomare.Eval.html#VarP"><span class="hs-identifier hs-var">VarP</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="Telomare.html#Env"><span class="hs-identifier hs-var">Env</span></a><span>
</span><a name="line-72"></a><span class="hs-identifier">fromFullEnv</span><span> </span><a name="local-6989586621679343468"><a href="#local-6989586621679343468"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Telomare.Eval.html#SetEnvP"><span class="hs-identifier hs-var">SetEnvP</span></a><span> </span><a name="local-6989586621679343469"><a href="#local-6989586621679343469"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Telomare.html#SetEnv"><span class="hs-identifier hs-var">SetEnv</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679343468"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679343469"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-73"></a><span class="hs-identifier">fromFullEnv</span><span> </span><a name="local-6989586621679343470"><a href="#local-6989586621679343470"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Telomare.Eval.html#DeferP"><span class="hs-identifier hs-var">DeferP</span></a><span> </span><a name="local-6989586621679343471"><a href="#local-6989586621679343471"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Telomare.html#Defer"><span class="hs-identifier hs-var">Defer</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679343470"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679343471"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-74"></a><span class="hs-identifier">fromFullEnv</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="Telomare.Eval.html#AbortP"><span class="hs-identifier hs-var">AbortP</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="Telomare.html#Abort"><span class="hs-identifier hs-var">Abort</span></a><span>
</span><a name="line-75"></a><span class="hs-identifier">fromFullEnv</span><span> </span><a name="local-6989586621679343472"><a href="#local-6989586621679343472"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Telomare.Eval.html#GateP"><span class="hs-identifier hs-var">GateP</span></a><span> </span><a name="local-6989586621679343473"><a href="#local-6989586621679343473"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679343474"><a href="#local-6989586621679343474"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Telomare.html#Gate"><span class="hs-identifier hs-var">Gate</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679343472"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679343473"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621679343472"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679343474"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-76"></a><span class="hs-identifier">fromFullEnv</span><span> </span><a name="local-6989586621679343475"><a href="#local-6989586621679343475"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Telomare.Eval.html#LeftP"><span class="hs-identifier hs-var">LeftP</span></a><span> </span><a name="local-6989586621679343476"><a href="#local-6989586621679343476"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Telomare.html#PLeft"><span class="hs-identifier hs-var">PLeft</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679343475"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679343476"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-77"></a><span class="hs-identifier">fromFullEnv</span><span> </span><a name="local-6989586621679343477"><a href="#local-6989586621679343477"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Telomare.Eval.html#RightP"><span class="hs-identifier hs-var">RightP</span></a><span> </span><a name="local-6989586621679343478"><a href="#local-6989586621679343478"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Telomare.html#PRight"><span class="hs-identifier hs-var">PRight</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679343477"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679343478"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-78"></a><span class="hs-identifier">fromFullEnv</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="Telomare.Eval.html#TraceP"><span class="hs-identifier hs-var">TraceP</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="Telomare.html#Trace"><span class="hs-identifier hs-var">Trace</span></a><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-keyword">instance</span><span> </span><a href="Telomare.html#TelomareLike"><span class="hs-identifier hs-type">TelomareLike</span></a><span> </span><a href="Telomare.Eval.html#ExpP"><span class="hs-identifier hs-type">ExpP</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-81"></a><span>  </span><a name="local-8214565720323878043"><a href="Telomare.html#fromTelomare"><span class="hs-identifier">fromTelomare</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Telomare.Eval.html#annotateEnv"><span class="hs-identifier hs-var">annotateEnv</span></a><span>
</span><a name="line-82"></a><span>  </span><a name="local-8214565720323878044"><a href="Telomare.html#toTelomare"><span class="hs-identifier">toTelomare</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fix</span><span> </span><a href="Telomare.Eval.html#fromFullEnv"><span class="hs-identifier hs-var">fromFullEnv</span></a><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span class="hs-identifier">partiallyEvaluate</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Telomare.Eval.html#ExpP"><span class="hs-identifier hs-type">ExpP</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Telomare.html#RunTimeError"><span class="hs-identifier hs-type">RunTimeError</span></a><span> </span><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a><span>
</span><a name="line-85"></a><a name="partiallyEvaluate"><a href="Telomare.Eval.html#partiallyEvaluate"><span class="hs-identifier">partiallyEvaluate</span></a></a><span> </span><a name="local-6989586621679343479"><a href="#local-6989586621679343479"><span class="hs-identifier">se</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Telomare.Eval.html#SetEnvP"><span class="hs-identifier hs-var">SetEnvP</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Telomare.html#Defer"><span class="hs-identifier hs-var">Defer</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fix</span><span> </span><a href="Telomare.Eval.html#fromFullEnv"><span class="hs-identifier hs-var">fromFullEnv</span></a><span> </span><a href="#local-6989586621679343479"><span class="hs-identifier hs-var">se</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-special">(</span><a href="Telomare.RunTime.html#pureEval"><span class="hs-identifier hs-var">pureEval</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Telomare.Optimizer.html#optimize"><span class="hs-identifier hs-var">optimize</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span class="hs-identifier">partiallyEvaluate</span><span> </span><a name="local-6989586621679343480"><a href="#local-6989586621679343480"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Telomare.Eval.html#fromFullEnv"><span class="hs-identifier hs-var">fromFullEnv</span></a><span> </span><a href="Telomare.Eval.html#partiallyEvaluate"><span class="hs-identifier hs-var">partiallyEvaluate</span></a><span> </span><a href="#local-6989586621679343480"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-identifier">eval'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a><span>
</span><a name="line-89"></a><a name="eval%27"><a href="Telomare.Eval.html#eval%27"><span class="hs-identifier">eval'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span class="hs-identifier">findChurchSize</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Telomare.html#Term3"><span class="hs-identifier hs-type">Term3</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Telomare.html#Term4"><span class="hs-identifier hs-type">Term4</span></a><span>
</span><a name="line-92"></a><span class="hs-comment">{-
findChurchSize term =
  let abortsAt i = (\(PResult (_, b)) -&gt; b) . fix pEval PZero . fromTelomare $ convertPT i term
      -- evaluating large church numbers is currently impractical, just fail if found
      (ib, ie) = if not (abortsAt 255) then (0, 255) else error &quot;findchurchsize TODO&quot; -- (256, maxBound)
      findC b e | b &gt; e = b
      findC b e = let midpoint = (\n -&gt; trace (&quot;midpoint is now &quot; &lt;&gt; show n) n) $ div (b + e) 2
                  in if abortsAt midpoint then findC (midpoint + 1) e else findC b midpoint
  in convertPT (findC ib ie) term
-}</span><span>
</span><a name="line-102"></a><a name="findChurchSize"><a href="Telomare.Eval.html#findChurchSize"><span class="hs-identifier">findChurchSize</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Telomare.Parser.html#convertPT"><span class="hs-identifier hs-var">convertPT</span></a><span> </span><span class="hs-number">255</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-comment">{-
findAllSizes :: Term2 -&gt; (Bool, Term3)
findAllSizes = let doChild (True, x) = TTransformedGrammar $ findChurchSize x
                   doChild (_, x) = TTransformedGrammar $ convertPT 0 x
                   doChildren l = let nl = map findAllSizes l
                                  in case sum (map (fromEnum . fst) nl) of
                                       0 -&gt; (False, map snd nl)
                                       1 -&gt; (True, map snd nl)
                                       _ -&gt; (False, map doChild nl)
               in \case
  TZero -&gt; (False, TZero)
  TPair a b -&gt; let (c, [na, nb]) = doChildren [a,b] in (c, TPair na nb)
  TVar n -&gt; (False, TVar n)
  TApp a b -&gt; let (c, [na, nb]) = doChildren [a,b] in (c, TApp na nb)
  TCheck a b -&gt; let (c, [na, nb]) = doChildren [a,b] in (c, TCheck na nb)
  TITE i t e -&gt; let (c, [ni, nt, ne]) = doChildren [i,t,e] in (c, TITE ni nt ne)
  TLeft x -&gt; TLeft &lt;$&gt; findAllSizes x
  TRight x -&gt; TRight &lt;$&gt; findAllSizes x
  TTrace x -&gt; TTrace &lt;$&gt; findAllSizes x
  TLam lt x -&gt; TLam lt &lt;$&gt; findAllSizes x
  TLimitedRecursion -&gt; (True, TLimitedRecursion)
-}</span><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span class="hs-identifier">evalLoop</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Telomare.html#IExpr"><span class="hs-identifier hs-type">IExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-128"></a><a name="evalLoop"><a href="Telomare.Eval.html#evalLoop"><span class="hs-identifier">evalLoop</span></a></a><span> </span><a name="local-6989586621679343481"><a href="#local-6989586621679343481"><span class="hs-identifier">iexpr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Telomare.Eval.html#eval%27"><span class="hs-identifier hs-var">eval'</span></a><span> </span><a href="#local-6989586621679343481"><span class="hs-identifier hs-var">iexpr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-129"></a><span>  </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679343482"><a href="#local-6989586621679343482"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">putStrLn</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;Failed compiling main, &quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679343482"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">]</span><span>
</span><a name="line-130"></a><span>  </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679343483"><a href="#local-6989586621679343483"><span class="hs-identifier">peExp</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-131"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679343484"><a href="#local-6989586621679343484"><span class="hs-identifier">mainLoop</span></a></a><span> </span><a name="local-6989586621679343485"><a href="#local-6989586621679343485"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-132"></a><span>          </span><span class="hs-comment">-- result &lt;- optimizedEval (app peExp s)</span><span>
</span><a name="line-133"></a><span>          </span><a name="local-6989586621679343486"><a href="#local-6989586621679343486"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Telomare.RunTime.html#simpleEval"><span class="hs-identifier hs-var">simpleEval</span></a><span> </span><span class="hs-special">(</span><a href="Telomare.html#app"><span class="hs-identifier hs-var">app</span></a><span> </span><a href="#local-6989586621679343483"><span class="hs-identifier hs-var">peExp</span></a><span> </span><a href="#local-6989586621679343485"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-134"></a><span>          </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679343486"><span class="hs-identifier hs-var">result</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-135"></a><span>            </span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">putStrLn</span><span> </span><span class="hs-string">&quot;aborted&quot;</span><span>
</span><a name="line-136"></a><span>            </span><span class="hs-special">(</span><a href="Telomare.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-6989586621679343487"><a href="#local-6989586621679343487"><span class="hs-identifier">disp</span></a></a><span> </span><a name="local-6989586621679343488"><a href="#local-6989586621679343488"><span class="hs-identifier">newState</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-137"></a><span>              </span><span class="hs-identifier hs-var">putStrLn</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Telomare.html#g2s"><span class="hs-identifier hs-var">g2s</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679343487"><span class="hs-identifier hs-var">disp</span></a><span>
</span><a name="line-138"></a><span>              </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679343488"><span class="hs-identifier hs-var">newState</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-139"></a><span>                </span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">putStrLn</span><span> </span><span class="hs-string">&quot;done&quot;</span><span>
</span><a name="line-140"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-141"></a><span>                  </span><a name="local-6989586621679343489"><a href="#local-6989586621679343489"><span class="hs-identifier">inp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Telomare.html#s2g"><span class="hs-identifier hs-var">s2g</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">getLine</span><span>
</span><a name="line-142"></a><span>                  </span><a href="#local-6989586621679343484"><span class="hs-identifier hs-var">mainLoop</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Telomare.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a href="#local-6989586621679343489"><span class="hs-identifier hs-var">inp</span></a><span> </span><a href="#local-6989586621679343488"><span class="hs-identifier hs-var">newState</span></a><span>
</span><a name="line-143"></a><span>            </span><a name="local-6989586621679343490"><a href="#local-6989586621679343490"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">putStrLn</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;runtime error, dumped &quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679343490"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">]</span><span>
</span><a name="line-144"></a><span>    </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679343484"><span class="hs-identifier hs-var">mainLoop</span></a><span> </span><a href="Telomare.html#Zero"><span class="hs-identifier hs-var">Zero</span></a><span>
</span><a name="line-145"></a></pre></body></html>